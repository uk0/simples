<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Linux 丛裸机进行安全加固 — NeoJ's Web Page[建新的Blog]</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/a.css">
    <link rel="stylesheet" href="/pygments.css">
    <meta name="keywords" content="Linux 丛裸机进行安全加固-建新的Blog,github.com/uk0,NeoJ" />
    <meta name="description" content="这是一个关于建新的个人网站的博客页面。" />
    <style>
        .password-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .password-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            text-align: center;
            border-radius: 5px;
        }

        .password-input {
            width: 200px;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .password-submit {
            padding: 8px 15px;
            background-color: #008000;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 3px;
            margin: 5px;
        }

        .password-submit:hover {
            background-color: #006600;
        }

        .password-notice {
            background-color: #ffffcc;
            border: 2px solid #ffcc00;
            padding: 15px;
            margin: 30px 0;
            text-align: center;
            border-radius: 5px;
        }

        .error-message {
            color: red;
            font-size: 12px;
            margin-top: 10px;
            min-height: 20px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #008000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<header>
    <nav>
        <table width="620" border="1" class="center">
            <tbody>
            <tr>
                <td width="64" rowspan="2">
                    <img src="/avatar.png" width="64">
                </td>
                <td align="center" colspan="5">
                    <font size="5"><b><font color="#008000">NeoJ</font>'s Web Page</b></font>
                </td>
                <td width="100" align="center" rowspan="2">
                    Last Update:<br>Sep. 19, 2025
                </td>
            </tr>
            <tr>
                <td align="center" width="82">
                    <a href="/">Index</a>
                </td>
                <td class="active" align="center" width="82">
                    <a href="/">Blog</a>
                </td>
                <td align="center" width="82">
                    <a href="https://github.com/uk0">Projects</a>
                </td>
                <td align="center" width="82">
                    <a href="https://github.com/uk0">GitHub</a>
                </td>
                <td align="center" width="82">
                    <a href="/about.html">About</a>
                </td>
            </tr>
            </tbody>
        </table>
    </nav>
</header>

<div class="page center">
    <h1 class="text_center">Linux 丛裸机进行安全加固</h1>

    <p class="meta text_center">
        2025-09-19
    </p>

    <article id="article-content">
        <h1>Linux 丛裸机进行安全加固</h1>
<h3>创建用户</h3>
<p>useradd abs<br>
password abs</p>
<h3>一、ssh加固</h3>
<p>vi /etc/ssh/sshd_config<br>
####################<br>
Port 35791<br>
Protocol 2<br>
MaxAuthTries 3<br>
MaxSessions 3<br>
RSAAuthentication yes<br>
PubkeyAuthentication yes<br>
UsePAM yes<br>
X11Forwarding yes<br>
Banner none<br>
UseDNS no<br>
PermitRootLogin no<br>
PasswordAuthentication yes<br>
#####################<br>
service sshd reload</p>
<h3>二、环境变量加固profile</h3>
<p>vi /etc/profile<br>
#######################################<br>
##记录历史命令时间<br>
export HISTTIMEFORMAT=&quot;<code>whoami</code> %F %T &quot;<br>
##修改帐户TMOUT值，600秒无操作自动退出<br>
export PS1='$LOGNAME@'<code>hostname</code>:'$PWD''$ '<br>
umask 022<br>
TMOUT=600<br>
#######################################<br>
source /etc/profile</p>
<h3>三、屏蔽banner信息</h3>
<p>备份方法：<br>
cp -p /etc/ssh/sshd_config /etc/ssh/sshd_config_bak<br>
cp -p /etc/motd /etc/motd_bak</p>
<p>加固方法：<br>
vi /etc/ssh/sshd_config<br>
banner NONE</p>
<p>vi /etc/motd<br>
删除全部内容或更新成自己想要添加的内容</p>
<h3>四、禁用x_windows服务</h3>
<p>vi /etc/inittab<br>
——————————————————————————<br>
id:5:initdefault: --5改成3<br>
——————————————————————————</p>
<h3>五、打开审计</h3>
<p>chkconfig auditd on<br>
service auditd restart</p>
<h3>六、清理不必要的信任主机</h3>
<ul>
<li>删除其中不必要的主机<br>
vi /etc/hosts.equiv<br>
vi /$HOME/.rhosts</li>
</ul>
<h3>七、安装基础包</h3>
<p>1、安装rz sz和 screen<br>
1).安装<br>
yum install -y lrzsz<br>
yum install -y screen<br>
2).查看<br>
rz 会弹出一个框</p>
<p>2、安装iftop<br>
1).安装<br>
yum -y install flex byacc libpcap ncurses ncurses-devel libpcap-devel<br>
wget http://www.ex-parrot.com/pdw/iftop/download/iftop-1.0pre2.tar.gz<br>
tar zxvf iftop-1.0pre2.tar.gz<br>
cd iftop-1.0pre2<br>
./configure<br>
make &amp;&amp; make install<br>
2).查看带宽<br>
iftop -B -n -N -p</p>
<p>3、安装jdk （1.6.0 1.7.0 1.8.0）这三个版本的jdk包 默认为1.8.0版本<br>
1).下载安装包到某个路径<br>
mkdir /opt/jdk/<br>
jdk-8u65-linux-x64.gz<br>
jdk-7u80-linux-x64.gz</p>
<p>2).解压<br>
tar xf jdk-7u80-linux-x64.gz<br>
tar xf jdk-8u65-linux-x64.gz</p>
<p>3).修改环境变量<br>
vim /etc/profile</p>
<hr>
<p>export JAVA_HOME=/opt/jdk/jdk1.8.0_65<br>
export JRE_HOME=/opt/jdk/jdk1.8.0_65/jre<br>
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH<br>
export PATH=$PATH:$JAVA_HOME/bin/</p>
<hr>
<p>source /etc/profile</p>
<h2>4).查看java版本<br>
java -version</h2>
<p>java version &quot;1.8.0_65&quot;<br>
Java(TM) SE Runtime Environment (build 1.8.0_65-b17)<br>
Java HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)</p>
<hr>
<p>5).安装jdk1.6.0版本<br>
cd /opt/jdk/<br>
chmod 755 jdk-6u45-linux-x64.bin<br>
./jdk-6u45-linux-x64.bin （注意，这个步骤一定要在jdk-6u45-linux-x64.bin所在目录下）<br>
会生成一个jdk1.6.0_45目录</p>
<h2>6).查看1.6.0或1.7.0的版本<br>
./jdk1.6.0_45/bin/java -version</h2>
<p>java version &quot;1.6.0_45&quot;<br>
Java(TM) SE Runtime Environment (build 1.6.0_45-b06)<br>
Java HotSpot(TM) 64-Bit Server VM (build 20.45-b01, mixed mode)</p>
<hr>
<h2>或<br>
./jdk1.7.0_80/bin/java -version</h2>
<p>java version &quot;1.7.0_80&quot;<br>
Java(TM) SE Runtime Environment (build 1.7.0_80-b15)<br>
Java HotSpot(TM) 64-Bit Server VM (build 24.80-b11, mixed mode)</p>
<hr>
<p>4、安装Python<br>
1).安装 sqlite-devel(因为 Flask 应用程序可能使用能 Sqlite 数据库，所以这个得装上（之前因为没装这个，导致 Python 无法导入 sqlite3 库）)<br>
yum install sqlite-devel -y<br>
2).安装Python2.7<br>
wget https://www.python.org/ftp/python/2.7.8/Python-2.7.8.tgz<br>
tar xf Python-2.7.8.tgz<br>
cd Python-2.7.8<br>
./configure --prefix=/usr/local<br>
make &amp;&amp; make install<br>
安装成功之后，你可以在 /usr/local/bin/python2.7 找到 Python 2.7。</p>
<p>5、安装aide</p>
<ol>
<li>安装mhash<br>
yum -y install mhash-devel.x86_64 mhash.x86_64<br>
2.安装aide<br>
yum -y install aide.x86_64</li>
<li>配置(默认即可)<br>
vim /etc/aide.conf<br>
--可以不改,按默认就可以了<br>
4.生成初始化数据库</li>
</ol>
<h1>aide --init</h1>
<h1>mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz</h1>
<ol start="5">
<li>开始检测</li>
</ol>
<h1>aide --check</h1>
<p>6、Lynis安全检查工具<br>
1).介绍<br>
https://cisofy.com/<br>
Lynis是一个为系统管理员提供的 Linux和Unix的审计工具 。 Lynis扫描系统的配置，并创建概述系统信息与安全问题所使用的专业审计。<br>
当用户启动该软件后，Lynis会会逐次扫描系统的内核、用户目录、软件信息等，并最后生成一个全面的报告。<br>
需要说明的是，该工具只能生成一个扫描检测后的报告，对用户起到提醒作用，本身并不能提高系统的安全性。<br>
但是该工具却可以成为其他安全软件、系统测评软件的模块。</p>
<p>2).安装<br>
yum -y install lynis<br>
或<br>
wget https://cisofy.com/files/lynis-2.1.1.tar.gz</p>
<p>3).全面检查<br>
lynis --check-all -Q</p>
<p>4).自动检查<br>
lynis -c --auditor &quot;automated&quot; --cronjob &gt; /var/log/lynis/report.txt</p>
<p>5).检查某项目<br>
lynis --tests FILE-6354 --quick</p>
<p>6).查看警告<br>
grep Warning /var/log/lynis.log</p>
<p>7).查看建议<br>
grep Suggestion /var/log/lynis.log</p>
<h3>八、建立主机间的信任</h3>
<p>1、生成密钥(默认的是rsa)<br>
ssh-keygen -t rsa<br>
2、将生成的密钥（公钥）拷贝给另一台主机<br>
ssh-copy-id -i ~/.ssh/id_rsa.pub &quot;-p 35791 root@192.168.1.4&quot;<br>
指定端口时记得使用双引号，以免报错<br>
3、测试<br>
ssh -p 35791 root@192.168.1.4<br>
这样直接连接到192.168.1.4这一台主机上，不用输入密码就是添加信任成功</p>
<h3>九、修改主机名</h3>
<p>1.临时修改主机名<br>
查看当前主机名：<br>
spark@localhost:~$ hostname<br>
localhost</p>
<p>修改主机名并查看当前主机名：<br>
spark@localhost:~$ sudo hostname hadoop<br>
spark@localhost:~$ hostname<br>
hadoop<br>
PS:以上的修改只是临时修改，重启后就恢复原样了。</p>
<p>2.永久修改主机名<br>
步骤1：</p>
<p>修改/etc/sysconfig/network中的hostname</p>
<p>vi /etc/sysconfig/network<br>
HOSTNAME=localhost.localdomain #修改localhost.localdomain为orcl1<br>
修改network的HOSTNAME项。点前面是主机名，点后面是域名。没有点就是主机名。</p>
<p>这个是永久修改，重启后生效。目前不知道怎么立即生效。</p>
<p>想立即生效，可以同时采用第一种方法。</p>
<p>步骤2：<br>
修改/etc/hosts文件</p>
<p>vi /etc/hosts<br>
127.0.0.1 localhost.localdomain #修改localhost.localdomain为orcl1<br>
shutdown -r now #最后，重启服务器即可。</p>
<h3>十、配置防火墙</h3>
<p>1、进入配置文件<br>
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br>
vim /etc/sysconfig/iptables<br>
########################################################<br>
*filter<br>
################ NULL Accept Hosts ######################<br>
###允许保垒机<br>
-A INPUT -s 221.41.47.213/32 -p tcp --dport 35791 -j ACCEPT<br>
-A INPUT -s 10.168.189.37/32 -p tcp --dport 35791 -j ACCEPT<br>
###允许本机<br>
-A INPUT -s 221.43.178.5/32 -p tcp --dport 35791 -j ACCEPT<br>
-A INPUT -s 10.0.0.10/32 -p tcp --dport 35791 -j ACCEPT<br>
###允许内网<br>
-A INPUT -s 10.0.0.0/8 -p tcp --dport 35791 -j ACCEPT<br>
###允许腾讯众创空间<br>
-A INPUT -s 221.69.10.134/32 -p tcp --dport 35791 -j ACCEPT</p>
<h4>MMSS 249</h4>
<p>-A INPUT -s 100.41.85.249/32 -p tcp -j ACCEPT<br>
-A INPUT -d 100.41.85.249/32 -p tcp -j ACCEPT</p>
<p>###限制连接数<br>
-A INPUT -p tcp --dport 8080 -m connlimit --connlimit-above 3000 -j DROP<br>
-A INPUT -p tcp --dport 8888 -m connlimit --connlimit-above 3000 -j DROP<br>
-A INPUT -p tcp --dport 28080 -m connlimit --connlimit-above 3000 -j DROP</p>
<p>###允许除35791之外所有端口<br>
-A INPUT -p tcp --dport 35791 -j DROP<br>
-A INPUT -p tcp ! --dport 35791 -j ACCEPT</p>
<p>################ Black List ############################<br>
#-A INPUT -s 106.187.53.56/32 -p tcp --dport 35791 -j DROP</p>
<p>########### DNS Resolved ##############################<br>
-A INPUT -p udp -m udp --sport 53 -j ACCEPT<br>
-A INPUT -p udp -m udp --dport 53 -j ACCEPT</p>
<p>################# ALLOW Local ########################<br>
-A INPUT -i lo -j ACCEPT</p>
<p>################# Forbidden Ping #######################<br>
-A INPUT -i eth0 -p icmp -s 0/0 -d 0/0 -j DROP</p>
<p>################# NFS Backup Server ####################<br>
-A INPUT -s 10.168.189.37/32 -p all -j ACCEPT<br>
-A INPUT -s 121.41.47.213/32 -p all -j ACCEPT</p>
<p>################# Forbidden ALL ########################<br>
-P INPUT DROP</p>
<p>################# OUTPUT Settings ####################<br>
-P OUTPUT ACCEPT<br>
COMMIT<br>
#####################################################</p>
<h3>十一、阿里云服务器安装安骑士</h3>
<p>1、安装64位的执行命令<br>
wget 'http://update.aegis.aliyun.com/download/AliAqsInstall_64.sh' &amp;&amp; sh AliAqsInstall_64.sh i24iJ7</p>
<p>2、安装32位的执行命令<br>
wget 'http://update.aegis.aliyun.com/download/AliAqsInstall_32.sh' &amp;&amp; sh AliAqsInstall_32.sh i24iJ7</p>


        
    </article>
</div>



<footer>
    <div class="footer center text_center">
        <p><font size="2">Website is best viewed in 800x600 or higher equivalent resolution.</font></p>
        <hr>
        <p><img src="/CC-BY-SA.png" height="31">&nbsp;<img src="/linuxnow.gif">&nbsp;<img src="/anybrowser.gif"></p>
        <p><font size="2">Copyright © 2015-2025 Jianxin Zhang. All rights reserved.<br>
            Unless otherwise noted, content on this site is licensed under CC BY-SA 4.0.</font></p>
    </div>
</footer>
</body>
</html>