<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>[JAR] Game bounceTales — NeoJ's Web Page[建新的Blog]</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/a.css">
    <link rel="stylesheet" href="/pygments.css">
    <meta name="keywords" content="[JAR] Game bounceTales-建新的Blog,github.com/uk0,NeoJ" />
    <meta name="description" content="这是一个关于建新的个人网站的博客页面。" />
    <style>
        .password-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .password-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            text-align: center;
            border-radius: 5px;
        }

        .password-input {
            width: 200px;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .password-submit {
            padding: 8px 15px;
            background-color: #008000;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 3px;
            margin: 5px;
        }

        .password-submit:hover {
            background-color: #006600;
        }

        .password-notice {
            background-color: #ffffcc;
            border: 2px solid #ffcc00;
            padding: 15px;
            margin: 30px 0;
            text-align: center;
            border-radius: 5px;
        }

        .error-message {
            color: red;
            font-size: 12px;
            margin-top: 10px;
            min-height: 20px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #008000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<header>
    <nav>
        <table width="620" border="1" class="center">
            <tbody>
            <tr>
                <td width="64" rowspan="2">
                    <img src="/avatar.png" width="64">
                </td>
                <td align="center" colspan="5">
                    <font size="5"><b><font color="#008000">NeoJ</font>'s Web Page</b></font>
                </td>
                <td width="100" align="center" rowspan="2">
                    Last Update:<br>Sep. 21, 2025
                </td>
            </tr>
            <tr>
                <td align="center" width="82">
                    <a href="/">Index</a>
                </td>
                <td class="active" align="center" width="82">
                    <a href="/">Blog</a>
                </td>
                <td align="center" width="82">
                    <a href="https://github.com/uk0">Projects</a>
                </td>
                <td align="center" width="82">
                    <a href="https://github.com/uk0">GitHub</a>
                </td>
                <td align="center" width="82">
                    <a href="/about.html">About</a>
                </td>
            </tr>
            </tbody>
        </table>
    </nav>
</header>

<div class="page center">
    <h1 class="text_center">[JAR] Game bounceTales</h1>

    <p class="meta text_center">
        2025-09-21
    </p>

    <article id="article-content">
        <h1>[JAR] Game <strong>bounceTales</strong></h1>
<div class="jar-player-wrapper" id="jar_13798032-wrapper">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
<pre><code>#jar_13798032-wrapper {
  margin: 20px auto;
  padding: 0;
  background: linear-gradient(135deg, #c0c0c0 0%, #808080 50%, #c0c0c0 100%);
  border-radius: 20px;
  max-width: 480px;
  width: 100%;
  font-family: 'Orbitron', 'Arial', sans-serif;
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.5),
    inset 0 2px 4px rgba(255, 255, 255, 0.8),
    inset 0 -2px 4px rgba(0, 0, 0, 0.3);
  overflow: hidden;
  border: 2px solid #606060;
}

/* Nokia Style Header */
#jar_13798032-wrapper .nokia-header {
  background: linear-gradient(180deg, #003366 0%, #001a33 100%);
  padding: 12px 20px;
  text-align: center;
  border-bottom: 3px solid #4d94ff;
  position: relative;
}

#jar_13798032-wrapper .nokia-logo {
  font-size: 24px;
  font-weight: 900;
  color: #fff;
  text-shadow: 
    0 2px 4px rgba(0,0,0,0.5),
    0 0 20px rgba(77, 148, 255, 0.5);
  letter-spacing: 3px;
  margin-bottom: 5px;
}

#jar_13798032-wrapper .game-name {
  color: #4d94ff;
  font-size: 14px;
  font-weight: 500;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
  padding: 0 10px;
}

/* Control Bar */
#jar_13798032-wrapper .control-bar {
  background: linear-gradient(90deg, #2a2a2a 0%, #1a1a1a 100%);
  padding: 8px 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 2px solid #000;
}

#jar_13798032-wrapper .status-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #4d94ff;
  font-size: 12px;
}

#jar_13798032-wrapper .status-led {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #ff0000;
  box-shadow: 0 0 6px currentColor;
  animation: blink 2s infinite;
}

#jar_13798032-wrapper .status-led.active {
  background: #00ff00;
  animation: none;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

#jar_13798032-wrapper .mini-controls {
  display: flex;
  gap: 5px;
}

#jar_13798032-wrapper .mini-btn {
  background: #333;
  color: #fff;
  border: 1px solid #555;
  padding: 4px 8px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 11px;
  transition: all 0.2s;
  text-decoration: none;
}

#jar_13798032-wrapper .mini-btn:hover {
  background: #4d94ff;
  border-color: #6ba3ff;
}

/* Phone Screen Frame */
#jar_13798032-wrapper .screen-frame {
  background: #1a1a1a;
  padding: 15px;
  position: relative;
}

#jar_13798032-wrapper .screen-bezel {
  background: linear-gradient(135deg, #000 0%, #222 100%);
  border-radius: 8px;
  padding: 8px;
  box-shadow: 
    inset 0 2px 8px rgba(0,0,0,0.8),
    0 1px 2px rgba(255,255,255,0.1);
}

/* Display Container */
#jar_13798032-wrapper #display-container {
  background: #000;
  border-radius: 4px;
  position: relative;
  overflow: hidden;
}

#jar_13798032-wrapper #display {
  position: relative;
  background: #000;
}

#jar_13798032-wrapper #canvas {
  display: block;
  margin: 0 auto;
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
  background: #000;
  max-width: 100%;
}

/* Screen overlays */
#jar_13798032-wrapper .screen {
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.95);
  color: #4d94ff;
  text-align: center;
  padding: 20px;
  z-index: 10;
}

#jar_13798032-wrapper .screen.active {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

#jar_13798032-wrapper .screen .title {
  font-size: 14px;
  margin-bottom: 15px;
  text-transform: uppercase;
  letter-spacing: 2px;
}

#jar_13798032-wrapper .screen progress {
  width: 200px;
  height: 4px;
}

/* Virtual Keypad - Nokia Style */
#jar_13798032-wrapper #keypad {
  background: linear-gradient(180deg, #d0d0d0 0%, #a0a0a0 100%);
  padding: 15px;
  display: flex;
  justify-content: center;
  gap: 20px;
  user-select: none;
  border-top: 2px solid #606060;
}

#jar_13798032-wrapper #joypad {
  display: inline-block;
  text-align: center;
}

#jar_13798032-wrapper #numpad {
  display: inline-block;
}

#jar_13798032-wrapper .key {
  background: linear-gradient(135deg, #f0f0f0 0%, #d0d0d0 100%);
  border: 1px solid #999;
  border-radius: 8px;
  color: #333;
  width: 38px;
  height: 38px;
  margin: 2px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 600;
  transition: all 0.1s;
  vertical-align: top;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-shadow: 
    0 2px 4px rgba(0,0,0,0.2),
    inset 0 1px 2px rgba(255,255,255,0.8);
  position: relative;
  flex-direction: column;
}

#jar_13798032-wrapper .key:active,
#jar_13798032-wrapper .key.pressed {
  background: linear-gradient(135deg, #d0d0d0 0%, #b0b0b0 100%);
  transform: scale(0.95);
  box-shadow: 
    0 1px 2px rgba(0,0,0,0.2),
    inset 0 1px 3px rgba(0,0,0,0.3);
}

/* Special buttons styling */
#jar_13798032-wrapper #choice { 
  background: linear-gradient(135deg, #4d94ff 0%, #0066cc 100%);
  color: #fff;
  font-size: 10px;
}

#jar_13798032-wrapper #back { 
  background: linear-gradient(135deg, #ff6666 0%, #cc0000 100%);
  color: #fff;
  font-size: 10px;
}

#jar_13798032-wrapper #ok { 
  background: linear-gradient(135deg, #66ff66 0%, #00cc00 100%);
  color: #fff;
  border-radius: 50%;
  width: 44px;
  height: 44px;
}

/* Key hints */
#jar_13798032-wrapper .key-hint {
  font-size: 8px;
  color: #666;
  margin-top: 2px;
}

/* Loading message */
#jar_13798032-wrapper .loading-message {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #4d94ff;
  font-size: 12px;
  z-index: 100;
  background: rgba(0,0,0,0.9);
  padding: 10px 20px;
  border-radius: 8px;
  border: 1px solid #4d94ff;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Keyboard mapping guide */
#jar_13798032-wrapper .keyboard-guide {
  background: rgba(0,0,0,0.8);
  padding: 10px 15px;
  margin-top: 10px;
  border-radius: 8px;
  font-size: 11px;
  color: #aaa;
}

#jar_13798032-wrapper .keyboard-guide h4 {
  color: #4d94ff;
  margin: 0 0 8px 0;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

#jar_13798032-wrapper .key-mapping {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 5px;
  margin-top: 8px;
}

#jar_13798032-wrapper .key-map-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

#jar_13798032-wrapper .key-map-item .pc-key {
  background: #4d94ff;
  color: #fff;
  padding: 2px 6px;
  border-radius: 3px;
  font-family: monospace;
  font-size: 10px;
  font-weight: bold;
  min-width: 20px;
  text-align: center;
}

#jar_13798032-wrapper .key-map-item .arrow {
  color: #666;
}

#jar_13798032-wrapper .key-map-item .phone-key {
  color: #ccc;
  font-size: 10px;
}

/* Hide some elements */
#jar_13798032-wrapper #header {
  display: none !important;
}

#jar_13798032-wrapper .lcdui-alert {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  z-index: 1000;
  min-width: 280px;
  color: #333;
}

#jar_13798032-wrapper .numpad2 { display: none; }
#jar_13798032-wrapper.gamepad-2 .numpad { display: none; }
#jar_13798032-wrapper.gamepad-2 .numpad2 { display: inline-block; }

@media (max-width: 640px) {
  #jar_13798032-wrapper {
    margin: 10px;
    max-width: calc(100vw - 20px);
  }
  
  #jar_13798032-wrapper .key {
    width: 32px;
    height: 32px;
    font-size: 10px;
  }

  #jar_13798032-wrapper #ok {
    width: 36px;
    height: 36px;
  }

  #jar_13798032-wrapper .keyboard-guide {
    font-size: 10px;
  }
}
</code></pre>
<p></style></p>
  <!-- Nokia Style Header -->
  <div class="nokia-header">
    <div class="nokia-logo">NOKIA</div>
    <div class="game-name">📱 bounceTales-240.jar</div>
  </div>
  <!-- Control Bar -->
  <div class="control-bar">
    <div class="status-indicator">
      <span class="status-led" id="jar_c338bc67-status-led"></span>
      <span id="jar_c338bc67-status-text">Loading...</span>
    </div>
    <div class="mini-controls">
      <button class="mini-btn" onclick="location.reload()">↻</button>
      <a href="0104/attachments/9E921054.dat" download class="mini-btn">⬇</a>
    </div>
  </div>
  <!-- Hidden file input -->
  <input id="File" type="file" style="visibility:hidden;position:absolute;width:0;height:0">
  <!-- Phone Screen -->
  <div class="screen-frame">
    <div class="screen-bezel">
      <div id="display-container">
        <div id="display">
          <div id="header"></div>
          <canvas id="canvas" width="240" height="320"></canvas>
          <div id="download-screen" class="screen">
			Wait
          </div>
          <div id="splash-screen" class="screen">
            <h1 class="title">Starting...</h1>
            <progress></progress>
          </div>
          <div id="exit-screen" class="screen"></div>
          <div id="background-screen"></div>
          <div class="loading-message" id="jar_c338bc67-loading-msg">Initializing...</div>
        </div>
      </div>
    </div>
  </div>
  <!-- LCDUI Alert Dialog -->
  <form role="dialog" data-type="confirm" class="lcdui-alert" id="lcdui-alert" style="display:none">
    <section>
      <h1 class="title"></h1>
      <p class="text"></p>
      <p><progress style="display:none"></progress></p>
    </section>
    <menu>
      <button class="button0" style="display:none"></button>
      <button class="button1" style="display:none"></button>
    </menu>
  </form>
  <!-- Virtual Keypad -->
  <div id="keypad" class="gamepad-3 row-reverse">
    <div id="joypad">
      <button id="choice" class="key">
        <span>L</span>
        <span class="key-hint">Q</span>
      </button>
      <button id="up" class="key">
        <span>↑</span>
        <span class="key-hint">W</span>
      </button>
      <button id="back" class="key">
        <span>R</span>
        <span class="key-hint">E</span>
      </button><br>
      <button id="left" class="key">
        <span>←</span>
        <span class="key-hint">A</span>
      </button>
      <button id="ok" class="key">
        <span>OK</span>
        <span class="key-hint">X</span>
      </button>
      <button id="right" class="key">
        <span>→</span>
        <span class="key-hint">D</span>
      </button><br>
      <span style="width:42px;display:inline-block;"></span>
      <button id="down" class="key">
        <span>↓</span>
        <span class="key-hint">S</span>
      </button>
      <span style="width:42px;display:inline-block;"></span>
    </div>
    <div id="numpad">
      <button id="num1" class="key">
        <span>1</span>
        <span class="key-hint">Y</span>
      </button>
      <button id="num2" class="key">
        <span>2</span>
        <span class="key-hint">U</span>
      </button>
      <button id="num3" class="key">
        <span>3</span>
        <span class="key-hint">I</span>
      </button>
      <button id="star" class="key numpad2">
        <span>*</span>
        <span class="key-hint">[</span>
      </button><br>
      <button id="num4" class="key">
        <span>4</span>
        <span class="key-hint">O</span>
      </button>
      <button id="num5" class="key">
        <span>5</span>
        <span class="key-hint">P</span>
      </button>
      <button id="num6" class="key">
        <span>6</span>
        <span class="key-hint">H</span>
      </button>
      <button id="num0" class="key numpad2">
        <span>0</span>
        <span class="key-hint">;</span>
      </button><br>
      <button id="num7" class="key">
        <span>7</span>
        <span class="key-hint">J</span>
      </button>
      <button id="num8" class="key">
        <span>8</span>
        <span class="key-hint">K</span>
      </button>
      <button id="num9" class="key">
        <span>9</span>
        <span class="key-hint">L</span>
      </button>
      <button id="pound" class="key numpad2">
        <span>#</span>
        <span class="key-hint">]</span>
      </button><br>
      <button id="star" class="key numpad">
        <span>*</span>
        <span class="key-hint">[</span>
      </button>
      <button id="num0" class="key numpad">
        <span>0</span>
        <span class="key-hint">;</span>
      </button>
      <button id="pound" class="key numpad">
        <span>#</span>
        <span class="key-hint">]</span>
      </button>
    </div>
  </div>
  <!-- Keyboard Guide -->
  <div class="keyboard-guide">
    <h4>⌨️ Keyboard Controls</h4>
    <div class="key-mapping">
      <div class="key-map-item">
        <span class="pc-key">W/A/S/D</span>
        <span class="arrow">→</span>
        <span class="phone-key">方向键</span>
      </div>
      <div class="key-map-item">
        <span class="pc-key">Q</span>
        <span class="arrow">→</span>
        <span class="phone-key">左功能键</span>
      </div>
      <div class="key-map-item">
        <span class="pc-key">E</span>
        <span class="arrow">→</span>
        <span class="phone-key">右功能键</span>
      </div>
      <div class="key-map-item">
        <span class="pc-key">X</span>
        <span class="arrow">→</span>
        <span class="phone-key">确认键</span>
      </div>
      <div class="key-map-item">
        <span class="pc-key">Y~P,H~L,;</span>
        <span class="arrow">→</span>
        <span class="phone-key">数字1-9,0</span>
      </div>
      <div class="key-map-item">
        <span class="pc-key">[ ]</span>
        <span class="arrow">→</span>
        <span class="phone-key">* #</span>
      </div>
    </div>
  </div>
  <script>
  // Pre-setup configuration before any J2ME.js scripts load
  (function() {
    const JAR_NAME = 'bounceTales-240.jar';
    // Setup config object early
    v_config = {};
    v_config.localjar = JAR_NAME;
    v_config.enginemode = 'enginemode2-classes2.jar';
    v_config.gamepadSize = 'gamepad-3';
    v_config.gamepad = 1;
    v_config.canvasSize = 'size-240x320';
    v_config.gameresize = 'resize-1';
    console.log('Pre-configured v_config:', v_config);
  })();
  </script>
  <!-- Load J2ME.js dependencies first -->
  <script src="/jar_em/libs/encoding.js"></script>
  <script src="/jar_em/libs/webaudio-tinysynth.min.js"></script>
  <script src="/jar_em/libs/BenzAMRRecorder.min.js"></script>
  <!-- J2ME.js core files -->
  <script src="/jar_em/bld/native.js" defer></script>
  <script src="/jar_em/config/default.js" defer></script>
  <script src="/jar_em/config/build.js" defer></script>
  <script src="/jar_em/config/urlparams.js" defer></script>
  <script src="/jar_em/bld/j2me.js" defer></script>
  <script src="/jar_em/bld/main-all.js" defer></script>
  <!-- Custom keymap override -->
  <script>
  // Custom keyboard mapping
  (function() {
    var keyDownTime_Star = 0;
    
    // Keyboard event handlers with custom mapping
    function handleKeydown(e) {
      // Prevent default for game keys
      var gameKey = false;
      var key = e.key.toUpperCase();
      
      // Check if MIDP is ready
      if (typeof MIDP === 'undefined' || !MIDP.sendKeyPress) {
        console.warn('MIDP not ready yet');
        return;
      }
      
      switch (key) {
        // Direction keys - WASD
        case 'W':
          MIDP.sendKeyPress(-1); // UP
          gameKey = true;
          break;
        case 'S':
          MIDP.sendKeyPress(-2); // DOWN
          gameKey = true;
          break;
        case 'A':
          MIDP.sendKeyPress(-3); // LEFT
          gameKey = true;
          break;
        case 'D':
          MIDP.sendKeyPress(-4); // RIGHT
          gameKey = true;
          break;
          
        // OK key - X
        case 'X':
          MIDP.sendKeyPress(-5); // OK/FIRE
          gameKey = true;
          break;
          
        // Soft keys - Q and E
        case 'Q':
          MIDP.sendKeyPress(-6); // LEFT SOFT KEY
          gameKey = true;
          break;
        case 'E':
          MIDP.sendKeyPress(-7); // RIGHT SOFT KEY
          gameKey = true;
          break;
          
        // Number keys mapping
        case 'Y':
          MIDP.sendKeyPress(49); // 1
          gameKey = true;
          break;
        case 'U':
          MIDP.sendKeyPress(50); // 2
          gameKey = true;
          break;
        case 'I':
          MIDP.sendKeyPress(51); // 3
          gameKey = true;
          break;
        case 'O':
          MIDP.sendKeyPress(52); // 4
          gameKey = true;
          break;
        case 'P':
          MIDP.sendKeyPress(53); // 5
          gameKey = true;
          break;
        case 'H':
          MIDP.sendKeyPress(54); // 6
          gameKey = true;
          break;
        case 'J':
          MIDP.sendKeyPress(55); // 7
          gameKey = true;
          break;
        case 'K':
          MIDP.sendKeyPress(56); // 8
          gameKey = true;
          break;
        case 'L':
          MIDP.sendKeyPress(57); // 9
          gameKey = true;
          break;
        case ';':
        case ':': // Handle both ; and :
          MIDP.sendKeyPress(48); // 0
          gameKey = true;
          break;
          
        // Special keys
        case '[':
        case '{': // Handle both [ and {
          if (keyDownTime_Star == 0) {
            keyDownTime_Star = Date.now();
          }
          MIDP.sendKeyPress(42); // *
          gameKey = true;
          break;
        case ']':
        case '}': // Handle both ] and }
          MIDP.sendKeyPress(35); // #
          gameKey = true;
          break;
          
        // Arrow keys support (in addition to WASD)
        case 'ARROWUP':
          MIDP.sendKeyPress(-1);
          gameKey = true;
          break;
        case 'ARROWDOWN':
          MIDP.sendKeyPress(-2);
          gameKey = true;
          break;
        case 'ARROWLEFT':
          MIDP.sendKeyPress(-3);
          gameKey = true;
          break;
        case 'ARROWRIGHT':
          MIDP.sendKeyPress(-4);
          gameKey = true;
          break;
        case 'ENTER':
          MIDP.sendKeyPress(-5);
          gameKey = true;
          break;
      }
      
      if (gameKey) {
        e.preventDefault();
        // Add visual feedback
        updateKeyVisual(key, true);
      }
    }
    
    function handleKeyup(e) {
      var key = e.key.toUpperCase();
      
      // Check if MIDP is ready
      if (typeof MIDP === 'undefined' || !MIDP.sendKeyRelease) {
        return;
      }
      
      switch (key) {
        // Direction keys - WASD
        case 'W':
          MIDP.sendKeyRelease(-1); // UP
          e.preventDefault();
          break;
        case 'S':
          MIDP.sendKeyRelease(-2); // DOWN
          e.preventDefault();
          break;
        case 'A':
          MIDP.sendKeyRelease(-3); // LEFT
          e.preventDefault();
          break;
        case 'D':
          MIDP.sendKeyRelease(-4); // RIGHT
          e.preventDefault();
          break;
          
        // OK key - X
        case 'X':
          MIDP.sendKeyRelease(-5); // OK/FIRE
          e.preventDefault();
          break;
          
        // Soft keys - Q and E
        case 'Q':
          MIDP.sendKeyRelease(-6); // LEFT SOFT KEY
          e.preventDefault();
          break;
        case 'E':
          MIDP.sendKeyRelease(-7); // RIGHT SOFT KEY
          e.preventDefault();
          break;
          
        // Number keys mapping
        case 'Y':
          MIDP.sendKeyRelease(49); // 1
          e.preventDefault();
          break;
        case 'U':
          MIDP.sendKeyRelease(50); // 2
          e.preventDefault();
          break;
        case 'I':
          MIDP.sendKeyRelease(51); // 3
          e.preventDefault();
          break;
        case 'O':
          MIDP.sendKeyRelease(52); // 4
          e.preventDefault();
          break;
        case 'P':
          MIDP.sendKeyRelease(53); // 5
          e.preventDefault();
          break;
        case 'H':
          MIDP.sendKeyRelease(54); // 6
          e.preventDefault();
          break;
        case 'J':
          MIDP.sendKeyRelease(55); // 7
          e.preventDefault();
          break;
        case 'K':
          MIDP.sendKeyRelease(56); // 8
          e.preventDefault();
          break;
        case 'L':
          MIDP.sendKeyRelease(57); // 9
          e.preventDefault();
          break;
        case ';':
        case ':':
          MIDP.sendKeyRelease(48); // 0
          e.preventDefault();
          break;
          
        // Special keys
        case '[':
        case '{':
          if (Date.now() - keyDownTime_Star > 1000) {
            document.getElementById("File").click();
          }
          keyDownTime_Star = 0;
          MIDP.sendKeyRelease(42); // *
          e.preventDefault();
          break;
        case ']':
        case '}':
          MIDP.sendKeyRelease(35); // #
          e.preventDefault();
          break;
          
        // Arrow keys support
        case 'ARROWUP':
          MIDP.sendKeyRelease(-1);
          e.preventDefault();
          break;
        case 'ARROWDOWN':
          MIDP.sendKeyRelease(-2);
          e.preventDefault();
          break;
        case 'ARROWLEFT':
          MIDP.sendKeyRelease(-3);
          e.preventDefault();
          break;
        case 'ARROWRIGHT':
          MIDP.sendKeyRelease(-4);
          e.preventDefault();
          break;
        case 'ENTER':
          MIDP.sendKeyRelease(-5);
          e.preventDefault();
          break;
      }
      
      // Remove visual feedback
      updateKeyVisual(key, false);
    }
    
    // Visual feedback for pressed keys
    function updateKeyVisual(key, pressed) {
      var buttonId = null;
      
      switch(key) {
        case 'W': buttonId = 'up'; break;
        case 'S': buttonId = 'down'; break;
        case 'A': buttonId = 'left'; break;
        case 'D': buttonId = 'right'; break;
        case 'X': buttonId = 'ok'; break;
        case 'Q': buttonId = 'choice'; break;
        case 'E': buttonId = 'back'; break;
        case 'Y': buttonId = 'num1'; break;
        case 'U': buttonId = 'num2'; break;
        case 'I': buttonId = 'num3'; break;
        case 'O': buttonId = 'num4'; break;
        case 'P': buttonId = 'num5'; break;
        case 'H': buttonId = 'num6'; break;
        case 'J': buttonId = 'num7'; break;
        case 'K': buttonId = 'num8'; break;
        case 'L': buttonId = 'num9'; break;
        case ';':
        case ':': buttonId = 'num0'; break;
        case '[':
        case '{': buttonId = 'star'; break;
        case ']':
        case '}': buttonId = 'pound'; break;
      }
      
      if (buttonId) {
        var button = document.getElementById(buttonId);
        if (button) {
          if (pressed) {
            button.classList.add('pressed');
          } else {
            button.classList.remove('pressed');
          }
        }
      }
    }
    
    // Wait for page load then attach listeners
    window.addEventListener('DOMContentLoaded', function() {
      // Attach keyboard listeners
      window.addEventListener('keydown', handleKeydown);
      window.addEventListener('keyup', handleKeyup);
      
      // Touch/Mouse support for virtual keypad
      var SupportsTouches = ('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch;
      var StartEvent = SupportsTouches ? "touchstart" : "mousedown";
      var EndEvent = SupportsTouches ? "touchend" : "mouseup";
      
      console.log('Input support - Touch:', SupportsTouches, 'StartEvent:', StartEvent, 'EndEvent:', EndEvent);
      
      // Touch/Mouse handlers remain the same as original
      window.addEventListener(StartEvent, function (e) {
        if (typeof MIDP === 'undefined' || !MIDP.sendKeyPress) return;
        
        e = e || window.event; 
        var button = e.srcElement || e.target; 
        var content = button.id;
        
        switch (content) {
          case 'up': MIDP.sendKeyPress(-1); break;
          case 'down': MIDP.sendKeyPress(-2); break;
          case 'right': MIDP.sendKeyPress(-4); break;
          case 'left': MIDP.sendKeyPress(-3); break;
          case 'ok': MIDP.sendKeyPress(-5); break;
          case 'choice': MIDP.sendKeyPress(-6); break;
          case 'back': MIDP.sendKeyPress(-7); break;
          case 'num1': MIDP.sendKeyPress(49); break;
          case 'num2': MIDP.sendKeyPress(50); break;
          case 'num3': MIDP.sendKeyPress(51); break;
          case 'num4': MIDP.sendKeyPress(52); break;
          case 'num5': MIDP.sendKeyPress(53); break;
          case 'num6': MIDP.sendKeyPress(54); break;
          case 'num7': MIDP.sendKeyPress(55); break;
          case 'num8': MIDP.sendKeyPress(56); break;
          case 'num9': MIDP.sendKeyPress(57); break;
          case 'num0': MIDP.sendKeyPress(48); break;
          case 'star':
            if (keyDownTime_Star == 0) {
              keyDownTime_Star = Date.now();
            }
            MIDP.sendKeyPress(42);
            break;
          case 'pound': MIDP.sendKeyPress(35); break;
        }
      });
      
      window.addEventListener(EndEvent, function (e) {
        if (typeof MIDP === 'undefined' || !MIDP.sendKeyRelease) return;
        
        e = e || window.event;
        var button = e.srcElement || e.target;
        var content = button.id;
        
        switch (content) {
          case 'up': MIDP.sendKeyRelease(-1); break;
          case 'down': MIDP.sendKeyRelease(-2); break;
          case 'right': MIDP.sendKeyRelease(-4); break;
          case 'left': MIDP.sendKeyRelease(-3); break;
          case 'ok': MIDP.sendKeyRelease(-5); break;
          case 'choice': MIDP.sendKeyRelease(-6); break;
          case 'back': MIDP.sendKeyRelease(-7); break;
          case 'num1': MIDP.sendKeyRelease(49); break;
          case 'num2': MIDP.sendKeyRelease(50); break;
          case 'num3': MIDP.sendKeyRelease(51); break;
          case 'num4': MIDP.sendKeyRelease(52); break;
          case 'num5': MIDP.sendKeyRelease(53); break;
          case 'num6': MIDP.sendKeyRelease(54); break;
          case 'num7': MIDP.sendKeyRelease(55); break;
          case 'num8': MIDP.sendKeyRelease(56); break;
          case 'num9': MIDP.sendKeyRelease(57); break;
          case 'num0': MIDP.sendKeyRelease(48); break;
          case 'star':
            if (Date.now() - keyDownTime_Star > 1000) {
              document.getElementById("File").click();
            }
            keyDownTime_Star = 0;
            MIDP.sendKeyRelease(42);
            break;
          case 'pound': MIDP.sendKeyRelease(35); break;
        }
      });
    });
  })();
  </script>
  <!-- Don't load default keymap.js since we're providing custom mapping -->
  <!-- <script src="/jar_em/keymap.js" defer></script> -->
  <script>
  // Main initialization
  (function() {
    const JAR_URL = '0104/attachments/9E921054.dat';
    const JAR_NAME = 'bounceTales-240.jar';
    const UNIQUE_ID = 'jar_c338bc67';
    
    // Status update function
    function updateStatus(message, state) {
      const statusText = document.getElementById(UNIQUE_ID + '-status-text');
      const statusLed = document.getElementById(UNIQUE_ID + '-status-led');
      
      if (statusText) {
        statusText.textContent = message;
      }
      
      if (statusLed && state === 'success') {
        statusLed.classList.add('active');
      }
    }
    
    // Function to download and install JAR
    async function downloadAndInstallJAR() {
      const loadingMsg = document.getElementById(UNIQUE_ID + '-loading-msg');
      try {
        updateStatus('Downloading...', 'loading');
        if (loadingMsg) loadingMsg.textContent = 'DOWNLOADING...';
        
        console.log('Downloading JAR from:', JAR_URL);
        const response = await fetch(JAR_URL);
        if (!response.ok) {
          throw new Error('Failed to download JAR: ' + response.status);
        }
        
        const arrayBuffer = await response.arrayBuffer();
        console.log('JAR downloaded, size:', arrayBuffer.byteLength);
        
        updateStatus('Installing...', 'loading');
        if (loadingMsg) loadingMsg.textContent = 'INSTALLING...';
        
        // Wait for JARStore to be available and install
        return new Promise((resolve, reject) => {
          let attempts = 0;
          const maxAttempts = 100;
          const checkAndInstall = setInterval(() => {
            attempts++;
            if (typeof JARStore !== 'undefined' && JARStore.installJAR) {
              clearInterval(checkAndInstall);
              JARStore.installJAR(JAR_NAME, arrayBuffer).then(
                function() {
                  console.log('JAR installed successfully:', JAR_NAME);
                  updateStatus('Installed', 'success');
                  if (loadingMsg) loadingMsg.textContent = 'STARTING...';
                  resolve();
                },
                function(error) {
                  console.error('Failed to install JAR:', error);
                  reject(new Error('JAR installation failed: ' + error));
                }
              );
            } else if (attempts >= maxAttempts) {
              clearInterval(checkAndInstall);
              reject(new Error('JARStore not available (timeout)'));
            }
          }, 100);
        });
      } catch (error) {
        console.error('Failed to download/install JAR:', error);
        updateStatus('Error', 'error');
        if (loadingMsg) {
          loadingMsg.textContent = 'ERROR!';
          loadingMsg.style.color = '#ff4444';
        }
        throw error;
      }
    }
    
    // Auto start the game
    async function autoStart() {
      const loadingMsg = document.getElementById(UNIQUE_ID + '-loading-msg');
      try {
        await new Promise(resolve => {
          let checkCount = 0;
          const checkMain = setInterval(() => {
            checkCount++;
            if (typeof main === 'function') {
              clearInterval(checkMain);
              resolve();
            } else if (checkCount > 50) {
              clearInterval(checkMain);
              resolve();
            }
          }, 100);
        });
        
        if (typeof start === 'function') {
          console.log('Starting game with config:', v_config);
          updateStatus('Running', 'success');
		  const check_load = document.getElementById('download-screen');
		  if (check_load) location.reload();
		  console.log('initialize Running...',loadingMsg.textContent);
          if (loadingMsg) loadingMsg.style.display = 'none';
          start();
        } else {
          throw new Error('start() function not found');
        }
      } catch (error) {
        console.error('Failed to start game:', error);
        updateStatus('Start failed', 'error');
        if (loadingMsg) {
          loadingMsg.textContent = 'FAILED TO START';
          loadingMsg.style.color = '#ff4444';
        }
      }
    }
    
    // Main initialization
    async function initialize() {
      try {
        console.log('Starting J2ME initialization...');
        await downloadAndInstallJAR();
        await new Promise(resolve => setTimeout(resolve, 1000));
        await autoStart();
      } catch (error) {
        console.error('Initialization failed:', error);
        const loadingMsg = document.getElementById(UNIQUE_ID + '-loading-msg');
        if (loadingMsg) {
          loadingMsg.innerHTML = 'FAILED<br><button onclick="location.reload()" style="margin-top:10px;padding:5px 10px;background:#4d94ff;border:none;color:#fff;border-radius:4px;cursor:pointer;">RETRY</button>';
          loadingMsg.style.color = '#ff4444';
        }
      }
    }
    
    // Start when page is fully loaded
    window.addEventListener('load', function() {
      console.log('Page loaded, starting initialization...');
      setTimeout(initialize, 3000);
    });
  })();
  </script>
</div>  

        
    </article>
</div>



<footer>
    <div class="footer center text_center">
        <p><font size="2">Website is best viewed in 800x600 or higher equivalent resolution.</font></p>
        <hr>
        <p><img src="/CC-BY-SA.png" height="31">&nbsp;<img src="/linuxnow.gif">&nbsp;<img src="/anybrowser.gif"></p>
        <p><font size="2">Copyright © 2015-2025 Jianxin Zhang. All rights reserved.<br>
            Unless otherwise noted, content on this site is licensed under CC BY-SA 4.0.</font></p>
    </div>
</footer>
</body>
</html>