<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RocketMQ Install — NeoJ's Web Page</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/a.css">
    <link rel="stylesheet" href="/pygments.css">
    <style>
        .password-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .password-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            text-align: center;
            border-radius: 5px;
        }

        .password-input {
            width: 200px;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .password-submit {
            padding: 8px 15px;
            background-color: #008000;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 3px;
            margin: 5px;
        }

        .password-submit:hover {
            background-color: #006600;
        }

        .password-notice {
            background-color: #ffffcc;
            border: 2px solid #ffcc00;
            padding: 15px;
            margin: 30px 0;
            text-align: center;
            border-radius: 5px;
        }

        .error-message {
            color: red;
            font-size: 12px;
            margin-top: 10px;
            min-height: 20px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #008000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<header>
    <nav>
        <table width="620" border="1" class="center">
            <tbody>
            <tr>
                <td width="64" rowspan="2">
                    <img src="/avatar.png" width="64">
                </td>
                <td align="center" colspan="5">
                    <font size="5"><b><font color="#008000">NeoJ</font>'s Web Page</b></font>
                </td>
                <td width="100" align="center" rowspan="2">
                    Last Update:<br>Sep. 17, 2025
                </td>
            </tr>
            <tr>
                <td align="center" width="82">
                    <a href="/">Index</a>
                </td>
                <td class="active" align="center" width="82">
                    <a href="/">Blog</a>
                </td>
                <td align="center" width="82">
                    <a href="https://github.com/uk0">Projects</a>
                </td>
                <td align="center" width="82">
                    <a href="https://github.com/uk0">GitHub</a>
                </td>
                <td align="center" width="82">
                    <a href="/about.html">About</a>
                </td>
            </tr>
            </tbody>
        </table>
    </nav>
</header>

<div class="page center">
    <h1 class="text_center">RocketMQ Install</h1>

    <p class="meta text_center">
        2025-09-17
    </p>

    <article id="article-content">
        <h1>RocketMQ Install</h1>
<p>RocketMQ消息队列安装以及使用，RocketMQ安装常见问题，以及解决方案。</p>
<h2>摘要: 我要装个RocketMQ</h2>
<h1>rocketmq 安装</h1>
<p>安装rocketmq需要环境：<br>
1、jdk1.7以上<br>
2、maven<br>
3、git</p>
<p><em>jdk1.8</em></p>
<pre><code class="language-bash">wget http://112firshme11224.test.upcdn.net/blog/tmp/jdk-8u92-linux-x64.tar.gz  
</code></pre>
<p><em>maven下载：</em></p>
<pre><code class="language-bash">wget http://mirrors.hust.edu.cn/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz  
  
tar xf apache-maven-3.3.9-bin.tar.gz -C /opt/  
</code></pre>
<p><em>git下载：</em></p>
<pre><code class="language-bash">yum install git -y  
  
</code></pre>
<p><em>环境变量如下：</em></p>
<pre><code class="language-bash">export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL  
export JAVA_HOME=/opt/jdk/jdk1.8.0_65  
export JRE_HOME=/opt/jdk/jdk1.8.0_65/jre  
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH  
export PATH=$PATH:$JAVA_HOME/bin/  
export PATH=$PATH:/usr/local/go/bin  
export GOPATH=/usr/local/  
export M2_HOME=/opt/apache-maven-3.3.9  
export PATH=$PATH:$M2_HOME/bin  
export ROCKETMQ_HOME=/opt/RocketMQ-3.5.8/devenv  
export NAMESRV_ADDR=127.0.0.1:9876  
</code></pre>
<p><em>使配置文件生效</em></p>
<pre><code class="language-bash">source /etc/profile  
</code></pre>
<p><em>检测maven</em></p>
<pre><code class="language-bash">[root@dscn1 ~]# mvn -v  
Apache Maven 3.3.9 (bb52d8502b132ec0a5a3f4c09453c07478323dc5; 2015-11-11T00:41:47+08:00)  
Maven home: /opt/apache-maven-3.3.9  
Java version: 1.8.0_65, vendor: Oracle Corporation  
Java home: /opt/jdk/jdk1.8.0_65/jre  
Default locale: zh_CN, platform encoding: UTF-8  
OS name: &quot;linux&quot;, version: &quot;2.6.32-573.22.1.el6.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;  
</code></pre>
<p>[toc]</p>
<p>##一、正式开始安装rocketmq<br>
1、下载安装</p>
<pre><code class="language-text">a）wget https://github.com/alibaba/RocketMQ/archive/v3.5.8.tar.gz ###下载包  
b）tar -xf v3.5.8.tar.gz -C /opt/ ###解压  
c）cd /opt/RocketMQ-3.5.8 ###进入解压后目录  
d）sh install.sh ###进行安装(下载国外的数据，时间较长)  
</code></pre>
<p>2、修改文件内存</p>
<pre><code class="language-bash">cd /opt/RocketMQ-3.5.8/devenv/bin  
#vim修改runbroker.sh、runserver.sh两个文件  
-------------------------------------  
JAVA_OPT=&quot;${JAVA_OPT} -server -Xms512m -Xmx512m -Xmn256m -XX:PermSize=128m -XX:MaxPermSize=320m&quot; ###Xms启动时内存，Xmx最大内存，Xmn最小内存  
--------------------------------------  
</code></pre>
<p>3、启动<code>nameserver</code></p>
<pre><code class="language-bash">nohup sh mqnamesrv &gt;/var/log/ns.log 2&gt;&amp;1 &amp;  
</code></pre>
<p>4、验证<code>nameserver</code>是否启动：</p>
<pre><code class="language-bash">tail -f /var/log/ns.log ###查看日志有无错误信息  
</code></pre>
<p>5、启动<code>broker</code><br>
在启动<code>borker</code>之前需要指定<code>nameserver</code>地址：</p>
<pre><code class="language-bash">echo &quot;export NAMESRV_ADDR=127.0.0.1:9876&quot; &gt;&gt; /etc/profile ###写入到环境变量，或者直接  
-n来指定  
nohup sh mqbroker -n 192.168.0.106:9876 autoCreateTopicEnable=true &gt; /var/log/mq.log 2&gt;&amp;1 &amp;  
</code></pre>
<p>6、检验是否开启</p>
<pre><code class="language-bash">tail -f /var/log/mq.log ###查看日志有无错误信息  
</code></pre>
<p>7、关闭的命令：</p>
<pre><code class="language-bash">sh mqshutdown namesrv  
sh mqshutdown broker  
</code></pre>
<p>8、创建队列</p>
<pre><code class="language-bash">sh mqadmin updateTopic -b &quot;192.168.0.106:10911&quot; -t Topic1 -r 10 -w 10 ###-b broker的ip和端口 -t java程序中定义的名字  
</code></pre>
<p>9、更改broker配置文件，更改ip,使外网可以访问</p>
<pre><code class="language-bash">sh mqadmin updateBrokerConfig -b 192.168.0.106:10911 -k brokerIP1 -v 192.168.0.106  
</code></pre>
<p>10、以此输入下面两个命令：</p>
<pre><code class="language-bash">bash tools.sh com.alibaba.rocketmq.example.quickstart.Producer ###生产者(生产队列)  
  
bash tools.sh com.alibaba.rocketmq.example.quickstart.Consumer ###消费者（清理队列）  
</code></pre>
<blockquote>
<p>如果报错是内存不够，就改<code>runbroker.sh</code>、<code>runserver.sh</code>两个文件</p>
<p>如果启动报错是不知道主机：<br>
检查/etc/sysconfig/network 中的记录的hostname是否和/etc/hosts中的主机名绑定一致，如果不一致请确保一致<br>
在/etc/hosts中添加 192.168.1.118 hostname的名称(master01)跟/etc/sysconfig/network一样(master01)</p>
</blockquote>
<blockquote>
<p>开启9876rocketmq的nameserver端口 #vim /etc/sysconfig/iptables</p>
</blockquote>
<h2>二、一主一从的配置</h2>
<p>除了启动步骤不同。其余与上面一主的配置相同：<br>
1、修改/opt/RocketMQ-3.5.8/devenv/bin/runbroker.sh、runserver.sh两个文件：</p>
<pre><code class="language-bash">JAVA_OPT=&quot;${JAVA_OPT} -server -Xms512m -Xmx512m -Xmn256m -XX:PermSize=128m -XX:MaxPermSize=320m&quot; ###Xms启动时内存，Xmx最大内存，Xmn最小内存  
</code></pre>
<p>2、主的机器修改/opt/RocketMQ-3.5.8/devenv/conf/2m-2s-async/broker-a.properties</p>
<pre><code class="language-bash">namesrvAddr=192.168.0.106:9876;192.168.0.107:9876  
brokerIP1=192.168.0.106  
brokerClusterName=DefaultCluster  
brokerName=broker-a  
brokerId=0  
deleteWhen=04  
fileReservedTime=48  
brokerRole=ASYNC_MASTER  
flushDiskType=ASYNC_FLUSH  
storePathRootDir=/opt/RocketMQ-3.4.6  
storePathCommitLog=/opt/RocketMQ-3.4.6/log/commitlog  
</code></pre>
<p>3、从的机器修改/opt/RocketMQ-3.5.8/devenv/conf/2m-2s-async/broker-a-s.properties</p>
<pre><code class="language-bash">namesrvAddr=192.168.0.106:9876;192.168.0.107:9876  
brokerIP1=192.168.0.107  
brokerClusterName=DefaultCluster  
brokerName=broker-a  
brokerId=1  
deleteWhen=04  
fileReservedTime=48  
brokerRole=SLAVE  
flushDiskType=ASYNC_FLUSH  
storePathRootDir=/opt/RocketMQ-3.4.6  
storePathCommitLog=/opt/RocketMQ-3.4.6/log/commitlog  
</code></pre>
<blockquote>
<p>参考内容和解释如下：</p>
</blockquote>
<pre><code class="language-bash">#所属集群名字  
brokerClusterName=rocketmq-cluster  
#broker名字，注意此处不同的配置文件填写的不一样  
brokerName=broker-a|broker-b  
#0 表示 Master， &gt;0 表示 Slave  
brokerId=0  
#nameServer地址，分号分割  
namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876  
#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数  
defaultTopicQueueNums=4  
#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭  
autoCreateTopicEnable=true  
#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭  
autoCreateSubscriptionGroup=true  
#Broker 对外服务的监听端口  
listenPort=10911  
#删除文件时间点，默认凌晨 0点  
deleteWhen=00  
#文件保留时间，默认 48 小时  
fileReservedTime=120  
#commitLog每个文件的大小默认1G  
mapedFileSizeCommitLog=1073741824  
#ConsumeQueue每个文件默认存30W条，根据业务情况调整  
mapedFileSizeConsumeQueue=300000  
#destroyMapedFileIntervalForcibly=120000  
#redeleteHangedFileInterval=120000  
#检测物理文件磁盘空间  
diskMaxUsedSpaceRatio=88  
#存储路径  
storePathRootDir=/opt/rocketmq/data  
#commitLog 存储路径  
storePathCommitLog=/opt/rocketmq/data/commitlog  
#消费队列存储路径存储路径  
storePathConsumeQueue=/opt/rocketmq/data/consumequeue  
#消息索引存储路径  
storePathIndex=/opt/rocketmq/data/index  
#checkpoint 文件存储路径  
storeCheckpoint=/opt/rocketmq/data/checkpoint  
#abort 文件存储路径  
abortFile=/opt/rocketmq/data/abort  
#限制的消息大小  
maxMessageSize=65536  
#flushCommitLogLeastPages=4  
#flushConsumeQueueLeastPages=2  
#flushCommitLogThoroughInterval=10000  
#flushConsumeQueueThoroughInterval=60000  
#Broker 的角色  
#- ASYNC_MASTER 异步复制Master  
#- SYNC_MASTER 同步双写Master  
#- SLAVE  
brokerRole=ASYNC_MASTER  
#刷盘方式  
#- ASYNC_FLUSH 异步刷盘  
#- SYNC_FLUSH 同步刷盘  
flushDiskType=ASYNC_FLUSH  
#checkTransactionMessageEnable=false  
#发消息线程池数量  
#sendMessageThreadPoolNums=128  
#拉消息线程池数量  
#pullMessageThreadPoolNums=128  
</code></pre>
<p>4、两个机器上都启动nameserver:</p>
<pre><code class="language-bash">nohup sh mqnamesrv &gt;/var/log/ns.log 2&gt;&amp;1 &amp;  
</code></pre>
<p>5、主的机器启动broker：</p>
<pre><code class="language-bash">nohup sh mqbroker -c ../conf/2m-2s-async/broker-a.properties &gt; /var/log/mq.log 2&gt;&amp;1 &amp;  
</code></pre>
<p>6、从的机器启动broker：</p>
<pre><code class="language-bash">nohup sh mqbroker -c ../conf/2m-2s-async/broker-a-s.properties &gt; /var/log/mq.log 2&gt;&amp;1 &amp;  
</code></pre>
<h2>运行成功的图！</h2>
<img src="0067/attachments/6FE12E06.webp" alt="rocketmq-p.png.webp" loading="lazy" />  
<img src="0067/attachments/6474B39C.webp" alt="rocketmq-c.png.webp" loading="lazy" />  
<p><a href="https://juejin.im/post/5a31e9c5f265da431d3cb134"><img src="https://badge.juejin.im/entry/5a31ea02f265da4319564878/likes.svg?style=plastic" alt=""></a></p>


        
    </article>
</div>



<footer>
    <div class="footer center text_center">
        <p><font size="2">Website is best viewed in 800x600 or higher equivalent resolution.</font></p>
        <hr>
        <p><img src="/CC-BY-SA.png" height="31">&nbsp;<img src="/linuxnow.gif">&nbsp;<img src="/anybrowser.gif"></p>
        <p><font size="2">Copyright © 2015-2025 Jianxin Zhang. All rights reserved.<br>
            Unless otherwise noted, content on this site is licensed under CC BY-SA 4.0.</font></p>
    </div>
</footer>
</body>
</html>