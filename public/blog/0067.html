<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RocketMQ Install</title>
    <link rel="icon" href="../favicon.ico">
    
    <link rel="stylesheet" href="../a.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body class="win95-bg">

<table class="outer" width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
        <td align="center" valign="top">
            <table class="frame" width="650" border="0" cellspacing="0" cellpadding="6">
                
                <tr>
                    <td class="avatar-cell" width="64" rowspan="2" align="center">
                        <a href="../index.html">
                            <img class="avatar" src="../avatar.png" width="48" height="48" alt="avatar">
                        </a>
                    </td>
                    <td class="titlebar" align="center">
                        <h2 class="title" style="margin:4px 0;">RocketMQ Install</h2>
                        <div class="post-category">Category: blog</div>
                    </td>
                    <td class="infobar" width="160" rowspan="2" align="center">
                        <a href="../index.html">Home</a>
                    </td>
                </tr>
                
                <tr>
                    <td class="nav" align="center">
                        <a href="../index.html">Index</a>
                        <span class="sep">|</span>
                        <a href="../about.html">About</a>
                    </td>
                </tr>

                
                <tr>
                    <td colspan="3">
                        <hr class="hr-etched">
                    </td>
                </tr>

                
                <tr>
                    <td class="content" colspan="3">
                        <div class="post-body"><h1>RocketMQ Install</h1>
<p>RocketMQ消息队列安装以及使用，RocketMQ安装常见问题，以及解决方案。</p>
<h2>摘要: 我要装个RocketMQ</h2>
<h1>rocketmq 安装</h1>
<p>安装rocketmq需要环境：<br>
1、jdk1.7以上<br>
2、maven<br>
3、git</p>
<p>*jdk1.8*</p>
<pre><code class="language-*bash*"></code></pre>
<p>*maven下载：*</p>
<pre><code class="language-*bash*wget">    
tar xf apache-maven-3.3.9-bin.tar.gz -C /opt/    
</code></pre>
<p>*git下载：*</p>
<pre><code class="language-*bash*yum">    
</code></pre>
<p>*环境变量如下：*</p>
<pre><code class="language-*bash*export">export JAVA\_HOME=/opt/jdk/jdk1.8.0\_65    
export JRE\_HOME=/opt/jdk/jdk1.8.0\_65/jre    
export CLASSPATH=.:$JAVA\_HOME/lib/dt.jar:$JAVA\_HOME/lib/tools.jar:$JRE\_HOME/lib:$CLASSPATH    
export PATH=$PATH:$JAVA\_HOME/bin/    
export PATH=$PATH:/usr/local/go/bin    
export GOPATH=/usr/local/    
export M2\_HOME=/opt/apache-maven-3.3.9    
export PATH=$PATH:$M2\_HOME/bin    
export ROCKETMQ\_HOME=/opt/RocketMQ-3.5.8/devenv    
export NAMESRV\_ADDR=127.0.0.1:9876    
</code></pre>
<p>*使配置文件生效*</p>
<pre><code class="language-*bash*source"></code></pre>
<p>*检测maven*</p>
<pre><code class="language-*bash*[root@dscn1">Apache Maven 3.3.9 (bb52d8502b132ec0a5a3f4c09453c07478323dc5; 2015-11-11T00:41:47+08:00)    
Maven home: /opt/apache-maven-3.3.9    
Java version: 1.8.0\_65, vendor: Oracle Corporation    
Java home: /opt/jdk/jdk1.8.0\_65/jre    
Default locale: zh\_CN, platform encoding: UTF-8    
OS name: &quot;linux&quot;, version: &quot;2.6.32-573.22.1.el6.x86\_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;    
</code></pre>
<p>[toc]</p>
<p>##一、正式开始安装rocketmq<br>
1、下载安装</p>
<pre><code class="language-*text*a）wget">b）tar -xf v3.5.8.tar.gz -C /opt/ ###解压    
c）cd /opt/RocketMQ-3.5.8 ###进入解压后目录    
d）sh install.sh ###进行安装(下载国外的数据，时间较长)    
</code></pre>
<p>2、修改文件内存</p>
<pre><code class="language-*bash*cd">#vim修改runbroker.sh、runserver.sh两个文件    
-------------------------------------    
JAVA\_OPT=&quot;${JAVA\_OPT} -server -Xms512m -Xmx512m -Xmn256m -XX:PermSize=128m -XX:MaxPermSize=320m&quot; ###Xms启动时内存，Xmx最大内存，Xmn最小内存    
--------------------------------------    
</code></pre>
<p>3、启动<code>nameserver</code></p>
<pre><code class="language-*bash*nohup"></code></pre>
<p>4、验证<code>nameserver</code>是否启动：</p>
<pre><code class="language-*bash*tail"></code></pre>
<p>5、启动<code>broker</code><br>
在启动<code>borker</code>之前需要指定<code>nameserver</code>地址：</p>
<pre><code class="language-*bash*echo">-n来指定    
nohup sh mqbroker -n 192.168.0.106:9876 autoCreateTopicEnable=true &gt; /var/log/mq.log 2&gt;&amp;1 &amp;    
</code></pre>
<p>6、检验是否开启</p>
<pre><code class="language-*bash*tail"></code></pre>
<p>7、关闭的命令：</p>
<pre><code class="language-*bash*sh">sh mqshutdown broker    
</code></pre>
<p>8、创建队列</p>
<pre><code class="language-*bash*sh"></code></pre>
<p>9、更改broker配置文件，更改ip,使外网可以访问</p>
<pre><code class="language-*bash*sh"></code></pre>
<p>10、以此输入下面两个命令：</p>
<pre><code class="language-*bash*bash">    
bash tools.sh com.alibaba.rocketmq.example.quickstart.Consumer ###消费者（清理队列）    
</code></pre>
<blockquote>
<p>如果报错是内存不够，就改<code>runbroker.sh</code>、<code>runserver.sh</code>两个文件</p>
<p>如果启动报错是不知道主机：<br>
检查/etc/sysconfig/network 中的记录的hostname是否和/etc/hosts中的主机名绑定一致，如果不一致请确保一致<br>
在/etc/hosts中添加 192.168.1.118 hostname的名称(master01)跟/etc/sysconfig/network一样(master01)</p>
</blockquote>
<blockquote>
<p>开启9876rocketmq的nameserver端口 #vim /etc/sysconfig/iptables</p>
</blockquote>
<h2>二、一主一从的配置</h2>
<p>除了启动步骤不同。其余与上面一主的配置相同：<br>
1、修改/opt/RocketMQ-3.5.8/devenv/bin/runbroker.sh、runserver.sh两个文件：</p>
<pre><code class="language-*bash*JAVA_OPT=&quot;${JAVA_OPT}"></code></pre>
<p>2、主的机器修改/opt/RocketMQ-3.5.8/devenv/conf/2m-2s-async/broker-a.properties</p>
<pre><code class="language-*bash*namesrvAddr=192.168.0.106:9876;192.168.0.107:9876">brokerIP1=192.168.0.106    
brokerClusterName=DefaultCluster    
brokerName=broker-a    
brokerId=0    
deleteWhen=04    
fileReservedTime=48    
brokerRole=ASYNC\_MASTER    
flushDiskType=ASYNC\_FLUSH    
storePathRootDir=/opt/RocketMQ-3.4.6    
storePathCommitLog=/opt/RocketMQ-3.4.6/log/commitlog    
</code></pre>
<p>3、从的机器修改/opt/RocketMQ-3.5.8/devenv/conf/2m-2s-async/broker-a-s.properties</p>
<pre><code class="language-*bash*namesrvAddr=192.168.0.106:9876;192.168.0.107:9876">brokerIP1=192.168.0.107    
brokerClusterName=DefaultCluster    
brokerName=broker-a    
brokerId=1    
deleteWhen=04    
fileReservedTime=48    
brokerRole=SLAVE    
flushDiskType=ASYNC\_FLUSH    
storePathRootDir=/opt/RocketMQ-3.4.6    
storePathCommitLog=/opt/RocketMQ-3.4.6/log/commitlog    
</code></pre>
<blockquote>
<p>参考内容和解释如下：</p>
</blockquote>
<pre><code class="language-*bash*#所属集群名字">brokerClusterName=rocketmq-cluster    
#broker名字，注意此处不同的配置文件填写的不一样    
brokerName=broker-a|broker-b    
#0 表示 Master， &gt;0 表示 Slave    
brokerId=0    
#nameServer地址，分号分割    
namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876    
#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数    
defaultTopicQueueNums=4    
#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭    
autoCreateTopicEnable=true    
#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭    
autoCreateSubscriptionGroup=true    
#Broker 对外服务的监听端口    
listenPort=10911    
#删除文件时间点，默认凌晨 0点    
deleteWhen=00    
#文件保留时间，默认 48 小时    
fileReservedTime=120    
#commitLog每个文件的大小默认1G    
mapedFileSizeCommitLog=1073741824    
#ConsumeQueue每个文件默认存30W条，根据业务情况调整    
mapedFileSizeConsumeQueue=300000    
#destroyMapedFileIntervalForcibly=120000    
#redeleteHangedFileInterval=120000    
#检测物理文件磁盘空间    
diskMaxUsedSpaceRatio=88    
#存储路径    
storePathRootDir=/opt/rocketmq/data    
#commitLog 存储路径    
storePathCommitLog=/opt/rocketmq/data/commitlog    
#消费队列存储路径存储路径    
storePathConsumeQueue=/opt/rocketmq/data/consumequeue    
#消息索引存储路径    
storePathIndex=/opt/rocketmq/data/index    
#checkpoint 文件存储路径    
storeCheckpoint=/opt/rocketmq/data/checkpoint    
#abort 文件存储路径    
abortFile=/opt/rocketmq/data/abort    
#限制的消息大小    
maxMessageSize=65536    
#flushCommitLogLeastPages=4    
#flushConsumeQueueLeastPages=2    
#flushCommitLogThoroughInterval=10000    
#flushConsumeQueueThoroughInterval=60000    
#Broker 的角色    
#- ASYNC\_MASTER 异步复制Master    
#- SYNC\_MASTER 同步双写Master    
#- SLAVE    
brokerRole=ASYNC\_MASTER    
#刷盘方式    
#- ASYNC\_FLUSH 异步刷盘    
#- SYNC\_FLUSH 同步刷盘    
flushDiskType=ASYNC\_FLUSH    
#checkTransactionMessageEnable=false    
#发消息线程池数量    
#sendMessageThreadPoolNums=128    
#拉消息线程池数量    
#pullMessageThreadPoolNums=128    
</code></pre>
<p>4、两个机器上都启动nameserver:</p>
<pre><code class="language-*bash*nohup"></code></pre>
<p>5、主的机器启动broker：</p>
<pre><code class="language-*bash*"></code></pre>
<p>6、从的机器启动broker：</p>
<pre><code class="language-*bash*"></code></pre>
<h2>运行成功的图！</h2>
<img src="0067/attachments/6FE12E06.webp" alt="rocketmq-p.png.webp" loading="lazy" />    
<img src="0067/attachments/6474B39C.webp" alt="rocketmq-c.png.webp" loading="lazy" />    
<p><a href="https://juejin.im/post/5a31e9c5f265da431d3cb134"><img src="https://badge.juejin.im/entry/5a31ea02f265da4319564878/likes.svg?style=plastic" alt=""></a></p>
</div>
                    </td>
                </tr>

                
                <tr>
                    <td colspan="3" align="right" style="font-size:small;">
                        <a href="#">↑ Back to top</a>
                    </td>
                </tr>
            </table>
        </td>
    </tr>

    
    <tr>
        <td align="center" valign="bottom" height="60">
            <font size="-1">
                <a href="../index.html">Back to Home</a>
            </font>
        </td>
    </tr>
</table>
</body>
</html>