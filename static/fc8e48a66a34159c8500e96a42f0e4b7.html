<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>seerverless操作hdfs上传数据。</title>
<meta name="description" content="serverless 通过 python 操作hdfs">
<meta name="keywords" content="hdfs">
<style>
body {
  font-family: sans-serif;
  background-color: #f0f0f0;
  color: #333;
  max-width: 820px;
  margin: 0 auto;
  padding: 20px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  transition: background-color 0.3s ease;
}

h1, h2, h3, h4, h5, h6 {
  text-align: center;
}

h1 {
  font-size: 20px;
}

h2 {
  font-size: 18px;
}

h3 {
  font-size: 16px;
}

h4 {
  font-size: 14px;
}

h5 {
  font-size: 12px;
}

h6 {
  font-size: 11px;
}

pre {
  background-color: #f0f0f0;
  padding: 10px;
  border-radius: 5px;
  overflow-x: auto;
}

code {
  font-family: monospace;
  background-color: #f0f0f0;
  padding: 2px 4px;
  border-radius: 3px;
  font-size: 14px;
}

.night-mode {
  background-color: #222;
  color: #eee;
}

.night-mode pre {
  background-color: #333;
}

.night-mode code {
  background-color: #333;
  color: #eee;
}

footer {
  text-align: center;
  margin-top: 20px;
  font-size: 12px;
}
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var now = new Date();
    var hour = now.getHours();
    if (hour >= 18 || hour < 6) {
      document.body.classList.add('night-mode');
    }
  });
</script>
</head>
<body>
<h1>seerverless操作hdfs上传数据。</h1>
<p>这只是一次尝试。。。。</p>
<h2> kubernetes serverless 操作 Hadoop Hdfs </h2>
<p>serverless Python 操作hdfs</p>
<pre><code class="language-bash"># /usr/bin/env python
# coding=utf-8

import paramiko
import os
from hdfs import Client
from bottle import route, run
from bottle import request

client = Client("http://hdfs-web-svc.cloudera:50070", root="/", timeout=100, session=False)
# 文件上传的HTML模板，这里没有额外去写html模板了，直接写在这里，方便点吧
@route('/upload')
def upload():
    return '''
        <html>
            <head>
            </head>
            <body>
                <form action"/upload" method="post" enctype="multipart/form-data">
                    <input type="file" name="data" />
                    <input type="submit" value="Upload" />
                </form>
            </body>
        </html>
    '''


# 文件上传，overwrite=True为覆盖原有的文件，
# 如果不加这参数，当服务器已存在同名文件时，将返回“IOError: File exists.”错误
@route('/upload', method='POST')
def doupload():
    upload = request.files.getall('data')
    for meta in upload:
        buf = meta.file.read()
        name, ext = os.path.splitext(meta.filename)
        if ext not in ('.jar', '.tar'):
            return 'File extension not allowed. type [JAR]'
        path = '/task/mr/' + name + ext
        # ssh root@agent-2.agent-svc.cloudera.svc.cluster.local
        print("--------------save Task To" + path)
        with client.write(path, overwrite=True) as writer:
            writer.write(buf);

    return 'ok'
</code></pre>
<p>serverless.yml</p>
<pre><code class="language-yaml"># Welcome to Serverless!
#
# For full config options, check the kubeless plugin docs:
#    https://github.com/serverless/serverless-kubeless
#
# For documentation on kubeless itself:
#    http://kubeless.io

# Update the service name below with your own service name
service: put-taskjar

# Please ensure the serverless-kubeless provider plugin is installed globally.
# $ npm install -g serverless-kubeless
#
# ...before installing project dependencies to register this provider.
# $ npm install

provider:
  name: kubeless
  namespace: ${env:K8S_NAMESPACE, 'cloudera'}
  runtime: python2.7

plugins:
  - serverless-kubeless

functions:
  upload:
    handler: task.upload

</code></pre>
<p>具体信息看 第一条关于 serverless 的文章。</p>
<footer>
Power By Gemini TextGenerate 2024-09-16
</footer>
</body>
</html>