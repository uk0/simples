<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>seerverless操作hdfs上传数据。</title>
    <meta name="description" content="serverless 通过 python 操作hdfs">
    <meta name="keywords" content="hdfs">
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 0;
            max-width: 820px;
            margin: 0 auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        h1, h2, h3, h4, h5, h6 {
            text-align: center;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 20px;
        }

        h2 {
            font-size: 18px;
        }

        h3 {
            font-size: 16px;
        }

        h4 {
            font-size: 14px;
        }

        h5 {
            font-size: 12px;
        }

        h6 {
            font-size: 11px;
        }

        code {
            background-color: #222222;
            color: #ff7f50;
            padding: 2px 4px;
            border-radius: 4px;
        }

        pre {
            background-color: #222222;
            color: #ff7f50;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }

        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }

        footer {
            text-align: center;
            padding: 10px 0;
            font-size: 12px;
            color: #888888;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
        
        const seed = 4538978253;
        const random = () => Math.sin(seed++) * 10000 % 1;

        const currentHour = new Date().getHours();
        if (currentHour >= 18 || currentHour < 6) {
            document.body.style.backgroundColor = '#111111';
        } else {
            document.body.style.backgroundColor = '#333333';
        }
    </script>
</head>
<body>
    <h1>seerverless操作hdfs上传数据。</h1>
    <p>这只是一次尝试。。。。</p>
    <h2> kubernetes serverless 操作 Hadoop Hdfs </h2>
    <ul>
        <li>serverless Python 操作hdfs</li>
    </ul>
    <pre><code class="bash">
# /usr/bin/env python
# coding=utf-8

import paramiko
import os
from hdfs import Client
from bottle import route, run
from bottle import request

client = Client("http://hdfs-web-svc.cloudera:50070", root="/", timeout=100, session=False)
# 文件上传的HTML模板，这里没有额外去写html模板了，直接写在这里，方便点吧
@route('/upload')
def upload():
    return '''
        <html>
            <head>
            </head>
            <body>
                <form action"/upload" method="post" enctype="multipart/form-data">
                    <input type="file" name="data" />
                    <input type="submit" value="Upload" />
                </form>
            </body>
        </html>
    '''


# 文件上传，overwrite=True为覆盖原有的文件，
# 如果不加这参数，当服务器已存在同名文件时，将返回“IOError: File exists.”错误
@route('/upload', method='POST')
def doupload():
    upload = request.files.getall('data')
    for meta in upload:
        buf = meta.file.read()
        name, ext = os.path.splitext(meta.filename)
        if ext not in ('.jar', '.tar'):
            return 'File extension not allowed. type [JAR]'
        path = '/task/mr/' + name + ext
        # ssh root@agent-2.agent-svc.cloudera.svc.cluster.local
        print("--------------save Task To" + path)
        with client.write(path, overwrite=True) as writer:
            writer.write(buf);

    return 'ok'
</code></pre>
    <ul>
        <li>serverless.yml</li>
    </ul>
    <pre><code class="yaml">
# Welcome to Serverless!
#
# For full config options, check the kubeless plugin docs:
#    https://github.com/serverless/serverless-kubeless
#
# For documentation on kubeless itself:
#    http://kubeless.io

# Update the service name below with your own service name
service: put-taskjar

# Please ensure the serverless-kubeless provider plugin is installed globally.
# $ npm install -g serverless-kubeless
#
# ...before installing project dependencies to register this provider.
# $ npm install

provider:
  name: kubeless
  namespace: ${env:K8S_NAMESPACE, 'cloudera'}
  runtime: python2.7

plugins:
  - serverless-kubeless

functions:
  upload:
    handler: task.upload

</code></pre>
    <p>具体信息看 第一条关于 serverless 的文章。</p>
    <p>转载请注明出处，本文采用 <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a> 协议授权</p>
    <footer>
        Power By Gemini TextGenerate 2024-09-16 21:25:38
    </footer>
</body>
</html>