
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="rust入门介绍，以及第一个程序里面包含了rust多少设计思想">
    <meta name="keywords" content="rust rust入门程序 rustweb actix">
    <title>Rust 第一个入门程序</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --day-bg: #ffffff;
            --day-text: #333333;
            --night-bg: #1a1a1a;
            --night-text: #f0f0f0;
        }

        body {
            max-width: 820px;
            margin: 0 auto;
            padding: 20px;
            line-height: 21px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .metadata {
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }

        .metadata p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        .day-mode {
            background-color: var(--day-bg);
            color: var(--day-text);
        }

        .night-mode {
            background-color: var(--night-bg);
            color: var(--night-text);
        }

        h1 { font-size: 19px; text-align: center; }
        h2 { font-size: 18px; }
        h3 { font-size: 16px; }
        h4 { font-size: 14px; }
        h5 { font-size: 12px; }
        h6 { font-size: 11px; }

        pre {
            line-height: 24px;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        code {
            font-family: 'Fira Code', Consolas, Monaco, 'Courier New', monospace;
        }

        img {
            display: block;
            max-width: 600px;
            height: auto;
            margin: 20px auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .content {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.05);
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid #ddd;
            font-size: 0.9em;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .content {
            animation: fadeIn 0.5s ease-in;
        }
    </style>
</head>
<body class="day-mode">
    <div class="metadata">
        <p><strong>Title:</strong> Rust 第一个入门程序</p>
        <p><strong>Categories:</strong> Rust</p>
        <p><strong>Description:</strong> rust入门介绍，以及第一个程序里面包含了rust多少设计思想</p>
        <p><strong>Keywords:</strong> rust rust入门程序 rustweb actix</p>
    </div>
    <div class="content">
        <p>记录第一个rust 程序，以及对用到的工具rust语言特性的介绍。</p>
<h3 id="rust">Rust 官方文档</h3>
<ul>
<li>https://doc.rust-lang.org/book/</li>
</ul>
<h3 id="rust-cargo">安装rust cargo</h3>
<ul>
<li>安装 
    <code>bash
    ## install rust
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    ##</code></li>
<li>官方安装文档</li>
</ul>
<blockquote>
<p>https://forge.rust-lang.org/infra/other-installation-methods.html</p>
</blockquote>
<h3 id="rust_1">创建一个rust项目</h3>
<div class="codehilite"><pre><span></span><code>cargo<span class="w"> </span>new<span class="w"> </span>web_demo<span class="w">  </span>--bin


&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>web_demo
&gt;<span class="w"> </span>tree<span class="w"> </span>.
.
├──<span class="w"> </span>Cargo.toml
└──<span class="w"> </span>src
<span class="w">    </span>└──<span class="w"> </span>main.rs

<span class="m">1</span><span class="w"> </span>directory,<span class="w"> </span><span class="m">2</span><span class="w"> </span>files
</code></pre></div>

<p>Let’s take a closer look at <code>Cargo.toml</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">[package]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;web-demo&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.1.0&quot;</span>
<span class="n">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;张建新 &lt;zhangjianxin@bigsfintech.com&gt;&quot;</span><span class="p">]</span>
<span class="n">edition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2018&quot;</span>

<span class="c1"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

<span class="k">[dependencies]</span>

<span class="c1"># 下面是我做测试添加的依赖</span>
<span class="n">actix-web</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2.0&quot;</span>
<span class="n">actix-rt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0&quot;</span>
<span class="n">actix-files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.2.1&quot;</span>
<span class="n">actix-session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.3.0&quot;</span>
<span class="n">serde_json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0&quot;</span>
<span class="n">serde</span><span class="o">=</span><span class="s">&quot;1.0.104&quot;</span>
<span class="n">strfmt</span><span class="o">=</span><span class="s">&quot;0.1.6&quot;</span>
<span class="n">kv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.20.2&quot;</span>
<span class="n">base64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.12.0&quot;</span>
</code></pre></div>

<p>This is called a manifest, and it contains all of the metadata that Cargo needs to compile your package.</p>
<p>Here’s what’s in <code>src/main.rs</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="_1">开始添砖加瓦</h3>
<div class="codehilite"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">actix_files</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">actix_web</span>::<span class="n">http</span>::<span class="n">StatusCode</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">actix_web</span>::<span class="p">{</span>
<span class="w">    </span><span class="n">guard</span><span class="p">,</span><span class="w"> </span><span class="n">middleware</span><span class="p">,</span><span class="w"> </span><span class="n">web</span><span class="p">,</span><span class="w"> </span><span class="n">App</span><span class="p">,</span><span class="w"> </span><span class="n">HttpRequest</span><span class="p">,</span><span class="w"> </span><span class="n">HttpResponse</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServer</span><span class="p">,</span><span class="w"> </span><span class="n">Responder</span><span class="p">,</span><span class="w"> </span><span class="nb">Result</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">kv</span>::<span class="o">*</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">collections</span>::<span class="n">HashMap</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="p">{</span><span class="n">fs</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="kt">str</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">strfmt</span>::<span class="n">strfmt</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">actix_files</span>::<span class="n">NamedFile</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">path</span>::<span class="n">PathBuf</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">base64</span>::<span class="p">{</span><span class="n">decode</span><span class="p">,</span><span class="w"> </span><span class="n">encode</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">serde</span>::<span class="p">{</span><span class="n">Deserialize</span><span class="p">,</span><span class="w"> </span><span class="n">Serialize</span><span class="p">};</span>


<span class="cp">#[derive(Serialize, Deserialize)]</span>
<span class="k">struct</span> <span class="nc">ResultResp</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">msg</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">code</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">data</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">data_array</span><span class="w"> </span>:<span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>


<span class="cp">#[derive(Debug, serde::Serialize, serde::Deserialize, PartialEq)]</span>
<span class="k">struct</span> <span class="nc">KvS</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">url</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">data</span>: <span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>


<span class="cp">#[derive(Debug, serde::Serialize, serde::Deserialize, PartialEq)]</span>
<span class="k">struct</span> <span class="nc">History</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">url</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">s</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">r</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">time</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">ip</span>: <span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>


<span class="cp">#[derive(Deserialize)]</span>
<span class="k">struct</span> <span class="nc">RequestData</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">help</span>: <span class="kt">bool</span><span class="p">,</span>
<span class="w">    </span><span class="n">data</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">exec</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">args</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
<span class="cp">#[derive(Deserialize)]</span>
<span class="k">struct</span> <span class="nc">RequestDataAddurl</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">help</span>: <span class="kt">bool</span><span class="p">,</span>
<span class="w">    </span><span class="n">data</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">exec</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">url</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">args</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>



<span class="k">fn</span> <span class="nf">reset</span><span class="p">(</span><span class="n">name</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;./stroe/{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//let _ = fs::remove_dir_all(&amp;s);</span>
<span class="w">    </span><span class="n">s</span>
<span class="p">}</span>



<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">hello</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">Responder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;hello&quot;</span>
<span class="p">}</span>

<span class="c1">//* 修改模板 以及保存模板</span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">modify_template</span><span class="p">(</span><span class="n">info</span>: <span class="nc">web</span>::<span class="n">Json</span><span class="o">&lt;</span><span class="n">RequestData</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">Responder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResultResp</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">msg</span>: <span class="s">&quot;data == null is error &quot;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">(),</span>
<span class="w">        </span><span class="n">code</span>: <span class="nc">format</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;Use {} &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">exec</span><span class="p">.</span><span class="n">to_owned</span><span class="p">()),</span>
<span class="w">        </span><span class="n">data</span>: <span class="s">&quot;&quot;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">(),</span>
<span class="w">        </span><span class="n">data_array</span>: <span class="nb">Vec</span>::<span class="n">new</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">//if tos::template::CMD_LIST.contains(&amp;&amp;*info.exec) {</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">());</span>

<span class="w">        </span><span class="n">put_k</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">exec</span><span class="p">.</span><span class="n">to_owned</span><span class="p">(),</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">to_owned</span><span class="p">());</span>

<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="s">&quot;template add success&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//}</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serde_json</span>::<span class="n">ser</span>::<span class="n">to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">resp</span><span class="p">);</span>
<span class="w">    </span><span class="n">HttpResponse</span>::<span class="nb">Ok</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">content_type</span><span class="p">(</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;X-Hdr&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sample&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">j</span>
<span class="p">}</span>

<span class="c1">//* 获取单个模板信息</span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_template</span><span class="p">(</span><span class="n">info</span>: <span class="nc">web</span>::<span class="n">Json</span><span class="o">&lt;</span><span class="n">RequestData</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">Responder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResultResp</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">msg</span>: <span class="s">&quot;data == null is error &quot;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">(),</span>
<span class="w">        </span><span class="n">code</span>: <span class="nc">format</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;Use {} &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">exec</span><span class="p">.</span><span class="n">to_owned</span><span class="p">()),</span>
<span class="w">        </span><span class="n">data</span>: <span class="s">&quot;&quot;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">(),</span>
<span class="w">        </span><span class="n">data_array</span>: <span class="nb">Vec</span>::<span class="n">new</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">//if tos::template::CMD_LIST.contains(&amp;&amp;*info.exec) {</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">());</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">get_k</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">exec</span><span class="p">.</span><span class="n">to_owned</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">Some</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">,</span>
<span class="w">            </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">panic!</span><span class="p">(),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base64</span>::<span class="n">decode</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">str</span>::<span class="n">from_utf8</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//}</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serde_json</span>::<span class="n">ser</span>::<span class="n">to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">resp</span><span class="p">);</span>
<span class="w">    </span><span class="n">HttpResponse</span>::<span class="nb">Ok</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">content_type</span><span class="p">(</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;X-Hdr&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sample&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">j</span>
<span class="p">}</span>

<span class="c1">//* iter keys</span>

<span class="k">fn</span> <span class="nf">iter_k</span><span class="p">()</span><span class="w"> </span>-&gt;<span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reset</span><span class="p">(</span><span class="s">&quot;kvs&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="n">cfg</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">test_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span><span class="p">.</span><span class="n">bucket</span>::<span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;stroe&quot;</span><span class="p">)).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">v</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">test_iter</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">key</span>: <span class="nb">String</span> <span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">key</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">value</span>::<span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;key: {}, value: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// let b;</span>
<span class="w">        </span><span class="c1">// match  base64::decode(value) {</span>
<span class="w">        </span><span class="c1">//     Ok(v) =&gt; b =v,</span>
<span class="w">        </span><span class="c1">//     Err(e) =&gt; panic!(),</span>
<span class="w">        </span><span class="c1">// }</span>
<span class="w">        </span><span class="c1">// let s = str::from_utf8(&amp;b).unwrap();</span>
<span class="w">        </span><span class="n">v</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">to_owned</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">v</span>
<span class="p">}</span>

<span class="c1">//* 获取所有模板 信息 列表JSON</span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_templates</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">Responder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w">  </span><span class="k">mut</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResultResp</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">msg</span>: <span class="s">&quot;data == null is error &quot;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">(),</span>
<span class="w">        </span><span class="n">code</span>: <span class="s">&quot;0&quot;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">(),</span>
<span class="w">        </span><span class="n">data</span>: <span class="s">&quot;&quot;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">(),</span>
<span class="w">        </span><span class="n">data_array</span>: <span class="nb">Vec</span>::<span class="n">new</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">());</span>

<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="n">data_array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iter_k</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serde_json</span>::<span class="n">ser</span>::<span class="n">to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">resp</span><span class="p">);</span>
<span class="w">    </span><span class="n">HttpResponse</span>::<span class="nb">Ok</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">content_type</span><span class="p">(</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;X-Hdr&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sample&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">j</span>
<span class="p">}</span>

<span class="c1">//* 发起请求</span>
<span class="sd">/// extract `Info` using serde</span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">start_http_client_post</span><span class="p">(</span><span class="n">info</span>: <span class="nc">web</span>::<span class="n">Json</span><span class="o">&lt;</span><span class="n">RequestData</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">help</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tos</span>::<span class="n">template</span>::<span class="n">TRACKING_HELP</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Result</span>::<span class="nb">Ok</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">tos</span>::<span class="n">template</span>::<span class="n">CMD_LIST</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="o">&amp;&amp;*</span><span class="n">info</span><span class="p">.</span><span class="n">exec</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HashMap</span>::<span class="n">new</span><span class="p">();</span>
<span class="w">        </span><span class="n">vars</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;timestamp&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">to_string</span><span class="p">());</span>
<span class="w">        </span><span class="n">vars</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;tcuId&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">to_string</span><span class="p">());</span>
<span class="w">        </span><span class="n">vars</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;vin&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">to_string</span><span class="p">());</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">get_k</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">exec</span><span class="p">.</span><span class="n">to_owned</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">Some</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">,</span>
<span class="w">            </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">panic!</span><span class="p">(),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base64</span>::<span class="n">decode</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">str</span>::<span class="n">from_utf8</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Result</span>::<span class="nb">Ok</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">strfmt</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">.</span><span class="n">to_owned</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vars</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Result</span>::<span class="nb">Ok</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;not found cmd  = {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">exec</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#[warn(unused_mut)]</span>
<span class="k">fn</span> <span class="nf">put_k</span><span class="p">(</span><span class="n">K</span>: <span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">V</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Configure the database</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reset</span><span class="p">(</span><span class="s">&quot;kvs&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="n">cfg</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// raw Integer String</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span><span class="p">.</span><span class="n">bucket</span>::<span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;stroe&quot;</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Set testing = 123</span>

<span class="w">    </span><span class="n">test</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">temp_get</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;TrackingCmd&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">temp_get</span><span class="p">);</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>



<span class="c1">//* get kv stroe by &#39;K</span>

<span class="k">fn</span> <span class="nf">get_k</span><span class="p">(</span><span class="n">K</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Configure the database</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reset</span><span class="p">(</span><span class="s">&quot;kvs&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="n">cfg</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">test_get</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span><span class="p">.</span><span class="n">bucket</span>::<span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;stroe&quot;</span><span class="p">)).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test_get</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">K</span><span class="p">.</span><span class="n">to_owned</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">    </span><span class="n">c</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">static_index</span><span class="p">(</span><span class="n">req</span>: <span class="nc">HttpRequest</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">NamedFile</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">actix_files</span>::<span class="n">NamedFile</span>::<span class="n">open</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;../static/index.html&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">)</span>
<span class="p">}</span>

<span class="cp">#[actix_rt::main]</span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">std</span>::<span class="n">io</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">actix_web</span>::<span class="p">{</span><span class="n">web</span><span class="p">,</span><span class="w"> </span><span class="n">App</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServer</span><span class="p">};</span>

<span class="w">    </span><span class="n">HttpServer</span>::<span class="n">new</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">App</span>::<span class="n">new</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">middleware</span>::<span class="n">Compress</span>::<span class="n">default</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">web</span>::<span class="n">JsonConfig</span>::<span class="n">default</span><span class="p">().</span><span class="n">limit</span><span class="p">(</span><span class="mi">4096</span><span class="p">))</span><span class="w"> </span><span class="c1">// &lt;- limit size of the payload (global configuration)</span>
<span class="w">            </span><span class="p">.</span><span class="n">service</span><span class="p">(</span><span class="n">web</span>::<span class="n">resource</span><span class="p">(</span><span class="s">&quot;/addTask&quot;</span><span class="p">).</span><span class="n">route</span><span class="p">(</span><span class="n">web</span>::<span class="n">post</span><span class="p">().</span><span class="n">to</span><span class="p">(</span><span class="n">start_http_client_post</span><span class="p">)))</span>
<span class="w">            </span><span class="p">.</span><span class="n">service</span><span class="p">(</span><span class="n">web</span>::<span class="n">resource</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">).</span><span class="n">route</span><span class="p">(</span><span class="n">web</span>::<span class="n">get</span><span class="p">().</span><span class="n">to</span><span class="p">(</span><span class="n">hello</span><span class="p">)))</span>
<span class="w">            </span><span class="p">.</span><span class="n">service</span><span class="p">(</span><span class="n">web</span>::<span class="n">resource</span><span class="p">(</span><span class="s">&quot;/addTemplate&quot;</span><span class="p">).</span><span class="n">route</span><span class="p">(</span><span class="n">web</span>::<span class="n">post</span><span class="p">().</span><span class="n">to</span><span class="p">(</span><span class="n">modify_template</span><span class="p">)))</span>
<span class="w">            </span><span class="p">.</span><span class="n">service</span><span class="p">(</span><span class="n">web</span>::<span class="n">resource</span><span class="p">(</span><span class="s">&quot;/getTemplate&quot;</span><span class="p">).</span><span class="n">route</span><span class="p">(</span><span class="n">web</span>::<span class="n">post</span><span class="p">().</span><span class="n">to</span><span class="p">(</span><span class="n">get_template</span><span class="p">)))</span>
<span class="w">            </span><span class="p">.</span><span class="n">service</span><span class="p">(</span><span class="n">web</span>::<span class="n">resource</span><span class="p">(</span><span class="s">&quot;/getTemplateList&quot;</span><span class="p">).</span><span class="n">route</span><span class="p">(</span><span class="n">web</span>::<span class="n">get</span><span class="p">().</span><span class="n">to</span><span class="p">(</span><span class="n">get_templates</span><span class="p">)))</span>
<span class="w">            </span><span class="p">.</span><span class="n">service</span><span class="p">(</span><span class="n">actix_files</span>::<span class="n">Files</span>::<span class="n">new</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;/static&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;../static/&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">default_service</span><span class="p">(</span>
<span class="w">                </span><span class="n">web</span>::<span class="n">resource</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">route</span><span class="p">(</span><span class="n">web</span>::<span class="n">get</span><span class="p">().</span><span class="n">to</span><span class="p">(</span><span class="n">static_index</span><span class="p">)).</span><span class="n">route</span><span class="p">(</span>
<span class="w">                    </span><span class="n">web</span>::<span class="n">route</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">guard</span><span class="p">(</span><span class="n">guard</span>::<span class="n">Not</span><span class="p">(</span><span class="n">guard</span>::<span class="n">Get</span><span class="p">()))</span>
<span class="w">                        </span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">HttpResponse</span>::<span class="n">MethodNotAllowed</span><span class="p">()),</span>
<span class="w">                </span><span class="p">),</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;127.0.0.1:8088&quot;</span><span class="p">)</span><span class="o">?</span>
<span class="w">    </span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="k">await</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="web">写一个简单的web遇到哪些感觉有意思的东西</h3>
<ul>
<li>match 大体功能同等于<code>switch</code> 但是加强了枚举</li>
<li>Some  <code>一个神奇的枚举种类</code> （比较有意思的点）</li>
<li><code>||</code> <code>闭包</code></li>
<li>? <code>Error propagation  一般会和 Match Some Restlt&lt;Option&gt;</code> 打一套组合拳 主要还是用于传播 （比较有意思的点）</li>
<li>unwrap  和  <code>?</code> 相反的工作 <code>?</code>是传播  <code>unwrap</code> 摊开数据 解包数据返回。</li>
<li>async await Rust的异步并发编程</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">print_async</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Hello from print_async&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="kd">let</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">print_async</span><span class="p">();</span>
<span class="w">     </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Hello from main&quot;</span><span class="p">);</span>
<span class="w">     </span><span class="n">futures</span>::<span class="n">block_on</span><span class="p">(</span><span class="n">future</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// 本质上是 延迟运算</span>
<span class="c1">// 在手动 poll future 之前，异步函数内部一行代码也不会执行</span>
</code></pre></div>

<ul>
<li>await! <code>是一个编译器内建的 macro ，用来暂停（pause） Future 的执行流程，并且把执行流程交回给调用方 (yield) 和React访问rest接口 一致。</code></li>
</ul>
<h4 id="rust_2">今天是学习Rust的第一天 开阔了视野</h4>
<ul>
<li>文章不定时更新，遇到自己觉得有意思的问题 第一时间更新上来。</li>
</ul>
<p>转载请注明出处，本文采用 <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a> 协议授权</p>
    </div>
    <footer>
        Power By Python Markdown Generate 2025-07-25 10:12:52
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });

        function setThemeMode() {
            const hour = new Date().getHours();
            const body = document.body;
            if (hour >= 18 || hour < 6) {
                body.classList.remove('day-mode');
                body.classList.add('night-mode');
            } else {
                body.classList.remove('night-mode');
                body.classList.add('day-mode');
            }
        }

        setThemeMode();
        setInterval(setThemeMode, 60000);
    </script>
</body>
</html>
