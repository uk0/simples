<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>2018-05-28-ant-design-pro-stack1.md</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
      <script src="jq.js"></script>
    <link href="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/js/bootstrap.bundle.min.js"></script>
 <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">


<style>
    html{--static-white:#fff;--bg-body:#fff;--bg-filler:#eff0f1;--bg-body-overlay:#f5f6f7;--text-title:#1f2329;--text-link-hover:#3370ff;--text-caption:#646a73;--text-placeholder:#8f959e;--primary-pri-400:#4e83fd;--primary-pri-500:#3370ff;--primary-pri-600:#245bdb;--line-border-card:#dee0e3;--shadow-default-sm:rgba(31, 35, 41, 0.12);--ccmtoken-mindnote-highlightcolor-neutral-raw:222,224,227;--icon-n1:#2b2f36;--icon-n2:#646a73}html[data-theme=dark]{--static-white:#fff;--bg-body:#1a1a1a;--bg-filler:#373737;--bg-body-overlay:#2e2e2e;--text-title:#f0f0f0;--text-link-hover:#4c88ff;--text-caption:#a6a6a6;--text-placeholder:#939393;--primary-pri-400:#2e65d1;--primary-pri-500:#4c88ff;--primary-pri-600:#70a0ff;--line-border-card:#5f5f5f;--shadow-default-sm:rgba(0, 0, 0, 0.32);--ccmtoken-mindnote-highlightcolor-neutral-raw:80,80,80;--icon-n1:#e8e8e8;--icon-n2:#a6a6a6}
    body
    {
        width:auto;
         
        font-family: LarkHackSafariFont,LarkEmojiFont,LarkChineseQuote,-apple-system,BlinkMacSystemFont,Helvetica Neue,Tahoma,PingFang SC,Microsoft Yahei,Arial,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
        font-size:14px;
        color: #312222;
        line-height:23px;
        letter-spacing:1px
    }
    .word{
        margin-top:5%; margin-left: 5%; margin-right: 9%;
        word-wrap:break-word;
    }
</style>
</head>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script>
    hljs.highlightAll();
document.querySelectorAll('div.code').forEach(el => {
    
    hljs.highlightElement(el);

});
</script>

<body style="background-color: #FFFFFF">
<div class = "word">
    <hr />  
  
<p>layout: post<br />  
categories: react<br />  
title: ant-design-pro 初级问题以及解答<br />  
date: 2018-05-28 15:21:44 +0800<br />  
description: ant-design-pro 的基本问题解析</p>  
  
<h2>keywords: React</h2>  
  
<h2>本章介绍的是ant-design-pro 使用中遇到的一些问题 以及个人的解决方式，大牛勿喷。</h2>  
  
<h2>React 与 Ant-Design-Pro</h2>  
  
<ul>  
<li>下载工程：<br />  
</li>  
</ul>  
  
<pre><code class="language-bash">https://github.com/ant-design/ant-design-pro  
</code></pre>  
  
<ul>  
<li>安装依赖包<br />  
</li>  
</ul>  
  
<pre><code class="language-bash"> npm i -dd  # 等待的时间很长。【可以代理出去速度更快】  
  
 npm start # 启动  
  
 npm run build:aot:prod # 编译  
  
</code></pre>  
  
<ul>  
<li>修改配置文件 <code>.eslintrc.js</code> WebStorm 最新版2018 可能会报错，所以需要修改<code>.eslintrc.js</code><br />  
</li>  
</ul>  
  
<pre><code class="language-js">module.exports = {  
  parser: 'babel-eslint',  
  extends: ['airbnb', 'prettier'],  
  env: {  
    browser: true,  
    node: true,  
    es6: true,  
    mocha: true,  
    jest: true,  
    jasmine: true,  
  },  
  rules: {  
    // 布尔值类型的 propTypes 的 name 必须为 is 或 has 开头  
    // @off 不强制要求写 propTypes  
    &quot;react/boolean-prop-naming&quot;: &quot;off&quot;,  
    // 一个 defaultProps 必须有对应的 propTypes  
    // @off 不强制要求写 propTypes  
    &quot;react/default-props-match-prop-types&quot;: &quot;off&quot;,  
    // 组件必须有 displayName 属性  
    // @off 不强制要求写 displayName  
    &quot;react/display-name&quot;: &quot;off&quot;,  
    // 禁止在自定义组件中使用一些指定的 props  
    // @off 没必要限制  
    &quot;react/forbid-component-props&quot;: &quot;off&quot;,  
    // 禁止使用一些指定的 elements  
    // @off 没必要限制  
    &quot;react/forbid-elements&quot;: &quot;off&quot;,  
    // 禁止使用一些指定的 propTypes  
    // @off 不强制要求写 propTypes  
    &quot;react/forbid-prop-types&quot;: &quot;off&quot;,  
    // 禁止直接使用别的组建的 propTypes  
    // @off 不强制要求写 propTypes  
    &quot;react/forbid-foreign-prop-types&quot;: &quot;off&quot;,  
    // 禁止使用数组的 index 作为 key  
    // @off 太严格了  
    &quot;react/no-array-index-key&quot;: &quot;off&quot;,  
    // 禁止使用 children 做 props  
    &quot;react/no-children-prop&quot;: &quot;error&quot;,  
    // 禁止使用 dangerouslySetInnerHTML  
    // @off 没必要限制  
    &quot;react/no-danger&quot;: &quot;off&quot;,  
    // 禁止在使用了 dangerouslySetInnerHTML 的组建内添加 children  
    &quot;react/no-danger-with-children&quot;: &quot;error&quot;,  
    // 禁止使用已废弃的 api  
    &quot;react/no-deprecated&quot;: &quot;error&quot;,  
    // 禁止在 componentDidMount 里面使用 setState  
    // @off 同构应用需要在 didMount 里写 setState  
    &quot;react/no-did-mount-set-state&quot;: &quot;off&quot;,  
    // 禁止在 componentDidUpdate 里面使用 setState  
    &quot;react/no-did-update-set-state&quot;: &quot;error&quot;,  
    // 禁止直接修改 this.state  
    &quot;react/no-direct-mutation-state&quot;: &quot;error&quot;,  
    // 禁止使用 findDOMNode  
    &quot;react/no-find-dom-node&quot;: &quot;error&quot;,  
    // 禁止使用 isMounted  
    &quot;react/no-is-mounted&quot;: &quot;error&quot;,  
    // 禁止在一个文件创建两个组件  
    // @off 有一个 bug https://github.com/yannickcr/eslint-plugin-react/issues/1181  
    &quot;react/no-multi-comp&quot;: &quot;off&quot;,  
    // 禁止在 PureComponent 中使用 shouldComponentUpdate  
    &quot;react/no-redundant-should-component-update&quot;: &quot;error&quot;,  
    // 禁止使用 ReactDOM.render 的返回值  
    &quot;react/no-render-return-value&quot;: &quot;error&quot;,  
    // 禁止使用 setState  
    // @off setState 很常用  
    &quot;react/no-set-state&quot;: &quot;off&quot;,  
    // 禁止拼写错误  
    &quot;react/no-typos&quot;: &quot;error&quot;,  
    // 禁止使用字符串 ref  
    &quot;react/no-string-refs&quot;: &quot;error&quot;,  
    // 禁止在组件的内部存在未转义的 &gt;, &quot;, &quot; 或 }  
    &quot;react/no-unescaped-entities&quot;: &quot;error&quot;,  
    // @fixable 禁止出现 HTML 中的属性，如 class  
    &quot;react/no-unknown-property&quot;: &quot;error&quot;,  
    // 禁止出现未使用的 propTypes  
    // @off 不强制要求写 propTypes  
    &quot;react/no-unused-prop-types&quot;: &quot;off&quot;,  
    // 定义过的 state 必须使用  
    // @off 没有官方文档，并且存在很多 bug： https://github.com/yannickcr/eslint-plugin-react/search?q=no-unused-state&amp;type=Issues&amp;utf8=%E2%9C%93  
    &quot;react/no-unused-state&quot;: &quot;off&quot;,  
    // 禁止在 componentWillUpdate 中使用 setState  
    &quot;react/no-will-update-set-state&quot;: &quot;error&quot;,  
    // 必须使用 Class 的形式创建组件  
    &quot;react/prefer-es6-class&quot;: [  
      &quot;error&quot;,  
      &quot;always&quot;  
    ],  
    // @fixable props 与 value 之间的等号前后禁止有空格  
    &quot;react/jsx-equals-spacing&quot;: [  
      &quot;error&quot;,  
      &quot;never&quot;  
    ],  
    // 数组中的 jsx 必须有 key  
    &quot;react/jsx-key&quot;: &quot;error&quot;,  
    // @fixable 限制每行的 props 数量  
    // @off 没必要限制  
    &quot;react/jsx-max-props-per-line&quot;: &quot;off&quot;,  
    // jsx 中禁止使用 bind  
    // @off 太严格了  
    &quot;react/jsx-no-bind&quot;: &quot;off&quot;,  
    // 禁止在 jsx 中使用像注释的字符串  
    &quot;react/jsx-no-comment-textnodes&quot;: &quot;error&quot;,  
    // 禁止在 jsx 中出现字符串  
    // @off 没必要限制  
    &quot;react/jsx-no-literals&quot;: &quot;off&quot;,  
    // 禁止使用 target=&quot;_blank&quot;  
    // @off 没必要限制  
    &quot;react/jsx-no-target-blank&quot;: &quot;off&quot;,  
    // 禁止使用未定义的 jsx elemet  
    &quot;react/jsx-no-undef&quot;: &quot;error&quot;,  
    // 禁止使用 pascal 写法的 jsx，比如 &lt;TEST_COMPONENT&gt;  
    &quot;react/jsx-pascal-case&quot;: &quot;error&quot;,  
    // @fixable props 必须排好序  
    // @off 没必要限制  
    &quot;react/jsx-sort-props&quot;: &quot;off&quot;,  
    // 限制文件后缀  
    // @off 没必要限制  
    &quot;react/jsx-filename-extension&quot;: &quot;off&quot;,  
  
    &quot;import/prefer-default-export&quot;: [  
      0  
    ],  
    // 禁止出现重复的 props  
    &quot;react/jsx-no-duplicate-props&quot;: &quot;error&quot;,  
    // @fixable jsx 的开始和闭合处禁止有空格  
    &quot;prefer-destructuring&quot;:[0],  
    &quot;react/jsx-tag-spacing&quot;:[0],  
    &quot;object-shorthand&quot;:[0],  
    // &quot;react/jsx-tag-spacing&quot;: [  
    //   &quot;error&quot;,  
    //   {  
    //     &quot;closingSlash&quot;: &quot;never&quot;,  
    //     &quot;beforeSelfClosing&quot;: &quot;always&quot;,  
    //     &quot;afterOpening&quot;: &quot;never&quot;  
    //   }  
    // ],  
    // jsx 文件必须 import React  
    &quot;react/jsx-uses-react&quot;: &quot;error&quot;,  
    // 定义了的 jsx element 必须使用  
    &quot;react/jsx-uses-vars&quot;: &quot;error&quot;,  
    // @fixable 多行的 jsx 必须有括号包起来  
    // @off 没必要限制  
    &quot;react/jsx-wrap-multilines&quot;: &quot;off&quot;,  
    // @fixable 第一个 prop 必须得换行  
    // @off 没必要限制  
    &quot;react/jsx-first-prop-new-line&quot;: &quot;off&quot;,  
    // handler 的名称必须是 onXXX 或 handleXXX  
    // @off 没必要限制  
    &quot;react/jsx-handler-names&quot;: &quot;off&quot;,  
    // 必须使用 pure function  
    // @off 没必要限制  
    &quot;react/prefer-stateless-function&quot;: &quot;off&quot;,  
    // 组件必须写 propTypes  
    // @off 不强制要求写 propTypes  
    &quot;react/prop-types&quot;: &quot;off&quot;,  
    // 出现 jsx 的地方必须 import React  
    // @off 已经在 no-undef 中限制了  
    &quot;react/react-in-jsx-scope&quot;: &quot;off&quot;,  
    // 非 required 的 prop 必须有 defaultProps  
    // @off 不强制要求写 propTypes  
    &quot;react/require-default-props&quot;: &quot;off&quot;,  
    // 组件必须有 shouldComponentUpdate  
    // @off 没必要限制  
    &quot;react/require-optimization&quot;: &quot;off&quot;,  
    // render 方法中必须有返回值  
    &quot;react/require-render-return&quot;: &quot;error&quot;,  
    // @fixable 组件内没有 children 时，必须使用自闭和写法  
    // @off 没必要限制  
    &quot;react/self-closing-comp&quot;: &quot;off&quot;,  
    // @fixable 组件内方法必须按照一定规则排序  
    &quot;react/sort-comp&quot;: &quot;error&quot;,  
    // propTypes 的熟悉必须按照字母排序  
    // @off 没必要限制  
    &quot;react/sort-prop-types&quot;: &quot;off&quot;,  
    // style 属性的取值必须是 object  
    &quot;react/style-prop-object&quot;: &quot;error&quot;,  
    // HTML 中的自闭和标签禁止有 children  
    &quot;react/void-dom-elements-no-children&quot;: &quot;error&quot;,  
    // @fixable 布尔值的属性必须显式的写 someprop={true}  
    // @off 没必要限制  
    &quot;react/jsx-boolean-value&quot;: &quot;off&quot;,  
    // @fixable 自闭和标签的反尖括号必须与尖括号的那一行对齐  
    &quot;react/jsx-closing-bracket-location&quot;: [  
      &quot;error&quot;,  
      {  
        &quot;nonEmpty&quot;: false,  
        &quot;selfClosing&quot;: &quot;line-aligned&quot;  
      }  
    ],  
    // @fixable 结束标签必须与开始标签的那一行对齐  
    // @off 已经在 jsx-indent 中限制了  
    &quot;react/jsx-closing-tag-location&quot;: &quot;off&quot;,  
    'generator-star-spacing': [0],  
    'consistent-return': [0],  
    'no-useless-concat': &quot;off&quot;,  
    // 'react/forbid-prop-types': [0],  
    // 'react/jsx-filename-extension': [1, { extensions: ['.js'] }],  
    'global-require': [1],  
    // 'import/prefer-default-export': [0],  
    // 'react/jsx-no-bind': [0],  
    // 'react/prop-types': [0],  
    // 'react/prefer-stateless-function': [0],  
    // 'react/jsx-wrap-multilines': [  
    //   'error',  
    //   {  
    //     declaration: 'parens-new-line',  
    //     assignment: 'parens-new-line',  
    //     return: 'parens-new-line',  
    //     arrow: 'parens-new-line',  
    //     condition: 'parens-new-line',  
    //     logical: 'parens-new-line',  
    //     prop: 'ignore',  
    //   },  
    // ],  
    'no-else-return': [0],  
    'no-restricted-syntax': [0],  
    'import/no-extraneous-dependencies': [0],  
    'no-use-before-define': [0],  
    'jsx-a11y/no-static-element-interactions': [0],  
    'jsx-a11y/no-noninteractive-element-interactions': [0],  
    'jsx-a11y/click-events-have-key-events': [0],  
    'jsx-a11y/anchor-is-valid': [0],  
    'no-nested-ternary': [0],  
    'prefer-template': [0],  
    'no-unused-vars': [0],  
    'no-param-reassign': [0],  
    'react/sort-comp': [0],  
    'import/no-duplicates': [0],  
    'no-unneeded-ternary': [0],  
    'arrow-body-style': [0],  
    'spaced-comment': [0],  
    'import/extensions': [0],  
    'no-bitwise': [0],  
    'no-cond-assign': [0],  
    'import/no-unresolved': &quot;off&quot;,  
    'import/no-useless-concat': [0],  
    'comma-dangle': [  
      'error',  
      {  
        arrays: 'always-multiline',  
        objects: 'always-multiline',  
        imports: 'always-multiline',  
        exports: 'always-multiline',  
        functions: 'ignore',  
      },  
    ],  
    'object-curly-newline': [0],  
    'function-paren-newline': [0],  
    'no-restricted-globals': [0],  
    'require-yield': [1],  
  },  
  parserOptions: {  
    ecmaFeatures: {  
      experimentalObjectRestSpread: true,  
    },  
  },  
  settings: {  
    polyfills: ['fetch', 'promises'],  
  },  
};  
</code></pre>  
  
<ul>  
<li><p>修改默认的 <code>request.js &gt; request2.js</code></p></li>  
  
<li><p><code>npm i axios --save -dd</code></p></li>  
</ul>  
  
<pre><code class="language-javascript">  
import axios from 'axios';  
import { notification } from 'antd';  
  
function checkStatus(response) {  
  const { data: result } = response;  
  if (response != null) {  
      result.success = true;  // get response successfully  
      return result;  
    }else {  
      const error = new Error(result);  
      result.success = false;  
      error.result = result;  
      throw error;  
  }  
}  
  
/**  
 * Requests a URL, returning a promise.  
 *  
 * @param  {string} url       The URL we want to request  
 * @param  {object} [options] The options we want to pass to &quot;axios&quot;  
 * @return {object}           An object containing either &quot;data&quot; or &quot;err&quot;  
 */  
export default function request(url, options) {  
  const defaultOptions = {  
    credentials: 'include',  
  };  
  const newOptions = { ...defaultOptions, ...options };  
  
  if (newOptions.method === 'POST' || newOptions.method === 'PUT' || newOptions.method === 'DELETE') {  
    if (!(newOptions.body instanceof FormData)) {  
      newOptions.headers = {  
        Accept: 'application/json',  
        'Content-Type': 'application/json; charset=utf-8',  
        ...newOptions.headers,  
      };  
      // newOptions.body = JSON.stringify(newOptions.body);  
    } else {  
      console.log(&quot;----------------request body json-------------------&quot;)  
      // newOptions.body is FormData  
      newOptions.headers = {  
        &quot;content-type&quot;: &quot;application/json&quot;,  
        ...newOptions.headers,  
      };  
    }  
  }  
  
  return axios.create().request({  
    url,  
    method: options &amp;&amp; options.method ? options.method : 'GET',  
    timeout: 15000, // http请求超时时间  
    ...newOptions,  
  })  
    .then(checkStatus)  
    .catch((error) =&gt; {  
      if (error.code) {  
        notification.error({  
          message: error.name,  
          description: error.message,  
        });  
      }  
      // http请求超时处理  
      if ('stack' in error &amp;&amp; 'message' in error) {  
        const { message } = error;  
        if (~message.indexOf('timeout')) {  
          notification.error({  
            message: `请求错误: ${url}`,  
            description: '很抱歉您的请求已经超时了，请稍后再试！',  
          });  
        } else {  
          notification.error({  
            message: `请求错误: ${url}`,  
            description: error.message,  
          });  
        }  
      }  
      const result = { success: false };  
      return result;  
    });  
}  
</code></pre>  
  
<ul>  
<li><code>.roadhogrc.mock.js</code> 修改如下内容。<br />  
</li>  
</ul>  
  
<pre><code class="language-js">import mockjs from 'mockjs';  
import { getRule, postRule } from './mock/rule';  
import { getActivities, getNotice, getFakeList } from './mock/api';  
import { getFakeChartData } from './mock/chart';  
import { getProfileBasicData } from './mock/profile';  
import { getProfileAdvancedData } from './mock/profile';  
import { getNotices } from './mock/notices';  
import { format, delay } from 'roadhog-api-doc';  
  
// 代码中会兼容本地 service mock 以及部署站点的静态数据  
const proxy = {  
  // 支持值为 Object 和 Array  
  'GET /proxy-get/(.*)': 'http://127.0.0.1:8004/pay-web-rest/',  
  'POST /proxy-post/(.*)': 'http://127.0.0.1:8004/pay-web-rest/',  
  'DELETE /proxy-delete/(.*)': 'http://127.0.0.1:8004/pay-web-rest/',  
};  
  
// 是否禁用代理  
const noProxy = process.env.NO_PROXY === 'true';  
export default noProxy ? {} : delay(proxy, 1000);  
</code></pre>  
  
<h2>写一个模块。</h2>  
  
<ul>  
<li><p>经过上面的配置，现在已经可以开始写模块了。<br />  
</p></li>  
  
<li><p>写一个模块需要配置如下几项。</p>  
  
<pre><code class="language-bash">ant-design-pro/src/common/menu.js # 页面菜单，可以配置权限。  
ant-design-pro/src/common/router.js # 该文件内配置全局的 route路径，可以分配访问[models]的权限  
ant-design-pro/src/routes # 每一个单独的 route 功能的实现（同等于Page）  
ant-design-pro/src/models # effects 用来注册请求，访问请求。  
ant-design-pro/src/services # 封装 request请求 供给 ‘effects’  
</code></pre>  
<ul>  
<li>现在需要在 <code>route</code> 内加一个路径，也就是我们自己的route<br />  
<code>js  
// park 服务所支持的 route------start  
'/payList/agent-list': {  
component: dynamicWrapper(app, ['parkingPayManager'], () =&gt; import('../routes/PayManager/PayAgent')),  
},  
// 1. 其中 parkingPayManager 是一个models我们要将这个models注册进来，给这个route使用。  
// 2. /payList/agent-list 是`menu`的菜单路径。  
</code><br />  
</li>  
</ul>  
  
<ul>  
<li>现在需要在 <code>menu</code> 内加一个菜单。<br />  
</li>  
</ul></li>  
</ul>  
  
<pre><code class="language-js">{  
    name: '支付商户管理',  
    icon: 'table',  
    path: 'payList',  
    children: [  
      {  
        name: '商户管理',  
        path: 'agent-list',  
      }  
    ],  
  },  
</code></pre>  
  
<ul>  
<li>添加一个model<br />  
</li>  
</ul>  
  
<pre><code class="language-js">import {  
  queryParkManagerAgents,  
} from '../services/parkingServices';  
  
export default {  
  namespace: 'parkingPayManager', //我们所有的 dispatch 都是通过这个namespace定位过来的。 所以当请求不通，要注意。  
  state: {  
    QueryAgentData: [],  
  },  
  effects: {  
    *queryAgentList({callback}, { call, put }) { //  `{callback}` 替换成 `_` 就是没有参数  
      const response = yield call(queryParkManagerAgents); //queryParkManagerAgents 是定义的service 里面放出的可调用的方法  
      console.log(&quot;result Data  successfully&quot;);  
      console.log(response);  
      yield put({  
        type: 'updateStateQueryAgentList',  // (response.success) ? response.data : [],  
        payload: response.data,  
      });  
      if(response.success)callback(response.data); //进行回调  
    },  
  
    //updateStateQueryAgentList 是通过type 进行调用. 名字要相互对应，后面会讲为什么这么调用。  
  reducers: {  
    updateStateQueryAgentList(state, action) {  
      console.log(action.payload);  
      return {  
        ...state,  
        QueryAgentData: action.payload, // 这个QueryAgentData 需要提前定义在state里面  
      }  
    },  
  },  
}  
  
</code></pre>  
  
<ul>  
<li>定义一个 <code>Service</code><br />  
</li>  
</ul>  
  
<pre><code class="language-js">  
import request from '../utils/request2';  
  
export async function queryParkManagerAgents() {  
  return request('/proxy-get/queryAllAgent', { //其中这里面的 proxy-get 是通过 调用mock 的proxy 完成的。 也就是第一次配置的哪个 mock配置文件。  
    method: 'GET',  
  })  
}  
  
</code></pre>  
  
<ul>  
<li>最后编写一个 route （page）<br />  
</li>  
</ul>  
  
<pre><code class="language-bash">import React, {PureComponent} from 'react';  
import {connect} from 'dva';  
import {  
  Card,  
  Button,  
  Form,  
  Input,  
  Select,  
  Modal,  
  message,  
} from 'antd';  
import StandardTable from 'components/StandardTable';  
import PageHeaderLayout from '../../layouts/PageHeaderLayout';  
  
import styles from './PayAgent.less';  
  
const {Option} = Select;  
  
const FormItem = Form.Item;  
//定义一个 Form  
const CreateForm = Form.create()(props =&gt; {  
  const {modalVisible, form, handleAdd, handleModalVisible, optionChildrenDataTemp} = props;  
  const okHandle = () =&gt; {  
    form.validateFields((err, fieldsValue) =&gt; {  
      if (err) return;  
      form.resetFields();  
      handleAdd(fieldsValue);  
    });  
  };  
  return (  
    &lt;Modal  
      title=&quot;新建配置&quot;  
      visible={modalVisible}  
      onOk={okHandle}  
      onCancel={() =&gt; handleModalVisible()}  
    &gt;  
      &lt;FormItem labelCol={{span: 5}} wrapperCol={{span: 15}} label=&quot;商户代码&quot;&gt;  
        {form.getFieldDecorator('mch_code', {  
          rules: [{required: true, message: 'Please input  mch_code...'}],  
        })(&lt;Input placeholder=&quot;目前有用&quot;/&gt;)}  
      &lt;/FormItem&gt;  
      &lt;FormItem labelCol={{span: 5}} wrapperCol={{span: 15}} label=&quot;通道支付码&quot;&gt;  
        {form.getFieldDecorator('mchp_code', {  
          rules: [{required: true, message: 'Please input  mchp_code...'}],  
        })(&lt;Input placeholder=&quot;请输入：通道支付码&quot;/&gt;)}  
      &lt;/FormItem&gt;  
      &lt;FormItem labelCol={{span: 5}} wrapperCol={{span: 15}} label=&quot;商户名称&quot;&gt;  
        {form.getFieldDecorator('business_name', {  
          rules: [{required: true, message: 'Please input  business_name...'}],  
        })(&lt;Input placeholder=&quot;请输入： 商户名称&quot;/&gt;)}  
      &lt;/FormItem&gt;  
      &lt;FormItem labelCol={{span: 5}} wrapperCol={{span: 15}} label=&quot;描述信息&quot;&gt;  
        {form.getFieldDecorator('mch_description', {  
          rules: [{required: true, message: 'Please input  certificate_file...'}],  
        })(&lt;Input placeholder=&quot;请输入：描述信息&quot;/&gt;)}  
      &lt;/FormItem&gt;  
      &lt;FormItem labelCol={{span: 5}} wrapperCol={{span: 15}} label=&quot;商户ID&quot;&gt;  
        {form.getFieldDecorator('mch_id', {  
          rules: [{required: true, message: 'Please input  mch_id...'}],  
        })(&lt;Input placeholder=&quot;请输入：商户ID&quot;/&gt;)}  
      &lt;/FormItem&gt;  
      &lt;FormItem labelCol={{span: 5}} wrapperCol={{span: 15}} label=&quot;选择通道&quot;&gt;  
        {form.getFieldDecorator('mchc_code', {  
          rules: [{required: true, message: 'Please selectd...'}],  
        })(&lt;Select  
          // mode=&quot;tags&quot;  // multiple  tags combobox  
          style={{maxWidth: 200, width: '100%'}}  
          placeholder=&quot;不限&quot;  
        &gt;  
          {optionChildrenDataTemp.map(item =&gt; (  
            &lt;Option key={item.channel_id} value={item.channel_id}&gt;  
              {item.channel_name}  
            &lt;/Option&gt;  
          ))}  
        &lt;/Select&gt;)}  
      &lt;/FormItem&gt;  
    &lt;/Modal&gt;  
  );  
});  
// 连接model层的state数据，然后通过this.props.state : loading.models.名(namespace)访问model层的state数据  
@connect(({parkingPayManager, loading}) =&gt; ({  
  parkingPayManager, //获得整个 Model  
  loading: loading.models.parkingPayManager, //   true or false  
}))  
export default class PayAgent extends PureComponent {  
  state = {  
    selectedRows: [],  
    isLoading: false,  
    modalVisible: false,  
    optionChildrenData: [],  
  };  
  
  componentWillMount() {  
    const {dispatch} = this.props;  
    dispatch({  
      type: 'parkingPayManager/queryChannelList', //通过dispatch调用这个请求。  
      callback: (e) =&gt; { //请求内的callback  可以做刷新动作等，  
        message.success(&quot;select init success &quot; + e);  
        this.setState({  
          optionChildrenData: e,  
        });  
      },  
    });  
    console.log(&quot;初始化 =&gt; 下拉列表的数据&quot;);  
  }  
  
  componentDidMount() {  
    // componentWillMount -&gt; render -&gt;  componentDidMount  ..-&gt; componentWillReceiveProps  
    const {dispatch} = this.props;  
    // 触发action触发model层的state的初始化  
    dispatch({  
      type: 'parkingPayManager/queryAgentList',  
    });  
  }  
  
  handleModalVisible = flag =&gt; {  
    this.setState({  
      modalVisible: !!flag,  
    });  
  }  
  
  handleAdd = fields =&gt; {  
    const {dispatch} = this.props;  
    // 触发action触发model层的state的初始化  
    dispatch({  
      type: 'parkingPayManager/insertAgent',  
      payload: JSON.stringify(fields),  
      callback: () =&gt; {  
        dispatch({  
          type: 'parkingPayManager/queryAgentList',  
        });  
        this.setState({  
          modalVisible: false, // 清除  
        });  
        message.success('successfully ' + JSON.stringify(fields));  
      },  
    });  
  };  
  
  render() {  
    const {parkingPayManager: {QueryAgentData}} = this.props;  
    const newdata = {  
      list: QueryAgentData,  
      pagination: {  
        total: QueryAgentData.length,  
        pageSize: 10,// 页面量  
        current: 1, // 当前第几页  
      },  
    };  
    const {isLoading, modalVisible, selectedRows, optionChildrenData} = this.state;  
    const columns = [  
      {  
        title: '商户伪码',  
        dataIndex: 'mch_code',  
        align: 'right',  
        render: text =&gt;  
          text ? (  
            text  
          ) : (  
            '无法显示'  
          ),  
      },  
      {  
        title: '商户名称',  
        dataIndex: 'business_name',  
      },  
      {  
        title: '描述信息',  
        dataIndex: 'mch_description',  
      },  
      {  
        title: '商户的通道码',  
        dataIndex: 'mchc_code',  
      },  
      {  
        title: '商户支付码',  
        dataIndex: 'mchp_code',  
      },  
      {  
        title: '商户ID',  
        dataIndex: 'mch_id',  
        render: text =&gt;  
          text ? (  
            text  
          ) : (  
            'AliPay Not MchID'  
          ),  
      },  
    ];  
  
    const parentMethods = {  
      handleAdd: this.handleAdd,  
      handleModalVisible: this.handleModalVisible,  
      optionChildrenDataTemp: optionChildrenData,  
    };  
  
    return (  
      &lt;PageHeaderLayout title=&quot;商户配置信息&quot;&gt;  
        &lt;Card bordered={false}&gt;  
          &lt;div className={styles.tableList}&gt;  
            &lt;div className={styles.tableListOperator}&gt;  
              &lt;Button icon=&quot;plus&quot; type=&quot;primary&quot; onClick={() =&gt; this.handleModalVisible(true)}&gt;  
                添加商户配置  
              &lt;/Button&gt;  
            &lt;/div&gt;  
            &lt;StandardTable  
              selectedRows={selectedRows}  
              loading={isLoading}  
              data={newdata}  
              columns={columns}  
            /&gt;  
          &lt;/div&gt;  
        &lt;/Card&gt;  
        &lt;CreateForm {...parentMethods} modalVisible={modalVisible}/&gt;  
      &lt;/PageHeaderLayout&gt;  
    );  
  }  
}  
  
</code></pre>  
  
<ul>  
<li>最终完成这个页面，进行访问查看。<br />  
</li>  
</ul>  
  
<p><img src="http://112firshme11224.test.upcdn.net/demos/104d4e32-f0f8-4a54-8f87-a839fce15176.png" alt="" /></p>  
  
<p>转载请注明出处，本文采用 <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a> 协议授权</p>  

</div>


<h3>   &nbsp;&nbsp;&nbsp;留言：</h3>
<div id="comment-list"></div>


<div id="comment-form" class="was-validated">
    <div class="form-group">
    <textarea id="comment_input" name="comment_input" class="form-control" placeholder="Your comment" required="required" ></textarea>
        <div class="valid-feedback">验证成功！</div>
        <div class="invalid-feedback">请输入内容！</div>
    </div>
    <div class="form-group">
    <input id="username_input" name="username_input"  class="form-control"  placeholder="Your username" required="required">
        <div class="valid-feedback">验证成功！</div>
        <div class="invalid-feedback">请输入内容！</div>
    </div>
    <input id="website_input" name="website_input" placeholder="Your website" required="required">
    <button id="submit-button">Submit Comment</button>
    <input id="root-id_input" type="hidden" value="">
    <input id="parent-id_input" type="hidden" value="">
</div>
<script src="comment.js"></script>

</body>

</html>