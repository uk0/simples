<!DOCTYPE html>
<html>
<head>
<style>
body {
  max-width: 820px;
  margin: 0 auto;
  padding: 20px;
  font-family: sans-serif;
  background-color: #f5f5f5;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  transition: background-color 0.3s ease;
}

h1 {
  font-size: 20px;
}

h2 {
  font-size: 18px;
}

h3 {
  font-size: 16px;
}

h4 {
  font-size: 14px;
}

h5 {
  font-size: 12px;
}

h6 {
  font-size: 11px;
}

code {
  background-color: #eee;
  padding: 2px 5px;
  border-radius: 3px;
}

pre {
  background-color: #f5f5f5;
  padding: 10px;
  border-radius: 5px;
  overflow-x: auto;
}

.highlight,
.prism-code {
  background-color: #f5f5f5;
  padding: 10px;
  border-radius: 5px;
  overflow-x: auto;
}

footer {
  text-align: center;
  padding: 10px 0;
  font-size: 12px;
}

.title,
.description,
.keywords {
  text-align: center;
}
</style>
<meta charset="UTF-8">
<title>oracle for docker dev ENV</title>
<meta name="description" content="oracle 链解决方案。">
<meta name="keywords" content="oracle docker">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
<script>
  hljs.highlightAll();
  document.addEventListener('DOMContentLoaded', function() {
    const currentTime = new Date();
    const hour = currentTime.getHours();
    if (hour >= 19 || hour < 7) {
      document.body.style.backgroundColor = '#222';
    }
  });
</script>
</head>
<body>
<h1 class="title">oracle for docker dev ENV</h1>
<p class="description">oracle 链解决方案。</p>
<p class="keywords">oracle docker</p>

<p>oracle 服务采用 Docker 搭建，用的镜像为`wnameless/oracle-xe-11g` 这里负责整理用来测试时候的问题。</p>

<h2> 下载镜像(pull)</h2>

<pre><code class="bash">docker pull wnameless/oracle-xe-11g
</code></pre>

<pre><code class="bash">docker run -d -p 49160:22 -p 49161:1521 -e ORACLE_ALLOW_REMOTE=true wnameless/oracle-xe-11g
</code></pre>

<p>By default, the password verification is disable(password never expired). If you want it back, run this:</p>

<pre><code class="bash">docker run -d -p 49160:22 -p 49161:1521 -e ORACLE_PASSWORD_VERIFY=true wnameless/oracle-xe-11g
</code></pre>

<p>For performance concern, you may want to disable the disk asynch IO:</p>

<pre><code class="bash">docker run -d -p 49160:22 -p 49161:1521 -e ORACLE_DISABLE_ASYNCH_IO=true wnameless/oracle-xe-11g
</code></pre>

<p>For XDB user, run this:</p>

<pre><code class="bash">docker run -d -p 49160:22 -p 49161:1521 -p 8080:8080 -e ORACLE_ENABLE_XDB=true wnameless/oracle-xe-11g
</code></pre>

<p>Check if localhost:8080 work</p>

<pre><code class="bash">curl -XGET "http://localhost:8080"
</code></pre>

<p>You will show</p>

<pre><code class="html">
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML><HEAD>
<TITLE>401 Unauthorized</TITLE>
</HEAD><BODY><H1>Unauthorized</H1>
</BODY></HTML>

</code></pre>

<h2> Login http://localhost:8080 with following credential:</h2>

<p>username: XDB</p>
<p>password: xdb</p>

<p>Connect database with following setting:</p>

<p>hostname: localhost</p>
<p>port: 49161</p>
<p>sid: xe</p>
<p>username: system</p>
<p>password: oracle</p>

<p>Password for SYS &amp; SYSTEM</p>

<p>oracle</p>

<h2> Login by SSH</h2>

<pre><code class="bash">ssh root@localhost -p 49160
</code></pre>

<p>password: admin</p>

<h2> Support custom DB Initialization</h2>

<h2> Dockerfile</h2>

<pre><code class="dockerfile">FROM wnameless/oracle-xe-11g

ADD init.sql /docker-entrypoint-initdb.d/
</code></pre>

<h2> SQLDeveloper</h2>

<pre><code class="sql">--- 遇到的问题 ora-01045

---ORA-01045: user ... lacks CREATE SESSION privilege; logon denied
--- This error is thrown if a user wants to log on a database but lacks the create session system privilege.
---In order to give someone this privilege, use:

grant create session to aom;
--- See also other Oracle errors.

--- 创建表空间
CREATE   TABLESPACE aom
DATAFILE '/data/disk1/aom_space.dbf' size 500m
AUTOEXTEND ON
NEXT 200M MAXSIZE 20480M
EXTENT MANAGEMENT LOCAL;
--- oracle 创建DB需要用用户去创建，也就是先要创建用户 并且指定表空间
CREATE USER aom IDENTIFIED BY 123456 DEFAULT TABLESPACE aom_space;

---创建用户并指定表空间和临时表空间
CREATE USER aom IDENTIFIED BY 123456
DEFAULT TABLESPACE aom_space
TEMPORARY TABLESPACE aom_temp;

---授权用户
GRANT CREATE USER,DROP USER,ALTER USER ,CREATE ANY VIEW ,
     DROP ANY VIEW,EXP_FULL_DATABASE,IMP_FULL_DATABASE,
     DBA,CONNECT,RESOURCE,CREATE SESSION TO  aom;


---删除表空间
DROP TABLESPACE aom_space INCLUDING CONTENTS AND DATAFILES;


---查看表空间
SELECT tv.TABLESPACE_NAME "TABLESPACE_NAME",TOTALSPACE "TOTALSPACE/M",FREESPACE "FREESPACE/M",ROUND((1-FREESPACE/TOTALSPACE)*100,2) "USED%"
FROM
(SELECT TABLESPACE_NAME,ROUND(SUM(bytes)/1024/1024) TOTALSPACE FROM    DBA_DATA_FILES GROUP BY TABLESPACE_NAME) tv,
         (SELECT TABLESPACE_NAME,ROUND(SUM(bytes)/1024/1024) FREESPACE FROM DBA_FREE_SPACE GROUP BY TABLESPACE_NAME) fs
WHERE tv.TABLESPACE_NAME=fs.TABLESPACE_NAME;


---查看临时表空间
SELECT TABLESPACE_NAME FROM DBA_TABLESPACES;

---增加表空间大小
ALTER TABLESPACE aom_space ADD DATAFILE '/data/disk1/aom_space.dbf' size 4096M;

---增加临时表空间大小
ALTER DATABASE TEMPFILE '/data/disk1/aom_temp.dbf' RESIZE 8192M;

---删除用户
DROP USER aom CASCADE

---把数据导入不同于原系统的表空间，在导入之后却往往发现，数据被导入了原表空间(下面解决此方法)
grant connect, resource,dba to aom;
---回收用户unlimited tablespace权限，这样就可以导入到用户缺省表空间：
revoke unlimited tablespace from aom;
alter user aom quota 0 on aom_space;
alter user aom quota unlimited on aom_space;
</code></pre>

<footer>
  Power By Gemini TextGenerate 2024-09-16
</footer>
</body>
</html>