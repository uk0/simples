<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nginx 分段配置负载均衡[原创]</title>
  <meta name="description" content="Nginx 分段配置负载均衡，提供完整的Nginx配置示例，包括upstream和vhost配置，并附带相关图片说明。">
  <meta name="keywords" content="linux, 负载均衡, Nginx">
  <style>
    body {
      background-color: #222;
      color: #eee;
      font-family: sans-serif;
      max-width: 820px;
      margin: 0 auto;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    h1, h2, h3, h4, h5, h6 {
      text-align: center;
      margin-top: 2em;
    }

    h1 {
      font-size: 20px;
    }

    h2 {
      font-size: 18px;
    }

    h3 {
      font-size: 16px;
    }

    h4 {
      font-size: 14px;
    }

    h5 {
      font-size: 12px;
    }

    h6 {
      font-size: 11px;
    }

    code {
      background-color: #333;
      color: #eee;
      padding: 2px 4px;
      border-radius: 4px;
    }

    pre {
      background-color: #282c34;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }

    img {
      max-width: 100%;
      display: block;
      margin: 20px auto;
    }

    footer {
      text-align: center;
      font-size: 12px;
      margin-top: 20px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script>
    hljs.highlightAll();
  </script>
</head>
<body>
  <h1>Nginx 分段配置负载均衡[原创]</h1>
  <p>date：2017-11-06</p>
  <p>author：zhangjianxin</p>
  <h2>解决方案</h2>
  <h3>nginx config</h3>
  <pre><code class="bash">
user  nginx;
worker_processes  5;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;
worker_rlimit_nofile 1024;

events {
  worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                     '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    log_format  error '$remote_addr - $remote_user [$time_local] "$request" '
                     '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  logs/access.log  main;

    sendfile        on;

    keepalive_timeout  65;

    gzip  on;
    include /etc/nginx/conf.d/upstream/*.conf;
    include /etc/nginx/conf.d/vhost/*.conf;
}
  </code></pre>
  <h3>nginx upstream config</h3>
  <pre><code class="bash">
upstream post_servers {
    ip_hash;
    server dscn01:80 weight=5 backup;
    server dscn02:80 weight=10 max_fails=3 fail_timeout=30s;
}
  </code></pre>
  <h3>nginx vhost  config</h3>
  <pre><code class="bash">
server {
    listen       80;      #监听80端口
    access_log   logs/post.access.log main;  #使用main等级配置访问日志。
    error_log    logs/post.error.log error;          #使用error等级配置错误日志。

    set $post_servers_upstream   "post_servers";   #使用set指令配置upstream为：'post_servers'
    location / {  #将所有的请求代理到post_servers_upstream中。
      proxy_pass      http://$post_servers_upstream;
    }
  }
  </code></pre>
  <img src="http://112firshme11224.test.upcdn.net/images/WX20171106-142637@2x.png" alt="nginx config">
  <img src="http://112firshme11224.test.upcdn.net/images/WX20171106-142733@2x.png" alt="nginx vhost config">
  <p>* 以上操作经过验证可以直接拿去。</p>
  <p>* auther <code>breakEval13</code></p>
  <p>* <a href="https://github.com/breakEval13">https://github.com/breakEval13</a></p>
  <footer>
    Power By Gemini TextGenerate 2024-09-16 21:24:05
  </footer>
</body>
</html>