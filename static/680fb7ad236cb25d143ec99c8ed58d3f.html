
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="在kubernetes集群部署cdh 并且部署hadoop 服务。">
    <meta name="keywords" content="hadoop cdh kubernetes">
    <title>kubernetes 部署cdh 通过 NASNFS）进行文件存储。</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --day-bg: #ffffff;
            --day-text: #333333;
            --night-bg: #1a1a1a;
            --night-text: #f0f0f0;
        }

        body {
            max-width: 820px;
            margin: 0 auto;
            padding: 20px;
            line-height: 21px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .metadata {
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }

        .metadata p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        .day-mode {
            background-color: var(--day-bg);
            color: var(--day-text);
        }

        .night-mode {
            background-color: var(--night-bg);
            color: var(--night-text);
        }

        h1 { font-size: 19px; text-align: center; }
        h2 { font-size: 18px; }
        h3 { font-size: 16px; }
        h4 { font-size: 14px; }
        h5 { font-size: 12px; }
        h6 { font-size: 11px; }

        pre {
            line-height: 24px;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        code {
            font-family: 'Fira Code', Consolas, Monaco, 'Courier New', monospace;
        }

        img {
            display: block;
            max-width: 600px;
            height: auto;
            margin: 20px auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .content {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.05);
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid #ddd;
            font-size: 0.9em;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .content {
            animation: fadeIn 0.5s ease-in;
        }
    </style>
</head>
<body class="day-mode">
    <div class="metadata">
        <p><strong>Title:</strong> kubernetes 部署cdh 通过 NASNFS）进行文件存储。</p>
        <p><strong>Categories:</strong> cdh</p>
        <p><strong>Description:</strong> 在kubernetes集群部署cdh 并且部署hadoop 服务。</p>
        <p><strong>Keywords:</strong> hadoop cdh kubernetes</p>
    </div>
    <div class="content">
        <p>技术验证篇，通过Kubernetes搭建一个可扩展的 CDH，并且启动hadoop。</p>
<h2 id="quick">Quick</h2>
<ul>
<li>主要用到<code>Kubernetes</code> 阿里云</li>
<li>镜像来源 <code>https://github.com/windawings/spot-docker</code> .</li>
<li>启动文件.<code>yaml</code>文件</li>
<li>NAS 阿里云弹性存储 NAS</li>
</ul>
<h2 id="_1">注意</h2>
<ul>
<li>NAS 需要开启<code>VPC</code>网络安全组</li>
<li>镜像需要上传到自己的私有仓库</li>
<li>
<p>Kubernetes 下载镜像需要配置<code>yaml &lt;&lt; imagePullSecrets</code>,文章结尾会将<code>yaml</code>奉上</p>
</li>
<li>
<p>Kubernetes默认会创建一个<code>SLB</code>（用来给Ingress 使用)，我们用来暴露CDH的<code>UI</code>就是需要采用 <code>Ingress</code> 来进行暴露。</p>
</li>
<li><code>Ingress</code> 所在 <code>Namespace = kube-system</code></li>
</ul>
<p><img alt="" src="/static/demos/17612368-36b7-49c3-bcbd-6bd7848c849a.png" /></p>
<ul>
<li>域名解析 注意是<code>泛域名</code></li>
</ul>
<h2 id="_2">开始部署</h2>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-sa</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">automountServiceAccountToken</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-cr</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cr</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nonResourceURLs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-crb</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crb</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-sa</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-cr</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-config</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-config</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">master_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master-svc</span>
<span class="w">  </span><span class="nt">cron.tab</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">*/30 * * * * ntpdate master-svc &amp;&amp; hwclock --systohc</span>

<span class="w">  </span><span class="nt">config.ini</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">    </span><span class="no">[General]</span>
<span class="w">    </span><span class="no"># Hostname of the CM server.</span>
<span class="w">    </span><span class="no">server_host=master-svc</span>

<span class="w">    </span><span class="no"># Port that the CM server is listening on.</span>
<span class="w">    </span><span class="no">server_port=7182</span>

<span class="w">    </span><span class="no">## It should not normally be necessary to modify these.</span>
<span class="w">    </span><span class="no"># Port that the CM agent should listen on.</span>
<span class="w">    </span><span class="no"># listening_port=9000</span>

<span class="w">    </span><span class="no"># IP Address that the CM agent should listen on.</span>
<span class="w">    </span><span class="no"># listening_ip=</span>

<span class="w">    </span><span class="no"># Hostname that the CM agent reports as its hostname. If unset, will be</span>
<span class="w">    </span><span class="no"># obtained in code through something like this:</span>
<span class="w">    </span><span class="no">#</span>
<span class="w">    </span><span class="no">#   python -c &#39;import socket; \</span>
<span class="w">    </span><span class="no">#              print socket.getfqdn(), \</span>
<span class="w">    </span><span class="no">#                    socket.gethostbyname(socket.getfqdn())&#39;</span>
<span class="w">    </span><span class="no">#</span>
<span class="w">    </span><span class="no"># listening_hostname=</span>

<span class="w">    </span><span class="no"># An alternate hostname to report as the hostname for this host in CM.</span>
<span class="w">    </span><span class="no"># Useful when this agent is behind a load balancer or proxy and all</span>
<span class="w">    </span><span class="no"># inbound communication must connect through that proxy.</span>
<span class="w">    </span><span class="no"># reported_hostname=</span>

<span class="w">    </span><span class="no"># Port that supervisord should listen on.</span>
<span class="w">    </span><span class="no"># NB: This only takes effect if supervisord is restarted.</span>
<span class="w">    </span><span class="no"># supervisord_port=19001</span>

<span class="w">    </span><span class="no"># Log file.  The supervisord log file will be placed into</span>
<span class="w">    </span><span class="no"># the same directory.  Note that if the agent is being started via the</span>
<span class="w">    </span><span class="no"># init.d script, /var/log/cloudera-scm-agent/cloudera-scm-agent.out will</span>
<span class="w">    </span><span class="no"># also have a small amount of output (from before logging is initialized).</span>
<span class="w">    </span><span class="no"># log_file=/var/log/cloudera-scm-agent/cloudera-scm-agent.log</span>

<span class="w">    </span><span class="no"># Persistent state directory.  Directory to store CM agent state that</span>
<span class="w">    </span><span class="no"># persists across instances of the agent process and system reboots.</span>
<span class="w">    </span><span class="no"># Particularly, the agent&#39;s UUID is stored here.</span>
<span class="w">    </span><span class="no"># lib_dir=/var/lib/cloudera-scm-agent</span>

<span class="w">    </span><span class="no"># Parcel directory.  Unpacked parcels will be stored in this directory.</span>
<span class="w">    </span><span class="no"># Downloaded parcels will be stored in &lt;parcel_dir&gt;/../parcel-cache</span>
<span class="w">    </span><span class="no"># parcel_dir=/opt/cloudera/parcels</span>

<span class="w">    </span><span class="no"># Enable supervisord event monitoring.  Used in eager heartbeating, amongst</span>
<span class="w">    </span><span class="no"># other things.</span>
<span class="w">    </span><span class="no"># enable_supervisord_events=true</span>

<span class="w">    </span><span class="no"># Maximum time to wait (in seconds) for all metric collectors to finish</span>
<span class="w">    </span><span class="no"># collecting data.</span>
<span class="w">    </span><span class="no">max_collection_wait_seconds=10.0</span>

<span class="w">    </span><span class="no"># Maximum time to wait (in seconds) when connecting to a local role&#39;s</span>
<span class="w">    </span><span class="no"># webserver to fetch metrics.</span>
<span class="w">    </span><span class="no">metrics_url_timeout_seconds=30.0</span>

<span class="w">    </span><span class="no"># Maximum time to wait (in seconds) when connecting to a local TaskTracker</span>
<span class="w">    </span><span class="no"># to fetch task attempt data.</span>
<span class="w">    </span><span class="no">task_metrics_timeout_seconds=5.0</span>

<span class="w">    </span><span class="no"># The list of non-device (nodev) filesystem types which will be monitored.</span>
<span class="w">    </span><span class="no">monitored_nodev_filesystem_types=nfs,nfs4,tmpfs</span>

<span class="w">    </span><span class="no"># The list of filesystem types which are considered local for monitoring purposes.</span>
<span class="w">    </span><span class="no"># These filesystems are combined with the other local filesystem types found in</span>
<span class="w">    </span><span class="no"># /proc/filesystems</span>
<span class="w">    </span><span class="no">local_filesystem_whitelist=ext2,ext3,ext4,xfs</span>

<span class="w">    </span><span class="no"># The largest size impala profile log bundle that this agent will serve to the</span>
<span class="w">    </span><span class="no"># CM server. If the CM server requests more than this amount, the bundle will</span>
<span class="w">    </span><span class="no"># be limited to this size. All instances of this limit being hit are logged to</span>
<span class="w">    </span><span class="no"># the agent log.</span>
<span class="w">    </span><span class="no">impala_profile_bundle_max_bytes=1073741824</span>

<span class="w">    </span><span class="no"># The largest size stacks log bundle that this agent will serve to the CM</span>
<span class="w">    </span><span class="no"># server. If the CM server requests more than this amount, the bundle will be</span>
<span class="w">    </span><span class="no"># limited to this size. All instances of this limit being hit are logged to the</span>
<span class="w">    </span><span class="no"># agent log.</span>
<span class="w">    </span><span class="no">stacks_log_bundle_max_bytes=1073741824</span>

<span class="w">    </span><span class="no"># The size to which the uncompressed portion of a stacks log can grow before it</span>
<span class="w">    </span><span class="no"># is rotated. The log will then be compressed during rotation.</span>
<span class="w">    </span><span class="no">stacks_log_max_uncompressed_file_size_bytes=5242880</span>

<span class="w">    </span><span class="no"># The orphan process directory staleness threshold. If a diretory is more stale</span>
<span class="w">    </span><span class="no"># than this amount of seconds, CM agent will remove it.</span>
<span class="w">    </span><span class="no">orphan_process_dir_staleness_threshold=5184000</span>

<span class="w">    </span><span class="no"># The orphan process directory refresh interval. The CM agent will check the</span>
<span class="w">    </span><span class="no"># staleness of the orphan processes config directory every this amount of</span>
<span class="w">    </span><span class="no"># seconds.</span>
<span class="w">    </span><span class="no">orphan_process_dir_refresh_interval=3600</span>

<span class="w">    </span><span class="no"># A knob to control the agent logging level. The options are listed as follows:</span>
<span class="w">    </span><span class="no"># 1) DEBUG (set the agent logging level to &#39;logging.DEBUG&#39;)</span>
<span class="w">    </span><span class="no"># 2) INFO (set the agent logging level to &#39;logging.INFO&#39;)</span>
<span class="w">    </span><span class="no">scm_debug=INFO</span>

<span class="w">    </span><span class="no"># The DNS resolution collecion interval in seconds. A java base test program</span>
<span class="w">    </span><span class="no"># will be executed with at most this frequency to collect java DNS resolution</span>
<span class="w">    </span><span class="no"># metrics. The test program is only executed if the associated health test,</span>
<span class="w">    </span><span class="no"># Host DNS Resolution, is enabled.</span>
<span class="w">    </span><span class="no">dns_resolution_collection_interval_seconds=60</span>

<span class="w">    </span><span class="no"># The maximum time to wait (in seconds) for the java test program to collect</span>
<span class="w">    </span><span class="no"># java DNS resolution metrics.</span>
<span class="w">    </span><span class="no">dns_resolution_collection_timeout_seconds=30</span>

<span class="w">    </span><span class="no"># The directory location in which the agent-wide kerberos credential cache</span>
<span class="w">    </span><span class="no"># will be created.</span>
<span class="w">    </span><span class="no"># agent_wide_credential_cache_location=/var/run/cloudera-scm-agent</span>

<span class="w">    </span><span class="no">[Security]</span>
<span class="w">    </span><span class="no"># Use TLS and certificate validation when connecting to the CM server.</span>
<span class="w">    </span><span class="no">use_tls=0</span>

<span class="w">    </span><span class="no"># The maximum allowed depth of the certificate chain returned by the peer.</span>
<span class="w">    </span><span class="no"># The default value of 9 matches the default specified in openssl&#39;s</span>
<span class="w">    </span><span class="no"># SSL_CTX_set_verify.</span>
<span class="w">    </span><span class="no">max_cert_depth=9</span>

<span class="w">    </span><span class="no"># A file of CA certificates in PEM format. The file can contain several CA</span>
<span class="w">    </span><span class="no"># certificates identified by</span>
<span class="w">    </span><span class="no">#</span>
<span class="w">    </span><span class="no"># -----BEGIN CERTIFICATE-----</span>
<span class="w">    </span><span class="no"># ... (CA certificate in base64 encoding) ...</span>
<span class="w">    </span><span class="no"># -----END CERTIFICATE-----</span>
<span class="w">    </span><span class="no">#</span>
<span class="w">    </span><span class="no"># sequences. Before, between, and after the certificates text is allowed which</span>
<span class="w">    </span><span class="no"># can be used e.g. for descriptions of the certificates.</span>
<span class="w">    </span><span class="no">#</span>
<span class="w">    </span><span class="no"># The file is loaded once, the first time an HTTPS connection is attempted. A</span>
<span class="w">    </span><span class="no"># restart of the agent is required to pick up changes to the file.</span>
<span class="w">    </span><span class="no">#</span>
<span class="w">    </span><span class="no"># Note that if neither verify_cert_file or verify_cert_dir is set, certificate</span>
<span class="w">    </span><span class="no"># verification will not be performed.</span>
<span class="w">    </span><span class="no"># verify_cert_file=</span>

<span class="w">    </span><span class="no"># Directory containing CA certificates in PEM format. The files each contain one</span>
<span class="w">    </span><span class="no"># CA certificate. The files are looked up by the CA subject name hash value,</span>
<span class="w">    </span><span class="no"># which must hence be available. If more than one CA certificate with the same</span>
<span class="w">    </span><span class="no"># name hash value exist, the extension must be different (e.g. 9d66eef0.0,</span>
<span class="w">    </span><span class="no"># 9d66eef0.1 etc). The search is performed in the ordering of the extension</span>
<span class="w">    </span><span class="no"># number, regardless of other properties of the certificates. Use the c_rehash</span>
<span class="w">    </span><span class="no"># utility to create the necessary links.</span>
<span class="w">    </span><span class="no">#</span>
<span class="w">    </span><span class="no"># The certificates in the directory are only looked up when required, e.g. when</span>
<span class="w">    </span><span class="no"># building the certificate chain or when actually performing the verification</span>
<span class="w">    </span><span class="no"># of a peer certificate. The contents of the directory can thus be changed</span>
<span class="w">    </span><span class="no"># without an agent restart.</span>
<span class="w">    </span><span class="no">#</span>
<span class="w">    </span><span class="no"># When looking up CA certificates, the verify_cert_file is first searched, then</span>
<span class="w">    </span><span class="no"># those in the directory. Certificate matching is done based on the subject name,</span>
<span class="w">    </span><span class="no"># the key identifier (if present), and the serial number as taken from the</span>
<span class="w">    </span><span class="no"># certificate to be verified. If these data do not match, the next certificate</span>
<span class="w">    </span><span class="no"># will be tried. If a first certificate matching the parameters is found, the</span>
<span class="w">    </span><span class="no"># verification process will be performed; no other certificates for the same</span>
<span class="w">    </span><span class="no"># parameters will be searched in case of failure.</span>
<span class="w">    </span><span class="no">#</span>
<span class="w">    </span><span class="no"># Note that if neither verify_cert_file or verify_cert_dir is set, certificate</span>
<span class="w">    </span><span class="no"># verification will not be performed.</span>
<span class="w">    </span><span class="no"># verify_cert_dir=</span>

<span class="w">    </span><span class="no"># PEM file containing client private key.</span>
<span class="w">    </span><span class="no"># client_key_file=</span>

<span class="w">    </span><span class="no"># A command to run which returns the client private key password on stdout</span>
<span class="w">    </span><span class="no"># client_keypw_cmd=</span>

<span class="w">    </span><span class="no"># If client_keypw_cmd isn&#39;t specified, instead a text file containing</span>
<span class="w">    </span><span class="no"># the client private key password can be used.</span>
<span class="w">    </span><span class="no"># client_keypw_file=</span>

<span class="w">    </span><span class="no"># PEM file containing client certificate.</span>
<span class="w">    </span><span class="no"># client_cert_file=</span>

<span class="w">    </span><span class="no">## Location of Hadoop files.  These are the CDH locations when installed by</span>
<span class="w">    </span><span class="no">## packages.  Unused when CDH is installed by parcels.</span>
<span class="w">    </span><span class="no">[Hadoop]</span>
<span class="w">    </span><span class="no">#cdh_crunch_home=/usr/lib/crunch</span>
<span class="w">    </span><span class="no">#cdh_flume_home=/usr/lib/flume-ng</span>
<span class="w">    </span><span class="no">#cdh_hadoop_bin=/usr/bin/hadoop</span>
<span class="w">    </span><span class="no">#cdh_hadoop_home=/usr/lib/hadoop</span>
<span class="w">    </span><span class="no">#cdh_hbase_home=/usr/lib/hbase</span>
<span class="w">    </span><span class="no">#cdh_hbase_indexer_home=/usr/lib/hbase-solr</span>
<span class="w">    </span><span class="no">#cdh_hcat_home=/usr/lib/hive-hcatalog</span>
<span class="w">    </span><span class="no">#cdh_hdfs_home=/usr/lib/hadoop-hdfs</span>
<span class="w">    </span><span class="no">#cdh_hive_home=/usr/lib/hive</span>
<span class="w">    </span><span class="no">#cdh_httpfs_home=/usr/lib/hadoop-httpfs</span>
<span class="w">    </span><span class="no">#cdh_hue_home=/usr/share/hue</span>
<span class="w">    </span><span class="no">#cdh_hue_plugins_home=/usr/lib/hadoop</span>
<span class="w">    </span><span class="no">#cdh_impala_home=/usr/lib/impala</span>
<span class="w">    </span><span class="no">#cdh_llama_home=/usr/lib/llama</span>
<span class="w">    </span><span class="no">#cdh_mr1_home=/usr/lib/hadoop-0.20-mapreduce</span>
<span class="w">    </span><span class="no">#cdh_mr2_home=/usr/lib/hadoop-mapreduce</span>
<span class="w">    </span><span class="no">#cdh_oozie_home=/usr/lib/oozie</span>
<span class="w">    </span><span class="no">#cdh_parquet_home=/usr/lib/parquet</span>
<span class="w">    </span><span class="no">#cdh_pig_home=/usr/lib/pig</span>
<span class="w">    </span><span class="no">#cdh_solr_home=/usr/lib/solr</span>
<span class="w">    </span><span class="no">#cdh_spark_home=/usr/lib/spark</span>
<span class="w">    </span><span class="no">#cdh_sqoop_home=/usr/lib/sqoop</span>
<span class="w">    </span><span class="no">#cdh_sqoop2_home=/usr/lib/sqoop2</span>
<span class="w">    </span><span class="no">#cdh_yarn_home=/usr/lib/hadoop-yarn</span>
<span class="w">    </span><span class="no">#cdh_zookeeper_home=/usr/lib/zookeeper</span>
<span class="w">    </span><span class="no">#hive_default_xml=/etc/hive/conf.dist/hive-default.xml</span>
<span class="w">    </span><span class="no">#webhcat_default_xml=/etc/hive-webhcat/conf.dist/webhcat-default.xml</span>
<span class="w">    </span><span class="no">#jsvc_home=/usr/libexec/bigtop-utils</span>
<span class="w">    </span><span class="no">#tomcat_home=/usr/lib/bigtop-tomcat</span>
<span class="w">    </span><span class="no">#oracle_home=/usr/share/oracle/instantclient</span>

<span class="w">    </span><span class="no">## Location of Cloudera Management Services files.</span>
<span class="w">    </span><span class="no">[Cloudera]</span>
<span class="w">    </span><span class="no">#mgmt_home=/usr/share/cmf</span>

<span class="w">    </span><span class="no">## Location of JDBC Drivers.</span>
<span class="w">    </span><span class="no">[JDBC]</span>
<span class="w">    </span><span class="no">cloudera_mysql_connector_jar=/usr/java/latest/mysql-connector-java.jar</span>
<span class="w">    </span><span class="no">#cloudera_oracle_connector_jar=/usr/share/java/oracle-connector-java.jar</span>
<span class="w">    </span><span class="no">#By default, postgres jar is found dynamically in $MGMT_HOME/lib</span>
<span class="w">    </span><span class="no">#cloudera_postgresql_jdbc_jar=</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs-deploy</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs-client</span>
<span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">tolerations</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node-role.kubernetes.io/master</span>
<span class="w">        </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NoSchedule</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-sa</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.cn-hangzhou.aliyuncs.com/acs/alicloud-nas-controller:v1.8.4</span>
<span class="c1">#        imagePullPolicy: Never</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs-client</span>
<span class="c1">#        securityContext:</span>
<span class="c1">#          privileged: true</span>
<span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs-client-root</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/persistentvolumes</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PROVISIONER_NAME</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alicloud/nas</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NFS_SERVER</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">074ca49d80-ak47.cn-hangzhou.nas.aliyuncs.com</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NFS_PATH</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/pv/cloudera/agent/</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs-client-root</span>
<span class="w">        </span><span class="nt">nfs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">074ca49d80-ak47.cn-hangzhou.nas.aliyuncs.com</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/pv/cloudera/agent/</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-storage</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">storage</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">reclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Delete</span>
<span class="nt">provisioner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alicloud/nas</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master-deploy</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master-deploy</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">tolerations</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NoSchedule</span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node-role.kubernetes.io/master</span>
<span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-sa</span>
<span class="w">      </span><span class="nt">automountServiceAccountToken</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master-svc</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-master</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry-vpc.cn-hangzhou.aliyuncs.com/huaching_prod/cloudera-master:5.14.2</span>
<span class="c1">#        imagePullPolicy: IfNotPresent</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4096Mi&quot;</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1000m&quot;</span>
<span class="w">        </span><span class="nt">lifecycle</span><span class="p">:</span>
<span class="w">          </span><span class="nt">preStop</span><span class="p">:</span>
<span class="w">            </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/bin/bash&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;/cloudera-init/run/stop.sh</span><span class="nv"> </span><span class="s">&gt;&gt;</span><span class="nv"> </span><span class="s">/cloudera/log/stop.log</span><span class="nv"> </span><span class="s">2&gt;&amp;1&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">        </span><span class="c1">#- name: cloudera-init</span>
<span class="w">          </span><span class="c1">#mountPath: /cloudera-init/run/</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/mysql/</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repo</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/cloudera/parcel-repo/</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/cm/etc/cloudera-scm-agent/</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HOSTNAME</span>
<span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">            </span><span class="nt">configMapKeyRef</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-config</span>
<span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master_host</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POD_IP</span>
<span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">            </span><span class="nt">fieldRef</span><span class="p">:</span>
<span class="w">              </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">              </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">status.podIP</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POD_NAME</span>
<span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">            </span><span class="nt">fieldRef</span><span class="p">:</span>
<span class="w">              </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">              </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metadata.name</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7180</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ui</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7182</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7191</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parcel</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4434</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parcel-ssl</span>
<span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">          </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">imagePullSecrets</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registrykey-vpc</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repo</span>
<span class="w">        </span><span class="nt">nfs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">074ca49d80-ak47.cn-hangzhou.nas.aliyuncs.com</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/pv/cloudera/repo/</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="w">        </span><span class="nt">nfs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">074ca49d80-ak47.cn-hangzhou.nas.aliyuncs.com</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/pv/cloudera/master/</span>
<span class="w">      </span><span class="c1">#- name: cloudera-init</span>
<span class="w">        </span><span class="c1">#configMap:</span>
<span class="w">          </span><span class="c1">#name: cloudera-config</span>
<span class="w">          </span><span class="c1">#defaultMode: 0751</span>
<span class="w">          </span><span class="c1">#items:</span>
<span class="w">          </span><span class="c1">#- key: master.start</span>
<span class="w">            </span><span class="c1">#path: start.sh</span>
<span class="w">          </span><span class="c1">#- key: master.stop</span>
<span class="w">            </span><span class="c1">#path: stop.sh</span>
<span class="w">          </span><span class="c1">#- key: mysql.sql</span>
<span class="w">            </span><span class="c1">#path: mysql.sql</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">        </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-config</span>
<span class="w">          </span><span class="nt">items</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.ini</span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.ini</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master-svc</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master-svc</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">    </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7182</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7182</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parcel</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7191</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7191</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parcel-ssl</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4434</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4434</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ui</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7180</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7180</span>
<span class="w">    </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master-external</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master-external</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ui</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7180</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7180</span>
<span class="w">    </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodDisruptionBudget</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent-pdb</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent-pdb</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent-svc</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent-svc</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">    </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7182</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7182</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parcel</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7191</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7191</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parcel-ssl</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4434</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4434</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parcel-ssl2</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4433</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4433</span>
<span class="w">    </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent-sts</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent-svc</span>
<span class="w">  </span><span class="nt">updateStrategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
<span class="w">  </span><span class="nt">podManagementPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OrderedReady</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cagent</span>
<span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">tolerations</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NoSchedule</span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node-role.kubernetes.io/master</span>
<span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-sa</span>
<span class="w">      </span><span class="nt">automountServiceAccountToken</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry-vpc.cn-hangzhou.aliyuncs.com/huaching_prod/cloudera-node:5.14.2</span>
<span class="c1">#        imagePullPolicy: IfNotPresent</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4096Mi&quot;</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1000m&quot;</span>
<span class="w">        </span><span class="nt">lifecycle</span><span class="p">:</span>
<span class="w">          </span><span class="nt">preStop</span><span class="p">:</span>
<span class="w">            </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/bin/bash&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;/cloudera-init/run/stop.sh&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repo</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/cloudera/parcel-repo/</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lib</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/cm/lib/cloudera-scm-agent/</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/cm/etc/cloudera-scm-agent/</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7182</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7191</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parcel</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4434</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parcel-ssl</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4433</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parcel-ssl2</span>
<span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">          </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">imagePullSecrets</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registrykey-vpc</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">        </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-config</span>
<span class="w">          </span><span class="nt">items</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.ini</span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.ini</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cron.tab</span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cron.tab</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repo</span>
<span class="w">        </span><span class="nt">nfs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">074ca49d80-ak47.cn-hangzhou.nas.aliyuncs.com</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/pv/cloudera/repo/</span>
<span class="w">  </span><span class="nt">volumeClaimTemplates</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lib</span>
<span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="c1">#volumeName: lib</span>
<span class="w">      </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
<span class="w">      </span><span class="nt">accessModes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;ReadWriteOnce&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera-storage</span>
<span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">        </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">          </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cdh-master-ing</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudera</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cdh.docs.aliyun.com</span>
<span class="w">    </span><span class="nt">http</span><span class="p">:</span>
<span class="w">      </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">          </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master-external</span>
<span class="w">          </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7180</span>
</code></pre></div>

<h2 id="_3">注意事项</h2>
<ul>
<li>创建<code>namespace cloudera</code></li>
<li>镜像来源已经在上方说明了,可以自己去<code>rebuild</code> </li>
<li>默认全部不会启动<code>command脚本可以看出</code></li>
<li>启动流程进入<code>Master-deploy </code> 去执行<code>start.sh</code>启动，根据机器情况，启动时间不等，期间可以用<code>netstat -tlunp</code> 查看端口是否占用来验证启动成功与否.</li>
<li><code>CDH</code> 需要用到Kubernetes的<code>特权模式</code>,相关细节请查关键字 <code>Kubernetes securityContext</code></li>
<li>
<p>部分界面如下：
<img alt="" src="/static/demos/2f2be0a5-ef33-4458-9cd4-433b9a3ebed4.png" /></p>
</li>
<li>
<p>服务界面</p>
<p><img alt="" src="/static/demos/3596a98d-8de0-4641-b2b6-e7904061479d.png" /></p>
</li>
<li>
<p>PVC 界面</p>
<p><img alt="" src="/static/demos/e68c1177-32c0-419b-8acd-eeecbfd702dc.png" /></p>
</li>
<li>
<p>CDH 节点界面</p>
<p><img alt="" src="/static/demos/49f7fc4a-2f25-4895-818a-0e6d296983b0.png" /></p>
</li>
<li>
<p>节点服务运行情况。
    <img alt="" src="/static/demos/a054ea06-ffcb-4340-bfc9-7b307d7cbc99.png" /></p>
</li>
</ul>
<h3 id="httpsgithubcomwindawings">感谢 https://github.com/windawings</h3>
<p>转载请注明出处，本文采用 <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a> 协议授权</p>
    </div>
    <footer>
        Power By Python Markdown Generate 2025-03-31 13:05:10
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });

        function setThemeMode() {
            const hour = new Date().getHours();
            const body = document.body;
            if (hour >= 18 || hour < 6) {
                body.classList.remove('day-mode');
                body.classList.add('night-mode');
            } else {
                body.classList.remove('night-mode');
                body.classList.add('day-mode');
            }
        }

        setThemeMode();
        setInterval(setThemeMode, 60000);
    </script>
</body>
</html>
