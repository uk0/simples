
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="将Tdengine 部署在k8s集群上,TDengine 集群模式">
    <meta name="keywords" content="tdengine kuubernetes">
    <title>Tdengine on k8s</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --day-bg: #ffffff;
            --day-text: #333333;
            --night-bg: #1a1a1a;
            --night-text: #f0f0f0;
        }

        body {
            max-width: 820px;
            margin: 0 auto;
            padding: 20px;
            line-height: 21px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .metadata {
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }

        .metadata p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        .day-mode {
            background-color: var(--day-bg);
            color: var(--day-text);
        }

        .night-mode {
            background-color: var(--night-bg);
            color: var(--night-text);
        }

        h1 { font-size: 19px; text-align: center; }
        h2 { font-size: 18px; }
        h3 { font-size: 16px; }
        h4 { font-size: 14px; }
        h5 { font-size: 12px; }
        h6 { font-size: 11px; }

        pre {
            line-height: 24px;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        code {
            font-family: 'Fira Code', Consolas, Monaco, 'Courier New', monospace;
        }

        img {
            display: block;
            max-width: 600px;
            height: auto;
            margin: 20px auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .content {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.05);
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid #ddd;
            font-size: 0.9em;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .content {
            animation: fadeIn 0.5s ease-in;
        }
    </style>
</head>
<body class="day-mode">
    <div class="metadata">
        <p><strong>Title:</strong> Tdengine on k8s</p>
        <p><strong>Categories:</strong> kubernetes</p>
        <p><strong>Description:</strong> 将Tdengine 部署在k8s集群上,TDengine 集群模式</p>
        <p><strong>Keywords:</strong> tdengine kuubernetes</p>
    </div>
    <div class="content">
        <p>将 Tdengine 集群模式部署到 Kubernetes ，支持扩节点，后面我会将自动脚本提交到 我的github。</p>
<h4 id="_1">准备</h4>
<ul>
<li>Tdengine 2.0.20 源代码</li>
<li>K8S集群(存储 nfs ceph)</li>
<li>yaml 文件</li>
</ul>
<h4 id="nfs">为集群创建 存储（使用nfs）</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># 这里面提前创建好了  storage = nfs</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testtdpvc1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20&quot;</span>
<span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testtdpvc2</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20&quot;</span>
<span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testtdpvc3</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20&quot;</span>
<span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs</span>
</code></pre></div>

<h4 id="_2">准备集群配置文件</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ms1.cnf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">########################################################</span>
<span class="w">    </span><span class="no">#                                                      #</span>
<span class="w">    </span><span class="no">#                  TDengine Configuration              #</span>
<span class="w">    </span><span class="no">#   Any questions, please email support@taosdata.com   #</span>
<span class="w">    </span><span class="no">#                                                      #</span>
<span class="w">    </span><span class="no">########################################################</span>

<span class="w">    </span><span class="no"># first fully qualified domain name (FQDN) for TDengine system</span>
<span class="w">    </span><span class="no">firstEp                   tdmnode-0.default.svc.cluster.local:6030</span>
<span class="w">    </span><span class="no">secondEp                  tdmnode-1.default.svc.cluster.local:6030</span>
<span class="w">    </span><span class="no"># local fully qualified domain name (FQDN)</span>
<span class="w">    </span><span class="no">fqdn                      tdmnode-0.default.svc.cluster.local</span>

<span class="w">    </span><span class="no"># first port number for the connection (12 continuous UDP/TCP port number are used)</span>
<span class="w">    </span><span class="no">serverPort                6030</span>

<span class="w">    </span><span class="no"># log file&#39;s director</span>
<span class="w">    </span><span class="no">logDir                    /etc/taos/log</span>

<span class="w">    </span><span class="no"># data file&#39;s directory</span>
<span class="w">    </span><span class="no">dataDir                   /etc/taos/data</span>

<span class="w">    </span><span class="no"># temporary file&#39;s directory</span>
<span class="w">    </span><span class="no">tempDir                   /tmp/</span>

<span class="w">    </span><span class="no"># the arbitrator&#39;s fully qualified domain name (FQDN) for TDengine system, for cluster only</span>
<span class="w">    </span><span class="no"># arbitrator                arbitrator_hostname:6042</span>

<span class="w">    </span><span class="no"># number of threads per CPU core</span>
<span class="w">    </span><span class="no"># numOfThreadsPerCore       1.0</span>

<span class="w">    </span><span class="no"># number of threads to commit cache data</span>
<span class="w">    </span><span class="no">numOfCommitThreads        4</span>

<span class="w">    </span><span class="no"># the proportion of total CPU cores available for query processing</span>
<span class="w">    </span><span class="no"># 2.0: the query threads will be set to double of the CPU cores.</span>
<span class="w">    </span><span class="no"># 1.0: all CPU cores are available for query processing [default].</span>
<span class="w">    </span><span class="no"># 0.5: only half of the CPU cores are available for query.</span>
<span class="w">    </span><span class="no"># 0.0: only one core available.</span>
<span class="w">    </span><span class="no"># ratioOfQueryCores        1.0</span>

<span class="w">    </span><span class="no"># the last_row/first/last aggregator will not change the original column name in the result fields</span>
<span class="w">    </span><span class="no"># keepColumnName            0</span>

<span class="w">    </span><span class="no"># number of management nodes in the system</span>
<span class="w">    </span><span class="no"># numOfMnodes               3</span>

<span class="w">    </span><span class="no"># enable/disable backuping vnode directory when removing vnode</span>
<span class="w">    </span><span class="no"># vnodeBak                  1</span>

<span class="w">    </span><span class="no"># enable/disable installation / usage report</span>
<span class="w">    </span><span class="no"># telemetryReporting        1</span>

<span class="w">    </span><span class="no"># enable/disable load balancing</span>
<span class="w">    </span><span class="no"># balance                   1</span>

<span class="w">    </span><span class="no"># role for dnode. 0 - any, 1 - mnode, 2 - dnode</span>
<span class="w">    </span><span class="no"># role                      0</span>

<span class="w">    </span><span class="no"># max timer control blocks</span>
<span class="w">    </span><span class="no"># maxTmrCtrl                512</span>

<span class="w">    </span><span class="no"># time interval of system monitor, seconds</span>
<span class="w">    </span><span class="no"># monitorInterval           30</span>

<span class="w">    </span><span class="no"># number of seconds allowed for a dnode to be offline, for cluster only</span>
<span class="w">    </span><span class="no"># offlineThreshold          8640000</span>

<span class="w">    </span><span class="no"># RPC re-try timer, millisecond</span>
<span class="w">    </span><span class="no"># rpcTimer                  300</span>

<span class="w">    </span><span class="no"># RPC maximum time for ack, seconds.</span>
<span class="w">    </span><span class="no"># rpcMaxTime                600</span>

<span class="w">    </span><span class="no"># time interval of dnode status reporting to mnode, seconds, for cluster only</span>
<span class="w">    </span><span class="no"># statusInterval            1</span>

<span class="w">    </span><span class="no"># time interval of heart beat from shell to dnode, seconds</span>
<span class="w">    </span><span class="no"># shellActivityTimer        3</span>

<span class="w">    </span><span class="no"># minimum sliding window time, milli-second</span>
<span class="w">    </span><span class="no"># minSlidingTime            10</span>

<span class="w">    </span><span class="no"># minimum time window, milli-second</span>
<span class="w">    </span><span class="no"># minIntervalTime           10</span>

<span class="w">    </span><span class="no"># maximum delay before launching a stream computation, milli-second</span>
<span class="w">    </span><span class="no"># maxStreamCompDelay        20000</span>

<span class="w">    </span><span class="no"># maximum delay before launching a stream computation for the first time, milli-second</span>
<span class="w">    </span><span class="no"># maxFirstStreamCompDelay   10000</span>

<span class="w">    </span><span class="no"># retry delay when a stream computation fails, milli-second</span>
<span class="w">    </span><span class="no"># retryStreamCompDelay      10</span>

<span class="w">    </span><span class="no"># the delayed time for launching a stream computation, from 0.1(default, 10% of whole computing time window) to 0.9</span>
<span class="w">    </span><span class="no"># streamCompDelayRatio      0.1</span>

<span class="w">    </span><span class="no"># max number of vgroups per db, 0 means configured automatically</span>
<span class="w">    </span><span class="no"># maxVgroupsPerDb           0</span>

<span class="w">    </span><span class="no"># max number of tables per vnode</span>
<span class="w">    </span><span class="no"># maxTablesPerVnode         1000000</span>

<span class="w">    </span><span class="no"># cache block size (Mbyte)</span>
<span class="w">    </span><span class="no"># cache                     16</span>

<span class="w">    </span><span class="no"># number of cache blocks per vnode</span>
<span class="w">    </span><span class="no"># blocks                    6</span>

<span class="w">    </span><span class="no"># number of days per DB file</span>
<span class="w">    </span><span class="no">days                  3650</span>

<span class="w">    </span><span class="no"># number of days to keep DB file</span>
<span class="w">    </span><span class="no"># keep                  3650</span>

<span class="w">    </span><span class="no"># minimum rows of records in file block</span>
<span class="w">    </span><span class="no"># minRows               100</span>

<span class="w">    </span><span class="no"># maximum rows of records in file block</span>
<span class="w">    </span><span class="no"># maxRows               4096</span>

<span class="w">    </span><span class="no"># the number of acknowledgments required for successful data writing</span>
<span class="w">    </span><span class="no"># quorum                1</span>

<span class="w">    </span><span class="no"># enable/disable compression</span>
<span class="w">    </span><span class="no"># comp                  2</span>

<span class="w">    </span><span class="no"># write ahead log (WAL) level, 0: no wal; 1: write wal, but no fysnc; 2: write wal, and call fsync</span>
<span class="w">    </span><span class="no"># walLevel              1</span>

<span class="w">    </span><span class="no"># if walLevel is set to 2, the cycle of fsync being executed, if set to 0, fsync is called right away</span>
<span class="w">    </span><span class="no"># fsync                 3000</span>

<span class="w">    </span><span class="no"># number of replications, for cluster only</span>
<span class="w">    </span><span class="no"># replica               1</span>

<span class="w">    </span><span class="no"># the compressed rpc message, option:</span>
<span class="w">    </span><span class="no">#  -1 (no compression)</span>
<span class="w">    </span><span class="no">#   0 (all message compressed),</span>
<span class="w">    </span><span class="no"># &gt; 0 (rpc message body which larger than this value will be compressed)</span>
<span class="w">    </span><span class="no"># compressMsgSize       -1</span>

<span class="w">    </span><span class="no"># max length of an SQL</span>
<span class="w">    </span><span class="no"># maxSQLLength          65480</span>

<span class="w">    </span><span class="no"># the maximum number of records allowed for super table time sorting</span>
<span class="w">    </span><span class="no"># maxNumOfOrderedRes    100000</span>

<span class="w">    </span><span class="no"># system time zone</span>
<span class="w">    </span><span class="no"># timezone              Asia/Shanghai (CST, +0800)</span>

<span class="w">    </span><span class="no"># system locale</span>
<span class="w">    </span><span class="no"># locale                en_US.UTF-8</span>

<span class="w">    </span><span class="no"># default system charset</span>
<span class="w">    </span><span class="no"># charset               UTF-8</span>

<span class="w">    </span><span class="no"># max number of connections allowed in dnode</span>
<span class="w">    </span><span class="no"># maxShellConns         5000</span>

<span class="w">    </span><span class="no"># max number of connections allowed in client</span>
<span class="w">    </span><span class="no"># maxConnections        5000</span>

<span class="w">    </span><span class="no"># stop writing logs when the disk size of the log folder is less than this value</span>
<span class="w">    </span><span class="no"># minimalLogDirGB       0.1</span>

<span class="w">    </span><span class="no"># stop writing temporary files when the disk size of the tmp folder is less than this value</span>
<span class="w">    </span><span class="no"># minimalTmpDirGB       0.1</span>

<span class="w">    </span><span class="no"># if disk free space is less than this value, taosd service exit directly within startup process</span>
<span class="w">    </span><span class="no"># minimalDataDirGB      0.1</span>

<span class="w">    </span><span class="no"># One mnode is equal to the number of vnode consumed</span>
<span class="w">    </span><span class="no"># mnodeEqualVnodeNum    4</span>

<span class="w">    </span><span class="no"># enbale/disable http service</span>
<span class="w">    </span><span class="no"># http                  1</span>

<span class="w">    </span><span class="no"># enable/disable system monitor</span>
<span class="w">    </span><span class="no"># monitor               1</span>

<span class="w">    </span><span class="no"># enable/disable recording the SQL statements via restful interface</span>
<span class="w">    </span><span class="no"># httpEnableRecordSql   0</span>

<span class="w">    </span><span class="no"># number of threads used to process http requests</span>
<span class="w">    </span><span class="no"># httpMaxThreads        2</span>

<span class="w">    </span><span class="no"># maximum number of rows returned by the restful interface</span>
<span class="w">    </span><span class="no"># restfulRowLimit       10240</span>

<span class="w">    </span><span class="no"># The following parameter is used to limit the maximum number of lines in log files.</span>
<span class="w">    </span><span class="no"># max number of lines per log filters</span>
<span class="w">    </span><span class="no"># numOfLogLines         10000000</span>

<span class="w">    </span><span class="no"># enable/disable async log</span>
<span class="w">    </span><span class="no"># asyncLog              1</span>

<span class="w">    </span><span class="no"># time of keeping log files, days</span>
<span class="w">    </span><span class="no"># logKeepDays           0</span>


<span class="w">    </span><span class="no"># The following parameters are used for debug purpose only.</span>
<span class="w">    </span><span class="no"># debugFlag 8 bits mask: FILE-SCREEN-UNUSED-HeartBeat-DUMP-TRACE_WARN-ERROR</span>
<span class="w">    </span><span class="no"># 131: output warning and error</span>
<span class="w">    </span><span class="no"># 135: output debug, warning and error</span>
<span class="w">    </span><span class="no"># 143: output trace, debug, warning and error to log</span>
<span class="w">    </span><span class="no"># 199: output debug, warning and error to both screen and file</span>
<span class="w">    </span><span class="no"># 207: output trace, debug, warning and error to both screen and file</span>

<span class="w">    </span><span class="no"># debug flag for all log type, take effect when non-zero value</span>
<span class="w">    </span><span class="no">debugFlag             135</span>

<span class="w">    </span><span class="no"># debug flag for meta management messages</span>
<span class="w">    </span><span class="no"># mDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for dnode messages</span>
<span class="w">    </span><span class="no"># dDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for sync module</span>
<span class="w">    </span><span class="no"># sDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for WAL</span>
<span class="w">    </span><span class="no"># wDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for SDB</span>
<span class="w">    </span><span class="no"># sdbDebugFlag          135</span>

<span class="w">    </span><span class="no"># debug flag for RPC</span>
<span class="w">    </span><span class="no"># rpcDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for TAOS TIMER</span>
<span class="w">    </span><span class="no"># tmrDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for TDengine client</span>
<span class="w">    </span><span class="no"># cDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for JNI</span>
<span class="w">    </span><span class="no"># jniDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for storage</span>
<span class="w">    </span><span class="no"># uDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for http server</span>
<span class="w">    </span><span class="no"># httpDebugFlag         131</span>

<span class="w">    </span><span class="no"># debug flag for monitor</span>
<span class="w">    </span><span class="no"># monDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for query</span>
<span class="w">    </span><span class="no"># qDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for vnode</span>
<span class="w">    </span><span class="no"># vDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for TSDB</span>
<span class="w">    </span><span class="no"># tsdbDebugFlag         131</span>

<span class="w">    </span><span class="no"># debug flag for continue query</span>
<span class="w">    </span><span class="no"># cqDebugFlag           131</span>

<span class="w">    </span><span class="no"># enable/disable recording the SQL in taos client</span>
<span class="w">    </span><span class="no"># enableRecordSql    0</span>

<span class="w">    </span><span class="no"># generate core file when service crash</span>
<span class="w">    </span><span class="no"># enableCoreFile        1</span>

<span class="w">    </span><span class="no"># maximum display width of binary and nchar fields in the shell. The parts exceeding this limit will be hidden</span>
<span class="w">    </span><span class="no"># maxBinaryDisplayWidth 30</span>

<span class="w">    </span><span class="no"># enable/disable stream (continuous query)</span>
<span class="w">    </span><span class="no"># stream                1</span>

<span class="w">    </span><span class="no"># in retrieve blocking model, only in 50% query threads will be used in query processing in dnode</span>
<span class="w">    </span><span class="no"># retrieveBlockingModel    0</span>

<span class="w">    </span><span class="no"># the maximum allowed query buffer size in MB during query processing for each data node</span>
<span class="w">    </span><span class="no"># -1 no limit (default)</span>
<span class="w">    </span><span class="no"># 0  no query allowed, queries are disabled</span>
<span class="w">    </span><span class="no"># queryBufferSize         -1</span>

<span class="w">  </span><span class="nt">ms2.cnf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">########################################################</span>
<span class="w">    </span><span class="no">#                                                      #</span>
<span class="w">    </span><span class="no">#                  TDengine Configuration              #</span>
<span class="w">    </span><span class="no">#   Any questions, please email support@taosdata.com   #</span>
<span class="w">    </span><span class="no">#                                                      #</span>
<span class="w">    </span><span class="no">########################################################</span>

<span class="w">    </span><span class="no"># first fully qualified domain name (FQDN) for TDengine system</span>
<span class="w">    </span><span class="no">firstEp                   tdmnode-0.default.svc.cluster.local:6030</span>
<span class="w">    </span><span class="no">secondEp                  tdmnode-1.default.svc.cluster.local:6030</span>
<span class="w">    </span><span class="no"># local fully qualified domain name (FQDN)</span>
<span class="w">    </span><span class="no">fqdn                      tdmnode-1.default.svc.cluster.local</span>

<span class="w">    </span><span class="no"># first port number for the connection (12 continuous UDP/TCP port number are used)</span>
<span class="w">    </span><span class="no">serverPort                6030</span>

<span class="w">    </span><span class="no"># log file&#39;s director</span>
<span class="w">    </span><span class="no">logDir                    /etc/taos/log</span>

<span class="w">    </span><span class="no"># data file&#39;s directory</span>
<span class="w">    </span><span class="no">dataDir                   /etc/taos/data</span>

<span class="w">    </span><span class="no"># temporary file&#39;s directory</span>
<span class="w">    </span><span class="no">tempDir                   /tmp/</span>

<span class="w">    </span><span class="no"># the arbitrator&#39;s fully qualified domain name (FQDN) for TDengine system, for cluster only</span>
<span class="w">    </span><span class="no"># arbitrator                arbitrator_hostname:6042</span>

<span class="w">    </span><span class="no"># number of threads per CPU core</span>
<span class="w">    </span><span class="no"># numOfThreadsPerCore       1.0</span>

<span class="w">    </span><span class="no"># number of threads to commit cache data</span>
<span class="w">    </span><span class="no">numOfCommitThreads        4</span>

<span class="w">    </span><span class="no"># the proportion of total CPU cores available for query processing</span>
<span class="w">    </span><span class="no"># 2.0: the query threads will be set to double of the CPU cores.</span>
<span class="w">    </span><span class="no"># 1.0: all CPU cores are available for query processing [default].</span>
<span class="w">    </span><span class="no"># 0.5: only half of the CPU cores are available for query.</span>
<span class="w">    </span><span class="no"># 0.0: only one core available.</span>
<span class="w">    </span><span class="no"># ratioOfQueryCores        1.0</span>

<span class="w">    </span><span class="no"># the last_row/first/last aggregator will not change the original column name in the result fields</span>
<span class="w">    </span><span class="no"># keepColumnName            0</span>

<span class="w">    </span><span class="no"># number of management nodes in the system</span>
<span class="w">    </span><span class="no"># numOfMnodes               3</span>

<span class="w">    </span><span class="no"># enable/disable backuping vnode directory when removing vnode</span>
<span class="w">    </span><span class="no"># vnodeBak                  1</span>

<span class="w">    </span><span class="no"># enable/disable installation / usage report</span>
<span class="w">    </span><span class="no"># telemetryReporting        1</span>

<span class="w">    </span><span class="no"># enable/disable load balancing</span>
<span class="w">    </span><span class="no"># balance                   1</span>

<span class="w">    </span><span class="no"># role for dnode. 0 - any, 1 - mnode, 2 - dnode</span>
<span class="w">    </span><span class="no"># role                      0</span>

<span class="w">    </span><span class="no"># max timer control blocks</span>
<span class="w">    </span><span class="no"># maxTmrCtrl                512</span>

<span class="w">    </span><span class="no"># time interval of system monitor, seconds</span>
<span class="w">    </span><span class="no"># monitorInterval           30</span>

<span class="w">    </span><span class="no"># number of seconds allowed for a dnode to be offline, for cluster only</span>
<span class="w">    </span><span class="no"># offlineThreshold          8640000</span>

<span class="w">    </span><span class="no"># RPC re-try timer, millisecond</span>
<span class="w">    </span><span class="no"># rpcTimer                  300</span>

<span class="w">    </span><span class="no"># RPC maximum time for ack, seconds.</span>
<span class="w">    </span><span class="no"># rpcMaxTime                600</span>

<span class="w">    </span><span class="no"># time interval of dnode status reporting to mnode, seconds, for cluster only</span>
<span class="w">    </span><span class="no"># statusInterval            1</span>

<span class="w">    </span><span class="no"># time interval of heart beat from shell to dnode, seconds</span>
<span class="w">    </span><span class="no"># shellActivityTimer        3</span>

<span class="w">    </span><span class="no"># minimum sliding window time, milli-second</span>
<span class="w">    </span><span class="no"># minSlidingTime            10</span>

<span class="w">    </span><span class="no"># minimum time window, milli-second</span>
<span class="w">    </span><span class="no"># minIntervalTime           10</span>

<span class="w">    </span><span class="no"># maximum delay before launching a stream computation, milli-second</span>
<span class="w">    </span><span class="no"># maxStreamCompDelay        20000</span>

<span class="w">    </span><span class="no"># maximum delay before launching a stream computation for the first time, milli-second</span>
<span class="w">    </span><span class="no"># maxFirstStreamCompDelay   10000</span>

<span class="w">    </span><span class="no"># retry delay when a stream computation fails, milli-second</span>
<span class="w">    </span><span class="no"># retryStreamCompDelay      10</span>

<span class="w">    </span><span class="no"># the delayed time for launching a stream computation, from 0.1(default, 10% of whole computing time window) to 0.9</span>
<span class="w">    </span><span class="no"># streamCompDelayRatio      0.1</span>

<span class="w">    </span><span class="no"># max number of vgroups per db, 0 means configured automatically</span>
<span class="w">    </span><span class="no"># maxVgroupsPerDb           0</span>

<span class="w">    </span><span class="no"># max number of tables per vnode</span>
<span class="w">    </span><span class="no"># maxTablesPerVnode         1000000</span>

<span class="w">    </span><span class="no"># cache block size (Mbyte)</span>
<span class="w">    </span><span class="no"># cache                     16</span>

<span class="w">    </span><span class="no"># number of cache blocks per vnode</span>
<span class="w">    </span><span class="no"># blocks                    6</span>

<span class="w">    </span><span class="no"># number of days per DB file</span>
<span class="w">    </span><span class="no">days                  3650</span>

<span class="w">    </span><span class="no"># number of days to keep DB file</span>
<span class="w">    </span><span class="no"># keep                  3650</span>

<span class="w">    </span><span class="no"># minimum rows of records in file block</span>
<span class="w">    </span><span class="no"># minRows               100</span>

<span class="w">    </span><span class="no"># maximum rows of records in file block</span>
<span class="w">    </span><span class="no"># maxRows               4096</span>

<span class="w">    </span><span class="no"># the number of acknowledgments required for successful data writing</span>
<span class="w">    </span><span class="no"># quorum                1</span>

<span class="w">    </span><span class="no"># enable/disable compression</span>
<span class="w">    </span><span class="no"># comp                  2</span>

<span class="w">    </span><span class="no"># write ahead log (WAL) level, 0: no wal; 1: write wal, but no fysnc; 2: write wal, and call fsync</span>
<span class="w">    </span><span class="no"># walLevel              1</span>

<span class="w">    </span><span class="no"># if walLevel is set to 2, the cycle of fsync being executed, if set to 0, fsync is called right away</span>
<span class="w">    </span><span class="no"># fsync                 3000</span>

<span class="w">    </span><span class="no"># number of replications, for cluster only</span>
<span class="w">    </span><span class="no"># replica               1</span>

<span class="w">    </span><span class="no"># the compressed rpc message, option:</span>
<span class="w">    </span><span class="no">#  -1 (no compression)</span>
<span class="w">    </span><span class="no">#   0 (all message compressed),</span>
<span class="w">    </span><span class="no"># &gt; 0 (rpc message body which larger than this value will be compressed)</span>
<span class="w">    </span><span class="no"># compressMsgSize       -1</span>

<span class="w">    </span><span class="no"># max length of an SQL</span>
<span class="w">    </span><span class="no"># maxSQLLength          65480</span>

<span class="w">    </span><span class="no"># the maximum number of records allowed for super table time sorting</span>
<span class="w">    </span><span class="no"># maxNumOfOrderedRes    100000</span>

<span class="w">    </span><span class="no"># system time zone</span>
<span class="w">    </span><span class="no"># timezone              Asia/Shanghai (CST, +0800)</span>

<span class="w">    </span><span class="no"># system locale</span>
<span class="w">    </span><span class="no"># locale                en_US.UTF-8</span>

<span class="w">    </span><span class="no"># default system charset</span>
<span class="w">    </span><span class="no"># charset               UTF-8</span>

<span class="w">    </span><span class="no"># max number of connections allowed in dnode</span>
<span class="w">    </span><span class="no"># maxShellConns         5000</span>

<span class="w">    </span><span class="no"># max number of connections allowed in client</span>
<span class="w">    </span><span class="no"># maxConnections        5000</span>

<span class="w">    </span><span class="no"># stop writing logs when the disk size of the log folder is less than this value</span>
<span class="w">    </span><span class="no"># minimalLogDirGB       0.1</span>

<span class="w">    </span><span class="no"># stop writing temporary files when the disk size of the tmp folder is less than this value</span>
<span class="w">    </span><span class="no"># minimalTmpDirGB       0.1</span>

<span class="w">    </span><span class="no"># if disk free space is less than this value, taosd service exit directly within startup process</span>
<span class="w">    </span><span class="no"># minimalDataDirGB      0.1</span>

<span class="w">    </span><span class="no"># One mnode is equal to the number of vnode consumed</span>
<span class="w">    </span><span class="no"># mnodeEqualVnodeNum    4</span>

<span class="w">    </span><span class="no"># enbale/disable http service</span>
<span class="w">    </span><span class="no"># http                  1</span>

<span class="w">    </span><span class="no"># enable/disable system monitor</span>
<span class="w">    </span><span class="no"># monitor               1</span>

<span class="w">    </span><span class="no"># enable/disable recording the SQL statements via restful interface</span>
<span class="w">    </span><span class="no"># httpEnableRecordSql   0</span>

<span class="w">    </span><span class="no"># number of threads used to process http requests</span>
<span class="w">    </span><span class="no"># httpMaxThreads        2</span>

<span class="w">    </span><span class="no"># maximum number of rows returned by the restful interface</span>
<span class="w">    </span><span class="no"># restfulRowLimit       10240</span>

<span class="w">    </span><span class="no"># The following parameter is used to limit the maximum number of lines in log files.</span>
<span class="w">    </span><span class="no"># max number of lines per log filters</span>
<span class="w">    </span><span class="no"># numOfLogLines         10000000</span>

<span class="w">    </span><span class="no"># enable/disable async log</span>
<span class="w">    </span><span class="no"># asyncLog              1</span>

<span class="w">    </span><span class="no"># time of keeping log files, days</span>
<span class="w">    </span><span class="no"># logKeepDays           0</span>


<span class="w">    </span><span class="no"># The following parameters are used for debug purpose only.</span>
<span class="w">    </span><span class="no"># debugFlag 8 bits mask: FILE-SCREEN-UNUSED-HeartBeat-DUMP-TRACE_WARN-ERROR</span>
<span class="w">    </span><span class="no"># 131: output warning and error</span>
<span class="w">    </span><span class="no"># 135: output debug, warning and error</span>
<span class="w">    </span><span class="no"># 143: output trace, debug, warning and error to log</span>
<span class="w">    </span><span class="no"># 199: output debug, warning and error to both screen and file</span>
<span class="w">    </span><span class="no"># 207: output trace, debug, warning and error to both screen and file</span>

<span class="w">    </span><span class="no"># debug flag for all log type, take effect when non-zero value</span>
<span class="w">    </span><span class="no">debugFlag             135</span>

<span class="w">    </span><span class="no"># debug flag for meta management messages</span>
<span class="w">    </span><span class="no"># mDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for dnode messages</span>
<span class="w">    </span><span class="no"># dDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for sync module</span>
<span class="w">    </span><span class="no"># sDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for WAL</span>
<span class="w">    </span><span class="no"># wDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for SDB</span>
<span class="w">    </span><span class="no"># sdbDebugFlag          135</span>

<span class="w">    </span><span class="no"># debug flag for RPC</span>
<span class="w">    </span><span class="no"># rpcDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for TAOS TIMER</span>
<span class="w">    </span><span class="no"># tmrDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for TDengine client</span>
<span class="w">    </span><span class="no"># cDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for JNI</span>
<span class="w">    </span><span class="no"># jniDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for storage</span>
<span class="w">    </span><span class="no"># uDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for http server</span>
<span class="w">    </span><span class="no"># httpDebugFlag         131</span>

<span class="w">    </span><span class="no"># debug flag for monitor</span>
<span class="w">    </span><span class="no"># monDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for query</span>
<span class="w">    </span><span class="no"># qDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for vnode</span>
<span class="w">    </span><span class="no"># vDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for TSDB</span>
<span class="w">    </span><span class="no"># tsdbDebugFlag         131</span>

<span class="w">    </span><span class="no"># debug flag for continue query</span>
<span class="w">    </span><span class="no"># cqDebugFlag           131</span>

<span class="w">    </span><span class="no"># enable/disable recording the SQL in taos client</span>
<span class="w">    </span><span class="no"># enableRecordSql    0</span>

<span class="w">    </span><span class="no"># generate core file when service crash</span>
<span class="w">    </span><span class="no"># enableCoreFile        1</span>

<span class="w">    </span><span class="no"># maximum display width of binary and nchar fields in the shell. The parts exceeding this limit will be hidden</span>
<span class="w">    </span><span class="no"># maxBinaryDisplayWidth 30</span>

<span class="w">    </span><span class="no"># enable/disable stream (continuous query)</span>
<span class="w">    </span><span class="no"># stream                1</span>

<span class="w">    </span><span class="no"># in retrieve blocking model, only in 50% query threads will be used in query processing in dnode</span>
<span class="w">    </span><span class="no"># retrieveBlockingModel    0</span>

<span class="w">    </span><span class="no"># the maximum allowed query buffer size in MB during query processing for each data node</span>
<span class="w">    </span><span class="no"># -1 no limit (default)</span>
<span class="w">    </span><span class="no"># 0  no query allowed, queries are disabled</span>
<span class="w">    </span><span class="no"># queryBufferSize         -1</span>
<span class="w">  </span><span class="nt">ms3.cnf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">########################################################</span>
<span class="w">    </span><span class="no">#                                                      #</span>
<span class="w">    </span><span class="no">#                  TDengine Configuration              #</span>
<span class="w">    </span><span class="no">#   Any questions, please email support@taosdata.com   #</span>
<span class="w">    </span><span class="no">#                                                      #</span>
<span class="w">    </span><span class="no">########################################################</span>


<span class="w">    </span><span class="no"># first fully qualified domain name (FQDN) for TDengine system</span>
<span class="w">    </span><span class="no">firstEp                   tdmnode-0.default.svc.cluster.local:6030</span>
<span class="w">    </span><span class="no">secondEp                  tdmnode-1.default.svc.cluster.local:6030</span>
<span class="w">    </span><span class="no"># local fully qualified domain name (FQDN)</span>
<span class="w">    </span><span class="no">fqdn                      tdmnode-2.default.svc.cluster.local</span>

<span class="w">    </span><span class="no"># first port number for the connection (12 continuous UDP/TCP port number are used)</span>
<span class="w">    </span><span class="no">serverPort                6030</span>


<span class="w">    </span><span class="no"># log file&#39;s director</span>
<span class="w">    </span><span class="no">logDir                    /etc/taos/log</span>

<span class="w">    </span><span class="no"># data file&#39;s directory</span>
<span class="w">    </span><span class="no">dataDir                   /etc/taos/data</span>

<span class="w">    </span><span class="no"># temporary file&#39;s directory</span>
<span class="w">    </span><span class="no">tempDir                   /tmp/</span>

<span class="w">    </span><span class="no"># the arbitrator&#39;s fully qualified domain name (FQDN) for TDengine system, for cluster only</span>
<span class="w">    </span><span class="no"># arbitrator                arbitrator_hostname:6042</span>

<span class="w">    </span><span class="no"># number of threads per CPU core</span>
<span class="w">    </span><span class="no"># numOfThreadsPerCore       1.0</span>

<span class="w">    </span><span class="no"># number of threads to commit cache data</span>
<span class="w">    </span><span class="no">numOfCommitThreads        4</span>

<span class="w">    </span><span class="no"># the proportion of total CPU cores available for query processing</span>
<span class="w">    </span><span class="no"># 2.0: the query threads will be set to double of the CPU cores.</span>
<span class="w">    </span><span class="no"># 1.0: all CPU cores are available for query processing [default].</span>
<span class="w">    </span><span class="no"># 0.5: only half of the CPU cores are available for query.</span>
<span class="w">    </span><span class="no"># 0.0: only one core available.</span>
<span class="w">    </span><span class="no"># ratioOfQueryCores        1.0</span>

<span class="w">    </span><span class="no"># the last_row/first/last aggregator will not change the original column name in the result fields</span>
<span class="w">    </span><span class="no"># keepColumnName            0</span>

<span class="w">    </span><span class="no"># number of management nodes in the system</span>
<span class="w">    </span><span class="no"># numOfMnodes               3</span>

<span class="w">    </span><span class="no"># enable/disable backuping vnode directory when removing vnode</span>
<span class="w">    </span><span class="no"># vnodeBak                  1</span>

<span class="w">    </span><span class="no"># enable/disable installation / usage report</span>
<span class="w">    </span><span class="no"># telemetryReporting        1</span>

<span class="w">    </span><span class="no"># enable/disable load balancing</span>
<span class="w">    </span><span class="no"># balance                   1</span>

<span class="w">    </span><span class="no"># role for dnode. 0 - any, 1 - mnode, 2 - dnode</span>
<span class="w">    </span><span class="no"># role                      0</span>

<span class="w">    </span><span class="no"># max timer control blocks</span>
<span class="w">    </span><span class="no"># maxTmrCtrl                512</span>

<span class="w">    </span><span class="no"># time interval of system monitor, seconds</span>
<span class="w">    </span><span class="no"># monitorInterval           30</span>

<span class="w">    </span><span class="no"># number of seconds allowed for a dnode to be offline, for cluster only</span>
<span class="w">    </span><span class="no"># offlineThreshold          8640000</span>

<span class="w">    </span><span class="no"># RPC re-try timer, millisecond</span>
<span class="w">    </span><span class="no"># rpcTimer                  300</span>

<span class="w">    </span><span class="no"># RPC maximum time for ack, seconds.</span>
<span class="w">    </span><span class="no"># rpcMaxTime                600</span>

<span class="w">    </span><span class="no"># time interval of dnode status reporting to mnode, seconds, for cluster only</span>
<span class="w">    </span><span class="no"># statusInterval            1</span>

<span class="w">    </span><span class="no"># time interval of heart beat from shell to dnode, seconds</span>
<span class="w">    </span><span class="no"># shellActivityTimer        3</span>

<span class="w">    </span><span class="no"># minimum sliding window time, milli-second</span>
<span class="w">    </span><span class="no"># minSlidingTime            10</span>

<span class="w">    </span><span class="no"># minimum time window, milli-second</span>
<span class="w">    </span><span class="no"># minIntervalTime           10</span>

<span class="w">    </span><span class="no"># maximum delay before launching a stream computation, milli-second</span>
<span class="w">    </span><span class="no"># maxStreamCompDelay        20000</span>

<span class="w">    </span><span class="no"># maximum delay before launching a stream computation for the first time, milli-second</span>
<span class="w">    </span><span class="no"># maxFirstStreamCompDelay   10000</span>

<span class="w">    </span><span class="no"># retry delay when a stream computation fails, milli-second</span>
<span class="w">    </span><span class="no"># retryStreamCompDelay      10</span>

<span class="w">    </span><span class="no"># the delayed time for launching a stream computation, from 0.1(default, 10% of whole computing time window) to 0.9</span>
<span class="w">    </span><span class="no"># streamCompDelayRatio      0.1</span>

<span class="w">    </span><span class="no"># max number of vgroups per db, 0 means configured automatically</span>
<span class="w">    </span><span class="no"># maxVgroupsPerDb           0</span>

<span class="w">    </span><span class="no"># max number of tables per vnode</span>
<span class="w">    </span><span class="no"># maxTablesPerVnode         1000000</span>

<span class="w">    </span><span class="no"># cache block size (Mbyte)</span>
<span class="w">    </span><span class="no"># cache                     16</span>

<span class="w">    </span><span class="no"># number of cache blocks per vnode</span>
<span class="w">    </span><span class="no"># blocks                    6</span>

<span class="w">    </span><span class="no"># number of days per DB file</span>
<span class="w">    </span><span class="no">days                  3650</span>

<span class="w">    </span><span class="no"># number of days to keep DB file</span>
<span class="w">    </span><span class="no"># keep                  3650</span>

<span class="w">    </span><span class="no"># minimum rows of records in file block</span>
<span class="w">    </span><span class="no"># minRows               100</span>

<span class="w">    </span><span class="no"># maximum rows of records in file block</span>
<span class="w">    </span><span class="no"># maxRows               4096</span>

<span class="w">    </span><span class="no"># the number of acknowledgments required for successful data writing</span>
<span class="w">    </span><span class="no"># quorum                1</span>

<span class="w">    </span><span class="no"># enable/disable compression</span>
<span class="w">    </span><span class="no"># comp                  2</span>

<span class="w">    </span><span class="no"># write ahead log (WAL) level, 0: no wal; 1: write wal, but no fysnc; 2: write wal, and call fsync</span>
<span class="w">    </span><span class="no"># walLevel              1</span>

<span class="w">    </span><span class="no"># if walLevel is set to 2, the cycle of fsync being executed, if set to 0, fsync is called right away</span>
<span class="w">    </span><span class="no"># fsync                 3000</span>

<span class="w">    </span><span class="no"># number of replications, for cluster only</span>
<span class="w">    </span><span class="no"># replica               1</span>

<span class="w">    </span><span class="no"># the compressed rpc message, option:</span>
<span class="w">    </span><span class="no">#  -1 (no compression)</span>
<span class="w">    </span><span class="no">#   0 (all message compressed),</span>
<span class="w">    </span><span class="no"># &gt; 0 (rpc message body which larger than this value will be compressed)</span>
<span class="w">    </span><span class="no"># compressMsgSize       -1</span>

<span class="w">    </span><span class="no"># max length of an SQL</span>
<span class="w">    </span><span class="no"># maxSQLLength          65480</span>

<span class="w">    </span><span class="no"># the maximum number of records allowed for super table time sorting</span>
<span class="w">    </span><span class="no"># maxNumOfOrderedRes    100000</span>

<span class="w">    </span><span class="no"># system time zone</span>
<span class="w">    </span><span class="no"># timezone              Asia/Shanghai (CST, +0800)</span>

<span class="w">    </span><span class="no"># system locale</span>
<span class="w">    </span><span class="no"># locale                en_US.UTF-8</span>

<span class="w">    </span><span class="no"># default system charset</span>
<span class="w">    </span><span class="no"># charset               UTF-8</span>

<span class="w">    </span><span class="no"># max number of connections allowed in dnode</span>
<span class="w">    </span><span class="no"># maxShellConns         5000</span>

<span class="w">    </span><span class="no"># max number of connections allowed in client</span>
<span class="w">    </span><span class="no"># maxConnections        5000</span>

<span class="w">    </span><span class="no"># stop writing logs when the disk size of the log folder is less than this value</span>
<span class="w">    </span><span class="no"># minimalLogDirGB       0.1</span>

<span class="w">    </span><span class="no"># stop writing temporary files when the disk size of the tmp folder is less than this value</span>
<span class="w">    </span><span class="no"># minimalTmpDirGB       0.1</span>

<span class="w">    </span><span class="no"># if disk free space is less than this value, taosd service exit directly within startup process</span>
<span class="w">    </span><span class="no"># minimalDataDirGB      0.1</span>

<span class="w">    </span><span class="no"># One mnode is equal to the number of vnode consumed</span>
<span class="w">    </span><span class="no"># mnodeEqualVnodeNum    4</span>

<span class="w">    </span><span class="no"># enbale/disable http service</span>
<span class="w">    </span><span class="no"># http                  1</span>

<span class="w">    </span><span class="no"># enable/disable system monitor</span>
<span class="w">    </span><span class="no"># monitor               1</span>

<span class="w">    </span><span class="no"># enable/disable recording the SQL statements via restful interface</span>
<span class="w">    </span><span class="no"># httpEnableRecordSql   0</span>

<span class="w">    </span><span class="no"># number of threads used to process http requests</span>
<span class="w">    </span><span class="no"># httpMaxThreads        2</span>

<span class="w">    </span><span class="no"># maximum number of rows returned by the restful interface</span>
<span class="w">    </span><span class="no"># restfulRowLimit       10240</span>

<span class="w">    </span><span class="no"># The following parameter is used to limit the maximum number of lines in log files.</span>
<span class="w">    </span><span class="no"># max number of lines per log filters</span>
<span class="w">    </span><span class="no"># numOfLogLines         10000000</span>

<span class="w">    </span><span class="no"># enable/disable async log</span>
<span class="w">    </span><span class="no"># asyncLog              1</span>

<span class="w">    </span><span class="no"># time of keeping log files, days</span>
<span class="w">    </span><span class="no"># logKeepDays           0</span>


<span class="w">    </span><span class="no"># The following parameters are used for debug purpose only.</span>
<span class="w">    </span><span class="no"># debugFlag 8 bits mask: FILE-SCREEN-UNUSED-HeartBeat-DUMP-TRACE_WARN-ERROR</span>
<span class="w">    </span><span class="no"># 131: output warning and error</span>
<span class="w">    </span><span class="no"># 135: output debug, warning and error</span>
<span class="w">    </span><span class="no"># 143: output trace, debug, warning and error to log</span>
<span class="w">    </span><span class="no"># 199: output debug, warning and error to both screen and file</span>
<span class="w">    </span><span class="no"># 207: output trace, debug, warning and error to both screen and file</span>

<span class="w">    </span><span class="no"># debug flag for all log type, take effect when non-zero value</span>
<span class="w">    </span><span class="no">debugFlag             135</span>

<span class="w">    </span><span class="no"># debug flag for meta management messages</span>
<span class="w">    </span><span class="no"># mDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for dnode messages</span>
<span class="w">    </span><span class="no"># dDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for sync module</span>
<span class="w">    </span><span class="no"># sDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for WAL</span>
<span class="w">    </span><span class="no"># wDebugFlag            135</span>

<span class="w">    </span><span class="no"># debug flag for SDB</span>
<span class="w">    </span><span class="no"># sdbDebugFlag          135</span>

<span class="w">    </span><span class="no"># debug flag for RPC</span>
<span class="w">    </span><span class="no"># rpcDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for TAOS TIMER</span>
<span class="w">    </span><span class="no"># tmrDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for TDengine client</span>
<span class="w">    </span><span class="no"># cDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for JNI</span>
<span class="w">    </span><span class="no"># jniDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for storage</span>
<span class="w">    </span><span class="no"># uDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for http server</span>
<span class="w">    </span><span class="no"># httpDebugFlag         131</span>

<span class="w">    </span><span class="no"># debug flag for monitor</span>
<span class="w">    </span><span class="no"># monDebugFlag          131</span>

<span class="w">    </span><span class="no"># debug flag for query</span>
<span class="w">    </span><span class="no"># qDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for vnode</span>
<span class="w">    </span><span class="no"># vDebugFlag            131</span>

<span class="w">    </span><span class="no"># debug flag for TSDB</span>
<span class="w">    </span><span class="no"># tsdbDebugFlag         131</span>

<span class="w">    </span><span class="no"># debug flag for continue query</span>
<span class="w">    </span><span class="no"># cqDebugFlag           131</span>

<span class="w">    </span><span class="no"># enable/disable recording the SQL in taos client</span>
<span class="w">    </span><span class="no"># enableRecordSql    0</span>

<span class="w">    </span><span class="no"># generate core file when service crash</span>
<span class="w">    </span><span class="no"># enableCoreFile        1</span>

<span class="w">    </span><span class="no"># maximum display width of binary and nchar fields in the shell. The parts exceeding this limit will be hidden</span>
<span class="w">    </span><span class="no"># maxBinaryDisplayWidth 30</span>

<span class="w">    </span><span class="no"># enable/disable stream (continuous query)</span>
<span class="w">    </span><span class="no"># stream                1</span>

<span class="w">    </span><span class="no"># in retrieve blocking model, only in 50% query threads will be used in query processing in dnode</span>
<span class="w">    </span><span class="no"># retrieveBlockingModel    0</span>

<span class="w">    </span><span class="no"># the maximum allowed query buffer size in MB during query processing for each data node</span>
<span class="w">    </span><span class="no"># -1 no limit (default)</span>
<span class="w">    </span><span class="no"># 0  no query allowed, queries are disabled</span>
<span class="w">    </span><span class="no"># queryBufferSize         -1</span>
</code></pre></div>

<h4 id="1">节点配置文件 1</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-0</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-0</span>
<span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tdmnode-0&quot;</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-0</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-0</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdengine/tdengine:latest</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6030</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6035</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6041</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6031</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6032</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6033</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6034</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6036</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6037</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6038</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6039</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6040</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">              </span><span class="no">set -ex</span>
<span class="w">              </span><span class="no">apt install inetutils-ping dnsutils -y</span>
<span class="w">              </span><span class="no"># nodes</span>
<span class="w">              </span><span class="no">export nodes=3</span>
<span class="w">              </span><span class="no">export end_index=$(($nodes - 1))</span>
<span class="w">              </span><span class="no">while :; do</span>
<span class="w">                </span><span class="no">sleep 1</span>
<span class="w">                </span><span class="no">export index=0</span>
<span class="w">                </span><span class="no">for i in `seq 0 $end_index`; do</span>
<span class="w">                 </span><span class="no">tmpip=`dig tdmnode-$i.default.svc.cluster.local | grep &quot;ANSWER SECTION&quot; -A 1 | awk &#39;NR&gt;1 {print$5}&#39;`</span>
<span class="w">                 </span><span class="no">if [ -z &quot;$tmpip&quot; ]; then</span>
<span class="w">                    </span><span class="no">echo -e &quot;\033[31m wait Node tdmnode-$i ip is null  \033[0m&quot;;</span>
<span class="w">                 </span><span class="no">else</span>
<span class="w">                    </span><span class="no">index=$(($index + 1));</span>
<span class="w">                 </span><span class="no">fi</span>
<span class="w">                </span><span class="no">done</span>

<span class="w">                </span><span class="no">if [ $index -ge $nodes ] ; then</span>
<span class="w">                      </span><span class="no">echo -e &quot;\033[32m ips is ready .Starting now Tdengine Taosd.... \033[0m&quot;</span>
<span class="w">                      </span><span class="no">for i in `seq 0 $end_index`; do</span>
<span class="w">                          </span><span class="no">tmpip=`dig tdmnode-$i.default.svc.cluster.local | grep &quot;ANSWER SECTION&quot; -A 1 | awk &#39;NR&gt;1 {print$5}&#39;`</span>
<span class="w">                          </span><span class="no">echo  &quot;${tmpip}       tdmnode-$i.default.svc.cluster.local&quot; &gt;&gt; /etc/hosts ;</span>
<span class="w">                          </span><span class="no">done</span>
<span class="w">                      </span><span class="no">break</span>
<span class="w">                 </span><span class="no">else</span>
<span class="w">                     </span><span class="no">index=0</span>
<span class="w">                     </span><span class="no">echo -e &quot;\033[31m all node not get ready pls wait....  \033[0m&quot;;</span>
<span class="w">                 </span><span class="no">fi</span>
<span class="w">              </span><span class="no">done</span>
<span class="w">              </span><span class="no">taosd</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MY_POD_IP</span>
<span class="w">              </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">                </span><span class="nt">fieldRef</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">status.podIP</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config-map</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/taos/taos.cfg</span>
<span class="w">              </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ms1.cnf</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datadir</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/taos/data</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config-map</span>
<span class="w">          </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode</span>
<span class="w">            </span><span class="nt">items</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ms1.cnf</span>
<span class="w">                </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ms1.cnf</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datadir</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testtdpvc3</span>

<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-0</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-0</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6030</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6030</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6030</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6031</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6031</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6031</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6032</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6032</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6032</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6033</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6033</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6033</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6034</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6034</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6034</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6035</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6035</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6035</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6036</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6036</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6036</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6037</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6037</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6037</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6038</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6038</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6038</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6039</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6039</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6039</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6040</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6040</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6040</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6041</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6041</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6041</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-0</span>
<span class="w">  </span><span class="nt">sessionAffinity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
</code></pre></div>

<h4 id="2">节点配置文件 2</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-1</span>
<span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tdmnode-1&quot;</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-1</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-1</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdengine/tdengine:latest</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6030</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6035</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6041</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6031</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6032</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6033</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6034</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6036</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6037</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6038</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6039</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6040</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">              </span><span class="no">set -ex</span>
<span class="w">              </span><span class="no">apt install inetutils-ping dnsutils -y</span>
<span class="w">              </span><span class="no"># nodes</span>
<span class="w">              </span><span class="no">export nodes=3</span>
<span class="w">              </span><span class="no">export end_index=$(($nodes - 1))</span>
<span class="w">              </span><span class="no">while :; do</span>
<span class="w">                </span><span class="no">sleep 1</span>
<span class="w">                </span><span class="no">export index=0</span>
<span class="w">                </span><span class="no">for i in `seq 0 $end_index`; do</span>
<span class="w">                 </span><span class="no">tmpip=`dig tdmnode-$i.default.svc.cluster.local | grep &quot;ANSWER SECTION&quot; -A 1 | awk &#39;NR&gt;1 {print$5}&#39;`</span>
<span class="w">                 </span><span class="no">if [ -z &quot;$tmpip&quot; ]; then</span>
<span class="w">                    </span><span class="no">echo -e &quot;\033[31m wait Node tdmnode-$i ip is null  \033[0m&quot;;</span>
<span class="w">                 </span><span class="no">else</span>
<span class="w">                    </span><span class="no">index=$(($index + 1))</span>
<span class="w">                 </span><span class="no">fi</span>
<span class="w">                </span><span class="no">done</span>

<span class="w">                </span><span class="no">if [ $index -ge $nodes ] ; then</span>
<span class="w">                      </span><span class="no">echo -e &quot;\033[32m ips is ready .Starting now Tdengine Taosd.... \033[0m&quot;</span>
<span class="w">                      </span><span class="no">for i in `seq 0 $end_index`; do</span>
<span class="w">                          </span><span class="no">tmpip=`dig tdmnode-$i.default.svc.cluster.local | grep &quot;ANSWER SECTION&quot; -A 1 | awk &#39;NR&gt;1 {print$5}&#39;`</span>
<span class="w">                          </span><span class="no">echo  &quot;${tmpip}       tdmnode-$i.default.svc.cluster.local&quot; &gt;&gt; /etc/hosts ;</span>
<span class="w">                          </span><span class="no">done</span>
<span class="w">                      </span><span class="no">break</span>
<span class="w">                 </span><span class="no">else</span>
<span class="w">                     </span><span class="no">index=0</span>
<span class="w">                     </span><span class="no">echo -e &quot;\033[31m all node not get ready pls wait....  \033[0m&quot;;</span>
<span class="w">                 </span><span class="no">fi</span>
<span class="w">              </span><span class="no">done</span>
<span class="w">              </span><span class="no">taosd</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MY_POD_IP</span>
<span class="w">              </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">                </span><span class="nt">fieldRef</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">status.podIP</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config-map</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/taos/taos.cfg</span>
<span class="w">              </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ms2.cnf</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datadir</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/taos/data</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config-map</span>
<span class="w">          </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode</span>
<span class="w">            </span><span class="nt">items</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ms2.cnf</span>
<span class="w">                </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ms2.cnf</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datadir</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testtdpvc2</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-1</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6030</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6030</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6030</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6031</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6031</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6031</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6032</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6032</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6032</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6033</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6033</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6033</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6034</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6034</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6034</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6035</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6035</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6035</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6036</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6036</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6036</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6037</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6037</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6037</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6038</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6038</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6038</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6039</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6039</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6039</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6040</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6040</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6040</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6041</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6041</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6041</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-1</span>
<span class="w">  </span><span class="nt">sessionAffinity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
</code></pre></div>

<h4 id="3">节点配置文件 3</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-2</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-2</span>
<span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tdmnode-2&quot;</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-2</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-2</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdengine/tdengine:latest</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6030</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6035</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6041</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6031</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6032</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6033</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6034</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6036</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6037</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6038</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6039</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6040</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-c&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">              </span><span class="no">set -ex</span>
<span class="w">              </span><span class="no">apt install inetutils-ping dnsutils -y</span>
<span class="w">              </span><span class="no"># nodes</span>
<span class="w">              </span><span class="no">export nodes=3</span>
<span class="w">              </span><span class="no">export end_index=$(($nodes - 1))</span>
<span class="w">              </span><span class="no">while :; do</span>
<span class="w">                </span><span class="no">sleep 1</span>
<span class="w">                </span><span class="no">export index=0</span>
<span class="w">                </span><span class="no">for i in `seq 0 $end_index`; do</span>
<span class="w">                 </span><span class="no">tmpip=`dig tdmnode-$i.default.svc.cluster.local | grep &quot;ANSWER SECTION&quot; -A 1 | awk &#39;NR&gt;1 {print$5}&#39;`</span>
<span class="w">                 </span><span class="no">if [ -z &quot;$tmpip&quot; ]; then</span>
<span class="w">                    </span><span class="no">echo -e &quot;\033[31m wait Node tdmnode-$i ip is null  \033[0m&quot;;</span>
<span class="w">                 </span><span class="no">else</span>
<span class="w">                    </span><span class="no">index=$(($index + 1))</span>
<span class="w">                 </span><span class="no">fi</span>
<span class="w">                </span><span class="no">done</span>

<span class="w">                </span><span class="no">if [ $index -ge $nodes ] ; then</span>
<span class="w">                      </span><span class="no">echo -e &quot;\033[32m ips is ready .Starting now Tdengine Taosd.... \033[0m&quot;</span>
<span class="w">                      </span><span class="no">for i in `seq 0 $end_index`; do</span>
<span class="w">                          </span><span class="no">tmpip=`dig tdmnode-$i.default.svc.cluster.local | grep &quot;ANSWER SECTION&quot; -A 1 | awk &#39;NR&gt;1 {print$5}&#39;`</span>
<span class="w">                          </span><span class="no">echo  &quot;${tmpip}       tdmnode-$i.default.svc.cluster.local&quot; &gt;&gt; /etc/hosts ;</span>
<span class="w">                          </span><span class="no">done</span>
<span class="w">                      </span><span class="no">break</span>
<span class="w">                 </span><span class="no">else</span>
<span class="w">                     </span><span class="no">index=0</span>
<span class="w">                     </span><span class="no">echo -e &quot;\033[31m all node not get ready pls wait....  \033[0m&quot;;</span>
<span class="w">                 </span><span class="no">fi</span>
<span class="w">              </span><span class="no">done</span>
<span class="w">              </span><span class="no">taosd</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MY_POD_IP</span>
<span class="w">              </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">                </span><span class="nt">fieldRef</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">status.podIP</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config-map</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/taos/taos.cfg</span>
<span class="w">              </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ms3.cnf</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datadir</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/taos/data</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config-map</span>
<span class="w">          </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode</span>
<span class="w">            </span><span class="nt">items</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ms3.cnf</span>
<span class="w">                </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ms3.cnf</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datadir</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testtdpvc1</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-2</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-2</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6030</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6030</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6030</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6031</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6031</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6031</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6032</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6032</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6032</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6033</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6033</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6033</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6034</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6034</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6034</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6035</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6035</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6035</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6036</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6036</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6036</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6037</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6037</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6037</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6038</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6038</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6038</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6039</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6039</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6039</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6040</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6040</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6040</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port6041</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6041</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6041</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tdmnode-2</span>
<span class="w">  </span><span class="nt">sessionAffinity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
</code></pre></div>

<h4 id="_3">注意事项</h4>
<ul>
<li>1 pvc 策略 非立即回收（重启集群 只删除 <code>StatefulSet</code> 即可）</li>
<li>2 监控IP 解析 哪一块目前还不完善 需要一定的时间才能解析到IP 大约 <code>5s</code></li>
</ul>
<h4 id="_4">内部使用方式</h4>
<ul>
<li>1 将Client 文件通过nfs映射到POD 或者其他 类型的 APP内部，通过 脚本初始化，大概内容如下。</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="w">       </span>command：
<span class="w">        </span>-<span class="w"> </span>sh<span class="w"> </span>或者<span class="w"> </span>bash
<span class="w">        </span>-<span class="w"> </span><span class="s2">&quot;-c&quot;</span>
<span class="w">        </span>-<span class="w"> </span><span class="p">|</span>
<span class="w">        </span><span class="nb">cd</span><span class="w"> </span>/plugin_free/client_td_2.0.20
<span class="w">        </span>./install_client.sh
</code></pre></div>

<p>目前在k8s 集群上已经连续运行了一周，期间多次强行破坏集群验证恢复能力，以及数据存储能力，目前集群数据大约15亿条（单表测试，还在继续写入。）</p>
<h4 id="_5">运行图</h4>
<ul>
<li>StatefulSet</li>
</ul>
<p><img alt="" src="/static/blog/2021-04-24-00-44-25.png" /></p>
<ul>
<li>service</li>
</ul>
<p><img alt="" src="/static/blog/2021-04-24-00-45-23.png" /></p>
<ul>
<li>taos</li>
</ul>
<p><img alt="" src="/static/blog/2021-04-24-00-47-07.png" /></p>
<ul>
<li>开始重启测试</li>
</ul>
<p><img alt="" src="/static/blog/2021-04-24-00-48-11.png" /></p>
<ul>
<li>重启后状态信息</li>
</ul>
<p><img alt="" src="/static/blog/2021-04-24-00-48-31.png" /></p>
<ul>
<li>端口等待 </li>
</ul>
<p><img alt="" src="/static/blog/2021-04-24-00-49-11.png" /></p>
<ul>
<li>重启后恢复</li>
</ul>
<p><img alt="" src="/static/blog/2021-04-24-00-49-32.png" /></p>
<ul>
<li>恢复后 还在继续写入（其中一个库的一个表）</li>
</ul>
<p><img alt="" src="/static/blog/2021-04-24-00-52-32.png" /></p>
<ul>
<li>补一张 PVC</li>
</ul>
<p><img alt="" src="/static/blog/2021-04-24-01-00-37.png" /></p>
<h4 id="tdengine">tdengine 采用默认配置文件没有修改时区，镜像也没有修改时区，所以日志时间有误差，忽略即可，（强迫症可以自己加）</h4>
<h3 id="_6">以上操作均在正式环境在运行，出现问题我会及时更新，感谢您的阅读。</h3>
<p>转载请注明出处，本文采用 <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a> 协议授权</p>
    </div>
    <footer>
        Power By Python Markdown Generate 2025-03-31 13:05:10
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });

        function setThemeMode() {
            const hour = new Date().getHours();
            const body = document.body;
            if (hour >= 18 || hour < 6) {
                body.classList.remove('day-mode');
                body.classList.add('night-mode');
            } else {
                body.classList.remove('night-mode');
                body.classList.add('day-mode');
            }
        }

        setThemeMode();
        setInterval(setThemeMode, 60000);
    </script>
</body>
</html>
